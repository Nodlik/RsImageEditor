var Modules;!function(a){var b=function(){function a(a){this.image=a,this.image=a}return a.prototype.execute=function(){return Promise.resolve(this.image)},a.prototype.unExecute=function(){return Promise.resolve(this.image)},a}();a.ResizeAction=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function b(){}return b.prototype.html=function(){return"good"},b.prototype.init=function(){},b.prototype.icon=function(){return"fa fa-icon"},b.prototype.type=function(){return 0},b.prototype.parent=function(){return null},b.prototype.name=function(){return"resize"},b.prototype.process=function(){var b=new Core.RsImage("1","2","3"),c=new a.ResizeAction(b);return b.getActionDispatcher().process(c)},b}();a.ResizeModule=b}(Modules||(Modules={}));var UI;!function(a){var b=function(){function b(a,b,c){this.$el=a,this.editor=b,this.images=c,this.page=null,this.$el.append($('<input type="file" id="rsFileInput" multiple />')),this.$el.find("#rsFileInput").on("change",function(){b.getLoader().load(this.files)}),this.$el.append($('<div id="rsImagePlace"></div>')),this.$imagePlace=this.$el.find("#rsImagePlace")}return b.prototype.back=function(){this.page.hasParent()&&(this.page=this.page.getParent(),this.render())},b.prototype.getImagePlace=function(){return this.$imagePlace},b.prototype.selected=function(){return[]},b.prototype.getEditor=function(){return this.editor},b.prototype.getPage=function(){return null==this.page&&(this.page=new a.Page(this,this.images)),this.page},b.prototype.render=function(){this.getPage().render()},b}();a.Editor=b}(UI||(UI={}));var UI;!function(a){var b=function(){function b(a,b,c){void 0===c&&(c=null),this.editor=a,this.imageCollection=b,this.parent=c}return b.prototype.hasParent=function(){return null!=this.parent},b.prototype.getParent=function(){return this.parent},b.prototype.appendImage=function(a){this.imageCollection.add(a)},b.prototype.getView=function(){return 1==this.imageCollection.getImages().length?new a.SingleView(this,this.imageCollection.getImages()[0]):new a.GridView(this,this.imageCollection)},b.prototype.getToolbar=function(){return 1==this.imageCollection.getImages().length?new a.SingleToolbar(this):new a.GridToolbar(this)},b.prototype.render=function(){this.getToolbar().render(),this.getImagePlace().html(""),this.getView().render()},b.prototype.getImagePlace=function(){return this.editor.getImagePlace()},b}();a.Page=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a){this.page=a}return a.prototype.render=function(){},a}();a.GridToolbar=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a){this.page=a}return a.prototype.render=function(){},a}();a.SingleToolbar=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a,b){this.page=a,this.imageCollection=b}return a.prototype.render=function(){var a=this;this.imageCollection.getImages().forEach(function(b){a.renderImage(b)})},a.prototype.renderImage=function(a){var b=this;a.getImage().then(function(c){var d='<div id="'+a.getId()+'"><img style="max-width: 200px" src="'+c.src+'" /></div>';b.page.getImagePlace().append($(d))})},a}();a.GridView=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a,b){this.page=a,this.image=b,this.canvas=null}return a.prototype.render=function(){var a=this;this.getCanvas().then(function(){a.renderImage()})},a.prototype.renderImage=function(){this.context.drawImage(this.htmlImage,0,0)},a.prototype.getCanvas=function(){var a=this;return new Promise(function(b){a.page.getImagePlace().append($('<canvas id="'+a.image.getId()+'"></canvas>')),a.canvas=a.page.getImagePlace().find("#"+a.image.getId())[0],a.image.getImage().then(function(c){a.htmlImage=c,a.canvas.width=c.width,a.canvas.height=c.height,a.context=a.canvas.getContext("2d"),b(!0)})})},a}();a.SingleView=b}(UI||(UI={}));var Core;!function(a){var b=function(){function a(a){this.current=0,this.image=a,this.actions=[]}return a.prototype.process=function(a){return this.actions.push(a),this.current++,a.execute()},a.prototype.undo=function(){return this.current>0?this.actions[this.current--].unExecute():Promise.resolve()},a.prototype.redo=function(){return this.current<this.actions.length-1?this.actions[this.current++].execute():Promise.resolve()},a}();a.ActionDispatcher=b}(Core||(Core={}));var Core;!function(a){var b=function(){function a(a){this.manager=a,this.images=[]}return a.prototype.add=function(a){this.manager.tryAdd(a),this.images.push(a)},a.prototype.has=function(a){return this.images.indexOf(a)>-1},a.prototype.remove=function(a){var b=this.images.indexOf(a);b>-1&&this.images.splice(b,1)},a.prototype.getImages=function(){return this.images},a}();a.ImageCollection=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(){this.images={},this.collections=[]}return b.prototype.newCollection=function(b){var c=new a.ImageCollection(this);for(var d in b)c.add(d);return this.collections.push(c),c},b.prototype.tryAdd=function(a){if(""==a.getId()){for(var b=Math.random().toString(36).substring(7);_.has(this.images,b);)b=Math.random().toString(36).substring(7);a.setId(b),this.add(a)}},b.prototype.add=function(a){this.images[a.getId()]=a},b.prototype.has=function(a){return _.has(this.images,a.getId())},b.prototype.remove=function(){},b}();a.ImageManager=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(b,c,d){this.imageData=b,this.imageName=c,this.imageType=d,this.id="",this.actionDispatcher=null,this.actionDispatcher=new a.ActionDispatcher(this)}return b.prototype.getActionDispatcher=function(){return this.actionDispatcher},b.prototype.setId=function(a){this.id=a},b.prototype.getId=function(){return this.id},b.prototype.getImage=function(){var a=this;return new Promise(function(b){var c=new Image;c.onload=function(){b(c)},c.src=a.imageData})},b}();a.RsImage=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(a){this.editor=a}return b.prototype.load=function(a){var b=this,c=0,d=new Promise(function(d){var e=setInterval(function(){if(c<a.length){var f=!1;c==a.length-1&&(f=!0),b.loadFile(a[c],d,f),c++}else clearInterval(e)},100)});d.then(function(){b.editor.UI().render()})},b.prototype.loadFile=function(b,c,d){var e=this;if(!b.type.match(/image.*/))return!1;var f=new FileReader;f.onload=function(f){e.editor.appendImage(new a.RsImage(f.target.result,b.name,b.type)),d&&c(1)},f.readAsDataURL(b)},b}();a.ImageLoader=b}(Core||(Core={}));var Core;!function(a){var b=function(){function a(a){this.editor=a,this.modules={},this.registerModule("resize",new Modules.ResizeModule)}return a.prototype.registerModule=function(a,b){a in this.modules||(this.modules[a]=b)},a.prototype.getModule=function(a){if(a in this.modules)return this.modules[a];throw new Error("Invalid module name")},a.prototype.getModules=function(){return _.values(this.modules)},a}();a.ModuleManager=b}(Core||(Core={}));var Core;!function(a){!function(a){a[a.ACTION=0]="ACTION",a[a.DELEGATE=1]="DELEGATE",a[a.GROUP=2]="GROUP"}(a.ModuleType||(a.ModuleType={}));a.ModuleType}(Core||(Core={}));var Core;!function(a){var b=function(){function b(b){this.imageManager=new a.ImageManager,this.ui=new UI.Editor(b,this,this.imageManager.newCollection([])),this.moduleManager=new a.ModuleManager(this),this.loader=new a.ImageLoader(this),this.ui.render()}return b.prototype.UI=function(){return this.ui},b.prototype.getModuleManager=function(){return this.moduleManager},b.prototype.appendImage=function(a){this.ui.getPage().appendImage(a)},b.prototype.getLoader=function(){return this.loader},b.prototype.getImageManager=function(){return this.imageManager},b}();a.RsImageEditor=b}(Core||(Core={}));