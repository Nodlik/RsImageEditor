eval(function(a,b,c,d,e,f){if(e=function(a){return(b>a?"":e(parseInt(a/b)))+((a%=b)>35?String.fromCharCode(a+29):a.toString(36))},!"".replace(/^/,String)){for(;c--;)f[e(c)]=d[c]||e(c);d=[function(a){return f[a]}],e=function(){return"\\w+"},c=1}for(;c--;)d[c]&&(a=a.replace(new RegExp("\\b"+e(c)+"\\b","g"),d[c]));return a}('(o(){I $,2I,1w,23,B,33,2Y,1p,1R,48,U,1S,34,1Z,1n,29,1m,1M,1h,4C,1W,1a,3t,4d,3v,3S=[].aQ||o(7T){T(I i=0,l=8.N;i<l;i++){u(i 2Q 8&&8[i]===7T)9 i}9-1},3s=[].3v,3B={}.au,5F=o(2n,6X){9 o(){9 2n.2t(6X,Z)}},7f=o(3q,3o){T(I 1A 2Q 3o){u(3B.17(3o,1A))3q[1A]=3o[1A]}o 6a(){8.al=3q}6a.G=3o.G;3q.G=1u 6a();3q.ag=3o.G;9 3q};4d=[\'7V\',\'53\'];29=(o(){o 29(){}29["a2"]=o(1E){I 1A,2y,F;T(1A 2Q 1E){2y=1E[1A];u(3S.17(4d,1A)<0){8[1A]=2y}}u((F=1E.7V)!=H){F.2t(8)}9 8};29.9Z=o(1E){I 1A,2y,F;T(1A 2Q 1E){2y=1E[1A];u(3S.17(4d,1A)<0){8.G[1A]=2y}}u((F=1E.53)!=H){F.2t(8)}9 8};29.9Y=o(){I W,4G,21,E,11,X;W=1<=Z.N?3s.17(Z,0):[];21=W.5n();X=[];T(E=0,11=W.N;E<11;E++){4G=W[E];X.1D(8.G[4G]=21.G[4G])}9 X};29.9U=o(2z,2O){I 1f=8;9 8.G[2z]=o(){I W;W=1<=Z.N?3s.17(Z,0):[];9 1f.G[2O].2t(1f,W)}};29.9G=o(2z,2O){9 9E.9C(8.G,2z,{2B:o(){9 8[2O]},9v:o(1v){9 8[2O]=1v}})};29.53=o(2Z){9 2Z.17(8,8.G)};9 29})();3v=4M.G.3v;$=o(4N,4O){u(4O==H){4O=1C}u(1k 4N==="2x"||(1k 1Y!=="2S"&&1Y!==H)){9 4N}9 4O.9f(4N)};1a=(o(){o 1a(){}1a.5T=(o(){I 1O;1O=0;9{2B:o(){9 1O++}}})();1a.99=o(){I 45,4S,1E,3y,1c,E,11;1E=Z[0],1c=2<=Z.N?3s.17(Z,1):[];4S=1E;T(E=0,11=1c.N;E<11;E++){45=1c[E];T(3y 2Q 45){u(!3B.17(45,3y))3E;4S[3y]=45[3y]}}9 4S};1a.2f=o(1v){u(1v<0){9 0}u(1v>C){9 C}9 1v};1a.3N=o(2O,2z,3O){I 3P,E,11,F,1P,X;u(3O==H){3O={}}F=2O.8X;X=[];T(E=0,11=F.N;E<11;E++){3P=F[E];u((3O.66!=H)&&(1P=3P.68,3S.17(3O.66,1P)>=0)){3E}X.1D(2z.82(3P.68,3P.8M))}9 X};1a.49=o(N){u(N==H){N=0}u(B.1V||(2G.8a!=H)){9 1u 8a(N)}9 1u 4M(N)};9 1a})();u(1k 1Y!=="2S"&&1Y!==H){4C=1Y;2Y=4Y(\'D\');34=2Y.34;48=4Y(\'94\');3t=4Y(\'3t\')}R{4C=2G}B=(o(7H){7f(B,7H);B.5Y={7r:"4.1.2",7h:"7/27/9I"};B.6T=1I;B.3x=2h;B.5v="6P";B.4K="";B.6M="9J";B.1V=1k 1Y!=="2S"&&1Y!==H;B.6I=!B.1V;B.3d=o(){9"9M "+B.5Y.7r+", 9P "+B.5Y.7h};B.5r=o(D){u(B.1V){9 2h}u(1k D==="3c"){D=$(D)}u(!((D!=H)&&(D.3b!=H))){9 H}9 D.3b(\'1y-2a-1O\')};o B(){8.47=5F(8.47,8);I W,1K,1O,1f=8;u(Z.N===0){20"4I Z";}u(8 9Q B){8.3a=8.3a.5p(8);8.3C=8.3C.5p(8);W=Z[0];u(!B.1V){1O=3D(B.5r(W[0]),10);1K=1k W[1]==="o"?W[1]:1k W[2]==="o"?W[2]:o(){};u(!9W(1O)&&1W.6s(1O)){9 1W.2k(1O,1K)}}8.1O=1a.5T.2B();8.4F=8.2V=H;8.3M={x:0,y:0};8.6p=1I;8.4D=1I;8.3R=[];8.5f=[];8.6g=[];8.3W=H;8.6k=1I;8.9X=1u 2I(8);8.2F=1u 1h(8);8.88(o(){1f.87(W);9 1f.81()});9 8}R{9 1u B(Z)}}B.G.88=o(38){I 54,1f=8;u(B.1V){9 4x(o(){9 38.17(1f)},0)}R{u(1C.50==="4w"){1n.1F("7B 7A");9 4x(o(){9 38.17(1f)},0)}R{54=o(){u(1C.50==="4w"){1n.1F("7B 7A");9 38.17(1f)}};9 1C.7y("ak",54,1I)}}};B.G.87=o(W){I 1A,1v,F,X;u(W.N===0){20"4I Z 7q";}8.2j=H;8.4v=H;8.4u=H;8.1K=o(){};8.7k(W[0]);u(W.N===1){9}3h(1k W[1]){1t"3c":8.4u=W[1];2N;1t"o":8.1K=W[1]}u(W.N===2){9}8.1K=W[2];u(W.N===4){F=W[4];X=[];T(1A 2Q F){u(!3B.17(F,1A))3E;1v=F[1A];X.1D(8.1e[1A]=1v)}9 X}};B.G.7k=o(1E){u(B.1V){8.2j=1E;8.4v=\'7i\';9}u(1k 1E==="2x"){8.2j=1E}R{8.2j=$(1E)}u(8.2j==H){20"an ao ap S 74 D T ar.";}9 8.4v=8.2j.68.3X()};B.G.81=o(){3h(8.4v){1t"7i":9 8.6W();1t"1b":9 8.6R();1t"D":9 8.6z()}};B.G.6W=o(){1n.1F("av T 1V");u(1k 8.2j==="3c"){9 3t.aw(8.2j,8.47)}R{9 8.47(H,8.2j)}};B.G.47=o(5D,1y){u(5D){20 5D;}8.S=1u 34();8.S.1c=1y;1n.1F("34 6t. 6r = "+(8.30())+", 6q = "+(8.32()));8.D=1u 2Y(8.30(),8.32());9 8.3a()};B.G.6R=o(){8.S=8.2j;8.D=1C.2m(\'D\');8.19=8.D.2l(\'2d\');1a.3N(8.S,8.D,{66:[\'1c\']});8.S.5x.5q(8.D,8.S);8.5k();9 8.5g()};B.G.6z=o(){8.D=8.2j;8.19=8.D.2l(\'2d\');u(8.4u!=H){8.S=1C.2m(\'1b\');8.S.1c=8.4u;8.5k();9 8.5g()}R{9 8.3a()}};B.G.5k=o(){u(8.5d()){1n.1F(8.S.1c,"->",8.4s());8.7j=2h;8.S.1c=8.4s()}u(1S.7d(8.S)){8.S.1c=1S.2W(8.S.1c);9 1n.1F("aH S aI, aJ 6Y = "+8.S.1c)}};B.G.5g=o(){u(8.6D()){9 8.3C()}R{9 8.S.6y=8.3C}};B.G.6D=o(){u(!8.S.4w){9 1I}u((8.S.6f!=H)&&8.S.6f===0){9 1I}9 2h};B.G.30=o(){9 8.S.K||8.S.6f};B.G.32=o(){9 8.S.P||8.S.aK};B.G.3C=o(){1n.1F("34 6t. 6r = "+(8.30())+", 6q = "+(8.32()));u(8.7j){8.D.K=8.30()/8.4j();8.D.P=8.32()/8.4j()}R{8.D.K=8.30();8.D.P=8.32()}9 8.3a()};B.G.3a=o(){I i,14,E,11,F;u(8.19==H){8.19=8.D.2l(\'2d\')}8.3p=8.40=8.K=8.D.K;8.41=8.42=8.P=8.D.P;8.7p();u(!8.80()){8.6u()}u(8.S!=H){8.19.46(8.S,0,0,8.30(),8.32(),0,0,8.40,8.42)}8.1H=8.19.2U(0,0,8.D.K,8.D.P);8.L=8.1H.1y;u(B.3x){8.4F=1a.49(8.L.N);8.2V=1a.49(8.L.N);F=8.L;T(i=E=0,11=F.N;E<11;i=++E){14=F[i];8.4F[i]=14;8.2V[i]=14}}8.1G={K:8.D.K,P:8.D.P};u(!B.1V){1W.7x(8.1O,8)}8.1K.17(8,8);9 8.1K=o(){}};B.G.89=o(){8.1H=8.19.2U(0,0,8.D.K,8.D.P);9 8.L=8.1H.1y};B.G.aZ=o(){I i,14,E,11,F,X;u(!B.3x){20"52 4z";}8.2V=1a.49(8.L.N);F=8.L;X=[];T(i=E=0,11=F.N;E<11;i=++E){14=F[i];X.1D(8.2V[i]=14)}9 X};B.G.80=o(){9 B.5r(8.D)!=H};B.G.6u=o(){u(B.1V||8.D.3b(\'1y-2a-1O\')){9}9 8.D.82(\'1y-2a-1O\',8.1O)};B.G.77=o(){9 8.D.3b(\'1y-2a-7J-4z\')!==H};B.G.7p=o(){I 2s;u(B.1V||!8.5d()){9}2s=8.4j();u(2s!==1){1n.1F("aY 2s = "+2s);8.6k=2h;8.40=8.D.K;8.42=8.D.P;8.D.K=8.40*2s;8.D.P=8.42*2s;8.D.8b.K=""+8.40+"8d";8.D.8b.P=""+8.42+"8d";8.19.aX(2s,2s);8.K=8.3p=8.D.K;9 8.P=8.41=8.D.P}};B.G.4j=o(){I 6d,2v;2v=2G.2v||1;6d=8.19.aW||8.19.aR||8.19.aP||8.19.aO||8.19.aN||1;9 2v/6d};B.G.8c=o(){9(2G.2v!=H)&&2G.2v!==1};B.G.5d=o(){u(8.77()||!8.8c()){9 1I}9 8.4s()!==H};B.G.4s=o(){u(8.S==H){9 H}9 8.S.3b(\'1y-2a-7J\')};B.G.4h=o(6n){I 4i;4i=8.D;8.D=6n;8.19=8.D.2l(\'2d\');u(!B.1V){4i.5x.5q(8.D,4i)}8.K=8.D.K;8.P=8.D.P;8.89();9 8.1G={K:8.D.K,P:8.D.P}};B.G.6K=o(1K){I 1f=8;u(1K==H){1K=o(){}}1R.2P(8,"7o");9 8.2F.2k(o(){1f.19.4k(1f.1H,0,0);9 1K.17(1f)})};B.G.aM=o(4m){I i,14,E,11,F;u(4m==H){4m=2h}u(!B.3x){20"52 4z";}F=8.7N();T(i=E=0,11=F.N;E<11;i=++E){14=F[i];8.L[i]=14}u(4m){9 8.19.4k(8.1H,0,0)}};B.G.aL=o(){I D,1L,i,1H,14,L,E,11,F;D=1C.2m(\'D\');1a.3N(8.D,D);D.K=8.3p;D.P=8.41;1L=D.2l(\'2d\');1H=1L.2U(0,0,D.K,D.P);L=1H.1y;F=8.4F;T(i=E=0,11=F.N;E<11;i=++E){14=F[i];L[i]=14}1L.4k(1H,0,0);8.3M={x:0,y:0};8.4D=1I;9 8.4h(D)};B.G.7N=o(){I D,4n,1L,5c,5G,i,1H,14,L,4o,3T,4p,4q,K,E,1g,11,F,1P,2u,56;u(!B.3x){20"52 4z";}4o=[];4p=8.3M.x;5c=4p+8.K;4q=8.3M.y;5G=4q+8.P;u(8.4D){D=1C.2m(\'D\');D.K=8.3p;D.P=8.41;1L=D.2l(\'2d\');1H=1L.2U(0,0,D.K,D.P);L=1H.1y;F=8.2V;T(i=E=0,11=F.N;E<11;i=++E){14=F[i];L[i]=14}1L.4k(1H,0,0);3T=1C.2m(\'D\');3T.K=8.K;3T.P=8.P;1L=3T.2l(\'2d\');1L.46(D,0,0,8.3p,8.41,0,0,8.K,8.P);L=1L.2U(0,0,8.K,8.P).1y;K=8.K}R{L=8.2V;K=8.3p}T(i=1g=0,1P=L.N;1g<1P;i=1g+=4){4n=1m.6O(i,K);u(((4p<=(2u=4n.x)&&2u<5c))&&((4q<=(56=4n.y)&&56<5G))){4o.1D(L[i],L[i+1],L[i+2],L[i+3])}}9 4o};B.G.1T=o(Y,4r){8.2F.3e({13:U.24.58,Y:Y,4r:4r});9 8};B.G.5b=o(Y,J,1Q,22){I i,E,F;u(1Q==H){1Q=H}u(22==H){22=0}u(1Q==H){1Q=0;T(i=E=0,F=J.N;0<=F?E<F:E>F;i=0<=F?++E:--E){1Q+=J[i]}}8.2F.3e({13:U.24.5h,Y:Y,J:J,1Q:1Q,22:22});9 8};B.G.5i=o(2r,W){8.2F.3e({13:U.24.1M,2r:2r,W:W});9 8};B.G.5o=o(1K){I 1q;1q=1u 1Z(8);8.6g.1D(1q);8.2F.3e({13:U.24.5t});1K.17(1q);8.2F.3e({13:U.24.5u});9 8};B.G.6h=o(1q){9 8.6i(1q)};B.G.6i=o(1q){8.5f.1D(8.3W);8.3R.1D(8.L);8.3W=1q;9 8.L=1q.L};B.G.6j=o(){8.L=8.3R.5n();9 8.3W=8.5f.5n()};B.G.6l=o(){9 8.3W.6m()};9 B})(29);4C.B=B;B.2I=(o(){o 2I(c){8.c=c}2I.G.aG=o(){I i,25,3w,E,1g,1o,F;25={r:{},g:{},b:{}};T(i=E=0;E<=C;i=++E){25.r[i]=0;25.g[i]=0;25.b[i]=0}T(i=1g=0,F=8.c.L.N;1g<F;i=1g+=4){25.r[8.c.L[i]]++;25.g[8.c.L[i+1]]++;25.b[8.c.L[i+2]]++}3w=8.c.L.N/4;T(i=1o=0;1o<=C;i=++1o){25.r[i]/=3w;25.g[i]/=3w;25.b[i]/=3w}9 25};9 2I})();2I=B.2I;B.5E=o(){I 1b,44,6A,E,11,X;44=1C.at("1b[1y-2a]");u(!(44.N>0)){9}X=[];T(E=0,11=44.N;E<11;E++){1b=44[E];X.1D(6A=1u 33(1b,o(){8.6E();9 8.2k()}))}9 X};u(B.6I){(o(){u(1C.50==="4w"){9 B.5E()}R{9 1C.7y("as",B.5E,1I)}})()}33=(o(){I 4t;4t="(\\\\w+)\\\\((.*?)\\\\)";o 33(2w,6S){8.6V=2w.3b(\'1y-2a\');8.2a=B(2w,6S.5p(8))}33.G.6E=o(){I W,e,3Q,2Z,5I,5J,m,r,3V,E,11,F,X;8.2w=8.2a.D;r=1u 75(4t,\'g\');3V=8.6V.5X(r);u(!(3V.N>0)){9}r=1u 75(4t);X=[];T(E=0,11=3V.N;E<11;E++){5I=3V[E];F=5I.5X(r),m=F[0],3Q=F[1],W=F[2];5J=1u aq("9 o() {        8."+3Q+"("+W+");      };");64{2Z=5J();X.1D(2Z.17(8.2a))}65(35){e=35;X.1D(1n.1F(e))}}9 X};33.G.2k=o(){I 2w;2w=8.2w;9 8.2a.6K(o(){9 2w.5x.5q(8.7b(),2w)})};9 33})();B.1w=(o(){o 1w(){}1w.67={};1w.15=o(Y,2Z){9 8.67[Y]=2Z};1w.2k=o(Y,O,M){9 8.67[Y](O,M)};9 1w})();1w=B.1w;B.23=(o(){o 23(){}23.am=o(36,37,3I,3G){9 Q.7w(Q.1B(3I-36,2)+Q.1B(3G-37,2))};23.7z=o(1x,V,3A){I 2q;u(3A==H){3A=1I}2q=1x+(Q.ai()*(V-1x));u(3A){9 2q.ah(3A)}R{9 Q.51(2q)}};23.7R=o(A){9(0.a9*A.r)+(0.a5*A.g)+(0.a3*A.b)};23.1z=o(1j,2e,2c,18,4y,4a){I 59,5a,4A,4B,3Y,3U,1z,5e,2K,i,j,39,4E,t,3H,36,3I,5j,3F,37,3G,5l,E,1g,1o,F,1P;3H=1j[0];3F=1j[1];36=2e[0];37=2e[1];3I=2c[0];3G=2c[1];5j=18[0];5l=18[1];1z={};3Y=3D(3*(36-3H),10);4A=3*(3I-36)-3Y;59=5j-3H-3Y-4A;3U=3*(37-3F);4B=3*(3G-37)-3U;5a=5l-3F-3U-4B;T(i=E=0;E<6w;i=++E){t=i/6w;5e=Q.51((59*Q.1B(t,3))+(4A*Q.1B(t,2))+(3Y*t)+3H);2K=Q.51((5a*Q.1B(t,3))+(4B*Q.1B(t,2))+(3U*t)+3F);u(4y&&2K<4y){2K=4y}R u(4a&&2K>4a){2K=4a}1z[5e]=2K}u(1z.N<18[0]+1){T(i=1g=0,F=18[0];0<=F?1g<=F:1g>=F;i=0<=F?++1g:--1g){u(1z[i]==H){39=[i-1,1z[i-1]];T(j=1o=i,1P=18[0];i<=1P?1o<=1P:1o>=1P;j=i<=1P?++1o:--1o){u(1z[j]!=H){4E=[j,1z[j]];2N}}1z[i]=39[1]+((4E[1]-39[1])/(4E[0]-39[0]))*(i-39[0])}}}u(1z[18[0]]==H){1z[18[0]]=1z[18[0]-1]}9 1z};9 23})();23=B.23;B.1p=(o(){o 1p(){}1p.5m=o(2b){I b,g,r;u(2b.9V(0)==="#"){2b=2b.4H(1)}r=3D(2b.4H(0,2),16);g=3D(2b.4H(2,2),16);b=3D(2b.4H(4,2),16);9{r:r,g:g,b:b}};1p.9T=o(r,g,b){I d,h,l,V,1x,s;u(1k r==="2x"){g=r.g;b=r.b;r=r.r}r/=C;g/=C;b/=C;V=Q.V(r,g,b);1x=Q.1x(r,g,b);l=(V+1x)/2;u(V===1x){h=s=0}R{d=V-1x;s=l>0.5?d/(2-V-1x):d/(V+1x);h=(o(){3h(V){1t r:9(g-b)/d+(g<b?6:0);1t g:9(b-r)/d+2;1t b:9(r-g)/d+4}})();h/=6}9{h:h,s:s,l:l}};1p.9L=o(h,s,l){I b,g,p,q,r;u(1k h==="2x"){s=h.s;l=h.l;h=h.h}u(s===0){r=g=b=l}R{q=l<0.5?l*(1+s):l+s-l*s;p=2*l-q;r=8.4J(p,q,h+1/3);g=8.4J(p,q,h);b=8.4J(p,q,h-1/3)}9{r:r*C,g:g*C,b:b*C}};1p.4J=o(p,q,t){u(t<0){t+=1}u(t>1){t-=1}u(t<1/6){9 p+(q-p)*6*t}u(t<1/2){9 q}u(t<2/3){9 p+(q-p)*(2/3-t)*6}9 p};1p.6L=o(r,g,b){I d,h,V,1x,s,v;r/=C;g/=C;b/=C;V=Q.V(r,g,b);1x=Q.1x(r,g,b);v=V;d=V-1x;s=V===0?0:d/V;u(V===1x){h=0}R{h=(o(){3h(V){1t r:9(g-b)/d+(g<b?6:0);1t g:9(b-r)/d+2;1t b:9(r-g)/d+4}})();h/=6}9{h:h,s:s,v:v}};1p.6N=o(h,s,v){I b,f,g,i,p,q,r,t;i=Q.2J(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);3h(i%6){1t 0:r=v;g=t;b=p;2N;1t 1:r=q;g=v;b=p;2N;1t 2:r=p;g=v;b=t;2N;1t 3:r=p;g=q;b=v;2N;1t 4:r=t;g=p;b=v;2N;1t 5:r=v;g=p;b=q}9{r:Q.2J(r*C),g:Q.2J(g*C),b:Q.2J(b*C)}};1p.6Q=o(r,g,b){I x,y,z;r/=C;g/=C;b/=C;u(r>0.5w){r=Q.1B((r+0.26)/1.26,2.4)}R{r/=12.92}u(g>0.5w){g=Q.1B((g+0.26)/1.26,2.4)}R{g/=12.92}u(b>0.5w){b=Q.1B((b+0.26)/1.26,2.4)}R{b/=12.92}x=r*0.8h+g*0.9D+b*0.9B;y=r*0.9A+g*0.9y+b*0.9x;z=r*0.9w+g*0.9u+b*0.9t;9{x:x*1l,y:y*1l,z:z*1l}};1p.9s=o(x,y,z){I b,g,r;x/=1l;y/=1l;z/=1l;r=(3.9r*x)+(-1.9o*y)+(-0.9n*z);g=(-0.9m*x)+(1.9h*y)+(0.9e*z);b=(0.9d*x)+(-0.9c*y)+(1.9b*z);u(r>0.5L){r=(1.26*Q.1B(r,0.5M))-0.26}R{r*=12.92}u(g>0.5L){g=(1.26*Q.1B(g,0.5M))-0.26}R{g*=12.92}u(b>0.5L){b=(1.26*Q.1B(b,0.5M))-0.26}R{b*=12.92}9{r:r*C,g:g*C,b:b*C}};1p.7g=o(x,y,z){I a,b,l,5N,5O,5P;u(1k x==="2x"){y=x.y;z=x.z;x=x.x}5N=95.7l;5O=1l.0;5P=7m.7n;x/=5N;y/=5O;z/=5P;u(x>0.5Q){x=Q.1B(x,0.5R)}R{x=(7.5S*x)+0.3f}u(y>0.5Q){y=Q.1B(y,0.5R)}R{y=(7.5S*y)+0.3f}u(z>0.5Q){z=Q.1B(z,0.5R)}R{z=(7.5S*z)+0.3f}l=7s*y-16;a=7t*(x-y);b=7u*(y-z);9{l:l,a:a,b:b}};1p.9a=o(l,a,b){I x,y,z;u(1k l==="2x"){a=l.a;b=l.b;l=l.l}y=(l+16)/7s;x=y+(a/7t);z=y-(b/7u);u(x>0.5U){x=x*x*x}R{x=0.4Z*(x-0.3f)}u(y>0.5U){y=y*y*y}R{y=0.4Z*(y-0.3f)}u(z>0.5U){z=z*z*z}R{z=0.4Z*(z-0.3f)}9{x:x*95.7l,y:y*1l.0,z:z*7m.7n}};1p.97=o(r,g,b){I 5W;u(1k r==="2x"){g=r.g;b=r.b;r=r.r}5W=8.6Q(r,g,b);9 8.7g(5W)};1p.96=o(l,a,b){};9 1p})();1p=B.1p;B.1R=(o(){o 1R(){}1R.2X={};1R.7C=["7D","7E","7o","7F","7G","3g"];1R.2P=o(21,13,1y){I 3K,E,11,F,X;u(1y==H){1y=H}u(8.2X[13]&&8.2X[13].N){F=8.2X[13];X=[];T(E=0,11=F.N;E<11;E++){3K=F[E];u(3K.21===H||21.1O===3K.21.1O){X.1D(3K.2n.17(21,1y))}R{X.1D(93 0)}}9 X}};1R.91=o(21,13,2n){I 61,62;u(1k 21==="3c"){62=21;61=13;21=H;13=62;2n=61}u(3S.17(8.7C,13)<0){9 1I}u(!8.2X[13]){8.2X[13]=[]}8.2X[13].1D({21:21,2n:2n});9 2h};9 1R})();1R=B.1R;B.U=(o(){o U(){}U.24={58:1,5h:2,5t:3,5u:4,63:5,1M:6};U.15=o(Y,7O){9 B.G[Y]=7O};9 U})();U=B.U;B.1S=(o(){o 1S(){}1S.7P=/(?:(?:8Z|8Y):\\/\\/)((?:\\w+)\\.(?:(?:\\w|\\.)+))/;1S.7d=o(1b){u(1b==H){9 1I}u(8.7S(1b)){9 1I}9 8.4U(1b.1c)};1S.7S=o(1b){I F;9(1b.5v!=H)&&((F=1b.5v.3X())===\'6P\'||F===\'7U-8W\')};1S.4U=o(7W){I 4V;4V=7W.5X(8.7P);u(4V){9 4V[1]!==1C.8V}R{9 1I}};1S.7Z=o(1c){u(8.4U(1c)){u(!B.4K.N){1n.69("8T 2z 8S a 83 S 8Q a 8L 86. 6Y: "+1c)}R{u(B.4U(B.4K)){1n.69("8K 7U a 83 86 T 8A 8z.");9}9 8.2W(1c)}}};1S.2W=o(1c){9""+B.4K+"?"+B.6M+"="+(8y(1c))};1S.8s=o(2M){I 4b;4b={8r:\'8q\',8p:\'8i\',9F:\'8j\',8k:\'8l\'};2M=2M.3X();u(4b[2M]!=H){2M=4b[2M]}9"8m/8n."+2M};9 1S})();B.G.8o=o(){u(1k 1Y!=="2S"&&1Y!==H){9 8.8g.2t(8,Z)}R{9 8.8f.2t(8,Z)}};B.G.8f=o(13){I S;u(13==H){13="8e"}13=13.3X();S=8.6e(13).8t("S/"+13,"S/8u-8v");9 1C.8w.8x=S};B.G.8g=o(3i,4X){I e,6c;u(4X==H){4X=2h}64{6c=3t.8B(3i);u(6c.8C()&&!4X){9 1I}}65(35){e=35;1n.1F("8D 8E 3i "+3i)}9 3t.8F(3i,8.D.8G(),o(){9 1n.1F("8H 8I 2z "+3i)})};B.G.7b=o(13){I 1b;1b=1C.2m(\'1b\');1b.1c=8.6e(13);1b.K=8.1G.K;1b.P=8.1G.P;u(2G.2v){1b.K/=2G.2v;1b.P/=2G.2v}9 1b};B.G.6e=o(13){u(13==H){13="8e"}13=13.3X();9 8.D.8J("S/"+13)};1S=B.1S;B.1Z=(o(){o 1Z(c){8.c=c;8.3Q=8.c;8.1e={6b:\'85\',2A:1.0};8.8N=1a.5T.2B();8.D=1k 1Y!=="2S"&&1Y!==H?1u 2Y():1C.2m(\'D\');8.D.K=8.c.1G.K;8.D.P=8.c.1G.P;8.19=8.D.2l(\'2d\');8.19.8O(8.D.K,8.D.P);8.1H=8.19.2U(0,0,8.D.K,8.D.P);8.L=8.1H.1y}1Z.G.5o=o(38){9 8.c.5o.17(8.c,38)};1Z.G.8P=o(84){8.1e.6b=84;9 8};1Z.G.2A=o(2A){8.1e.2A=2A/1l;9 8};1Z.G.8R=o(){I i,1X,E,F;1X=8.c.L;T(i=E=0,F=8.c.L.N;E<F;i=E+=4){8.L[i]=1X[i];8.L[i+1]=1X[i+1];8.L[i+2]=1X[i+2];8.L[i+3]=1X[i+3]}9 8};1Z.G.4W=o(){9 8.c.4W.2t(8.c,Z)};1Z.G.8U=o(S){u(1k S==="2x"){S=S.1c}R u(1k S==="3c"&&S[0]==="#"){S=$(S).1c}u(!S){9 8}8.c.2F.43.1D({13:U.24.63,1c:S,1q:8});9 8};1Z.G.6m=o(){I i,2T,1X,1d,O,M,E,F,X;1X=8.c.3R[8.c.3R.N-1];2T=8.c.L;X=[];T(i=E=0,F=2T.N;E<F;i=E+=4){M={r:1X[i],g:1X[i+1],b:1X[i+2],a:1X[i+3]};O={r:2T[i],g:2T[i+1],b:2T[i+2],a:2T[i+3]};1d=1w.2k(8.1e.6b,O,M);1d.r=1a.2f(1d.r);1d.g=1a.2f(1d.g);1d.b=1a.2f(1d.b);u(1d.a==H){1d.a=O.a}1X[i]=M.r-((M.r-1d.r)*(8.1e.2A*(1d.a/C)));1X[i+1]=M.g-((M.g-1d.g)*(8.1e.2A*(1d.a/C)));X.1D(1X[i+2]=M.b-((M.b-1d.b)*(8.1e.2A*(1d.a/C))))}9 X};9 1Z})();1Z=B.1Z;B.4T=(o(){o 4T(){I Y,E,11,F;F=[\'7Q\',\'69\',\'90\',\'7K\'];T(E=0,11=F.N;E<11;E++){Y=F[E];8[Y]=(o(Y){9 o(){I W,e;W=1<=Z.N?3s.17(Z,0):[];u(!B.6T){9}64{9 60[Y].2t(60,W)}65(35){e=35;9 60[Y](W)}}})(Y)}8.1F=8.7Q}9 4T})();1n=1u B.4T();B.1m=(o(){1m.5Z=o(x,y,K){9(y*K+x)*4};1m.6O=o(1i,K){I x,y;y=Q.2J(1i/(K*4));x=(1i%(K*4))/4;9{x:x,y:y}};o 1m(r,g,b,a,c){8.r=r!=H?r:0;8.g=g!=H?g:0;8.b=b!=H?b:0;8.a=a!=H?a:C;8.c=c!=H?c:H;8.1i=0}1m.G.5V=o(c){9 8.c=c};1m.G.98=o(){I x,y;u(8.c==H){20"3j a 3k 19";}y=8.c.1G.P-Q.2J(8.1i/(8.c.1G.K*4));x=(8.1i%(8.c.1G.K*4))/4;9{x:x,y:y}};1m.G.5K=o(1i){u(8.c==H){20"3j a 3k 19";}9 1u 1m(8.c.L[1i],8.c.L[1i+1],8.c.L[1i+2],8.c.L[1i+3],8.c)};1m.G.7c=o(4R,4Q){I 2g;u(8.c==H){20"3j a 3k 19";}2g=8.1i+(8.c.1G.K*4*(4Q*-1))+(4*4R);u(2g>8.c.L.N||2g<0){9 1u 1m(0,0,0,C,8.c)}9 8.5K(2g)};1m.G.9g=o(4R,4Q,A){I 79;u(8.c==H){20"3j a 3k 19";}79=8.1i+(8.c.1G.K*4*(4Q*-1))+(4*4R);u(2g>8.c.L.N||2g<0){9}8.c.L[2g]=A.r;8.c.L[2g+1]=A.g;8.c.L[2g+2]=A.b;8.c.L[2g+3]=A.a;9 2h};1m.G.9i=o(x,y){I 1i;u(8.c==H){20"3j a 3k 19";}1i=8.5Z(x,y,8.K);9 8.5K(1i)};1m.G.9j=o(x,y,A){I 1i;u(8.c==H){20"3j a 3k 19";}1i=8.5Z(x,y,8.K);8.c.L[1i]=A.r;8.c.L[1i+1]=A.g;8.c.L[1i+2]=A.b;9 8.c.L[1i+3]=A.a};1m.G.3d=o(){9 8.9k()};1m.G.9l=o(4P){I 2b;u(4P==H){4P=1I}2b=\'#\'+8.r.3d(16)+8.g.3d(16)+8.b.3d(16);u(4P){9 2b+8.a.3d(16)}R{9 2b}};9 1m})();1m=B.1m;B.1M=(o(){o 1M(){}1M.5H={};1M.15=o(Y,2r){9 8.5H[Y]=2r};1M.2k=o(19,Y,W){9 8.5H[Y].2t(19,W)};9 1M})();1M=B.1M;B.1h=(o(){1h.2C=B.1V?4Y(\'9p\').9q().N:4;o 1h(c){8.c=c;8.2p=5F(8.2p,8);8.43=[];8.31=H}1h.G.3e=o(5C){u(5C==H){9}9 8.43.1D(5C)};1h.G.2p=o(){I 1q;u(8.43.N===0){1R.2P(8,"7F");u(8.5B!=H){8.5B.17(8.c)}9 8}8.1r=8.43.72();3h(8.1r.13){1t U.24.5t:1q=8.c.6g.72();8.c.6h(1q);9 8.2p();1t U.24.5u:8.c.6l();8.c.6j();9 8.2p();1t U.24.63:9 8.71(8.1r.1q,8.1r.1c);1t U.24.1M:9 8.70();9z:9 8.6Z()}};1h.G.2k=o(1K){8.5B=1K;8.31=1a.49(8.c.L.N);9 8.2p()};1h.G.5A=o(2n){I 3Z,5z,1N,18,f,i,5y,n,1j,E,F,X,1f=8;8.4L=0;n=8.c.L.N;5z=Q.2J((n/4)/1h.2C);3Z=5z*4;5y=3Z+((n/4)%1h.2C)*4;X=[];T(i=E=0,F=1h.2C;0<=F?E<F:E>F;i=0<=F?++E:--E){1j=i*3Z;18=1j+(i===1h.2C-1?5y:3Z);u(B.1V){f=48(o(){9 2n.17(1f,i,1j,18)});1N=f.9H();X.1D(8.3g(1N))}R{X.1D(4x((o(i,1j,18){9 o(){9 2n.17(1f,i,1j,18)}})(i,1j,18),0))}}9 X};1h.G.6Z=o(){1R.2P(8.c,"7D",8.1r);u(8.1r.13===U.24.58){9 8.5A(8.6U)}R{9 8.5A(8.6J)}};1h.G.70=o(){1n.1F("9K 2r "+8.1r.2r);1M.2k(8.c,8.1r.2r,8.1r.W);1n.1F("1M "+8.1r.2r+" 5s!");9 8.2p()};1h.G.6U=o(1N,1j,18){I i,14,E;1n.1F("6G #"+1N+" - U: "+8.1r.Y+", 9N: "+1j+", 9O: "+18);1R.2P(8.c,"7G",{6F:1N,6C:1h.2C,9R:1j,9S:18});14=1u 1m();14.5V(8.c);T(i=E=1j;E<18;i=E+=4){14.1i=i;14.r=8.c.L[i];14.g=8.c.L[i+1];14.b=8.c.L[i+2];14.a=8.c.L[i+3];8.1r.4r(14);8.c.L[i]=1a.2f(14.r);8.c.L[i+1]=1a.2f(14.g);8.c.L[i+2]=1a.2f(14.b);8.c.L[i+3]=1a.2f(14.a)}u(B.1V){9 48["6B"](1N)}R{9 8.3g(1N)}};1h.G.6J=o(1N,1j,18){I J,3z,22,1U,3l,1Q,i,j,k,28,n,Y,p,14,3L,E,1g,1o;Y=8.1r.Y;22=8.1r.22;1Q=8.1r.1Q;n=8.c.L.N;J=8.1r.J;3z=Q.7w(J.N);28=[];1n.1F("a0 28 - U: "+8.1r.Y);1j=Q.V(1j,8.c.1G.K*4*((3z-1)/2));18=Q.1x(18,n-(8.c.1G.K*4*((3z-1)/2)));1U=(3z-1)/2;14=1u 1m();14.5V(8.c);T(i=E=1j;E<18;i=E+=4){14.1i=i;3l=0;T(j=1g=-1U;-1U<=1U?1g<=1U:1g>=1U;j=-1U<=1U?++1g:--1g){T(k=1o=1U;1U<=-1U?1o<=-1U:1o>=-1U;k=1U<=-1U?++1o:--1o){p=14.7c(j,k);28[3l*3]=p.r;28[3l*3+1]=p.g;28[3l*3+2]=p.b;3l++}}3L=8.5b(J,28,1Q,22);8.31[i]=1a.2f(3L.r);8.31[i+1]=1a.2f(3L.g);8.31[i+2]=1a.2f(3L.b);8.31[i+3]=8.c.L[i+3]}u(B.1V){9 48["6B"](1N)}R{9 8.3g(1N)}};1h.G.3g=o(1N){I i,E,F;u(1N>=0){1n.1F("6G #"+1N+" 5s! U: "+8.1r.Y)}8.4L++;1R.2P(8.c,"3g",{6F:1N,a1:8.4L,6C:1h.2C});u(8.4L===1h.2C){u(8.1r.13===U.24.5h){T(i=E=0,F=8.c.L.N;0<=F?E<F:E>F;i=0<=F?++E:--E){8.c.L[i]=8.31[i]}}u(1N>=0){1n.1F("U "+8.1r.Y+" 5s!")}1R.2P(8.c,"7E",8.1r);9 8.2p()}};1h.G.5b=o(J,28,1Q,22){I i,1v,E,F;1v={r:0,g:0,b:0};T(i=E=0,F=J.N;0<=F?E<F:E>F;i=0<=F?++E:--E){1v.r+=J[i]*28[i*3];1v.g+=J[i]*28[i*3+1];1v.b+=J[i]*28[i*3+2]}1v.r=(1v.r/1Q)+22;1v.g=(1v.g/1Q)+22;1v.b=(1v.b/1Q)+22;9 1v};1h.G.71=o(1q,1c){I 1b,2W,1f=8;1b=1C.2m(\'1b\');1b.6y=o(){1q.19.46(1b,0,0,1f.c.1G.K,1f.c.1G.P);1q.1H=1q.19.2U(0,0,1f.c.1G.K,1f.c.1G.P);1q.L=1q.1H.1y;1f.c.L=1q.L;9 1f.2p()};2W=1S.7Z(1c);9 1b.1c=2W!=H?2W:1c};9 1h})();1h=B.1h;B.1W=(o(){o 1W(){}1W.3m={};1W.6s=o(2D){9 8.3m[2D]!=H};1W.2B=o(2D){9 8.3m[2D]};1W.7x=o(Y,1E){9 8.3m[Y]=1E};1W.2k=o(2D,1K){I 1f=8;4x(o(){9 1K.17(1f.2B(2D),1f.2B(2D))},0);9 8.2B(2D)};1W.a4=o(Y){u(Y==H){Y=1I}u(Y){9 7X 8.3m[Y]}R{9 8.3m={}}};9 1W})();1W=B.1W;1w.15("85",o(O,M){9{r:O.r,g:O.g,b:O.b}});1w.15("a6",o(O,M){9{r:(O.r*M.r)/C,g:(O.g*M.g)/C,b:(O.b*M.b)/C}});1w.15("a7",o(O,M){9{r:C-(((C-O.r)*(C-M.r))/C),g:C-(((C-O.g)*(C-M.g))/C),b:C-(((C-O.b)*(C-M.b))/C)}});1w.15("a8",o(O,M){I 1d;1d={};1d.r=M.r>1s?C-2*(C-O.r)*(C-M.r)/C:(M.r*O.r*2)/C;1d.g=M.g>1s?C-2*(C-O.g)*(C-M.g)/C:(M.g*O.g*2)/C;1d.b=M.b>1s?C-2*(C-O.b)*(C-M.b)/C:(M.b*O.b*2)/C;9 1d});1w.15("aa",o(O,M){9{r:O.r-M.r,g:O.g-M.g,b:O.b-M.b}});1w.15("ab",o(O,M){9{r:M.r+O.r,g:M.g+O.g,b:M.b+O.b}});1w.15("ac",o(O,M){9{r:1s-2*(M.r-1s)*(O.r-1s)/C,g:1s-2*(M.g-1s)*(O.g-1s)/C,b:1s-2*(M.b-1s)*(O.b-1s)/C}});1w.15("ad",o(O,M){I 1d;1d={};1d.r=M.r>1s?C-((C-M.r)*(C-(O.r-1s)))/C:(M.r*(O.r+1s))/C;1d.g=M.g>1s?C-((C-M.g)*(C-(O.g-1s)))/C:(M.g*(O.g+1s))/C;1d.b=M.b>1s?C-((C-M.b)*(C-(O.b-1s)))/C:(M.b*(O.b+1s))/C;9 1d});1w.15("ae",o(O,M){9{r:M.r>O.r?M.r:O.r,g:M.g>O.g?M.g:O.g,b:M.b>O.b?M.b:O.b}});1w.15("af",o(O,M){9{r:M.r>O.r?O.r:M.r,g:M.g>O.g?O.g:M.g,b:M.b>O.b?O.b:M.b}});U.15("4W",o(){I 3n;u(Z.N===1){3n=1p.5m(Z[0])}R{3n={r:Z[0],g:Z[1],b:Z[2]}}9 8.1T("4W",o(A){A.r=3n.r;A.g=3n.g;A.b=3n.b;A.a=C;9 A})});U.15("7M",o(J){J=Q.2J(C*(J/1l));9 8.1T("7M",o(A){A.r+=J;A.g+=J;A.b+=J;9 A})});U.15("7L",o(J){J*=-0.aj;9 8.1T("7L",o(A){I V;V=Q.V(A.r,A.g,A.b);u(A.r!==V){A.r+=(V-A.r)*J}u(A.g!==V){A.g+=(V-A.g)*J}u(A.b!==V){A.b+=(V-A.b)*J}9 A})});U.15("7v",o(J){J*=-1;9 8.1T("7v",o(A){I 3J,2E,V;V=Q.V(A.r,A.g,A.b);2E=(A.r+A.g+A.b)/3;3J=((Q.2H(V-2E)*2/C)*J)/1l;u(A.r!==V){A.r+=(V-A.r)*3J}u(A.g!==V){A.g+=(V-A.g)*3J}u(A.b!==V){A.b+=(V-A.b)*3J}9 A})});U.15("7e",o(J){9 8.1T("7e",o(A){I 2E;2E=23.7R(A);A.r=2E;A.g=2E;A.b=2E;9 A})});U.15("7a",o(J){J=Q.1B((J+1l)/1l,2);9 8.1T("7a",o(A){A.r/=C;A.r-=0.5;A.r*=J;A.r+=0.5;A.r*=C;A.g/=C;A.g-=0.5;A.g*=J;A.g+=0.5;A.g*=C;A.b/=C;A.b-=0.5;A.b*=J;A.b+=0.5;A.b*=C;9 A})});U.15("76",o(J){9 8.1T("76",o(A){I b,g,h,2L,r,F;2L=1p.6L(A.r,A.g,A.b);h=2L.h*1l;h+=Q.2H(J);h=h%1l;h/=1l;2L.h=h;F=1p.6N(2L.h,2L.s,2L.v),r=F.r,g=F.g,b=F.b;A.r=r;A.g=g;A.b=b;9 A})});U.15("6H",o(){I 3r,2R;u(Z.N===2){2R=1p.5m(Z[0]);3r=Z[1]}R u(Z.N===4){2R={r:Z[0],g:Z[1],b:Z[2]};3r=Z[3]}9 8.1T("6H",o(A){A.r-=(A.r-2R.r)*(3r/1l);A.g-=(A.g-2R.g)*(3r/1l);A.b-=(A.b-2R.b)*(3r/1l);9 A})});U.15("6x",o(){9 8.1T("6x",o(A){A.r=C-A.r;A.g=C-A.g;A.b=C-A.b;9 A})});U.15("6v",o(J){u(J==H){J=1l}J/=1l;9 8.1T("6v",o(A){A.r=Q.1x(C,(A.r*(1-(0.ax*J)))+(A.g*(0.ay*J))+(A.b*(0.az*J)));A.g=Q.1x(C,(A.r*(0.aA*J))+(A.g*(1-(0.aB*J)))+(A.b*(0.aC*J)));A.b=Q.1x(C,(A.r*(0.aD*J))+(A.g*(0.aE*J))+(A.b*(1-(0.aF*J))));9 A})});U.15("6o",o(J){9 8.1T("6o",o(A){A.r=Q.1B(A.r/C,J)*C;A.g=Q.1B(A.g/C,J)*C;A.b=Q.1B(A.b/C,J)*C;9 A})});U.15("78",o(J){J=Q.2H(J)*2.55;9 8.1T("78",o(A){I 2q;2q=23.7z(J*-1,J);A.r+=2q;A.g+=2q;A.b+=2q;9 A})});U.15("73",o(J){J=Q.2H(J)*2.55;9 8.1T("73",o(A){u(A.r>C-J){A.r=C}R u(A.r<J){A.r=0}u(A.g>C-J){A.g=C}R u(A.g<J){A.g=0}u(A.b>C-J){A.b=C}R u(A.b<J){A.b=0}9 A})});U.15("7Y",o(1e){I 3u,2y;u(1k 1e!=="2x"){9 8}T(3u 2Q 1e){u(!3B.17(1e,3u))3E;2y=1e[3u];u(2y===0){7X 1e[3u];3E}1e[3u]/=1l}u(1e.N===0){9 8}9 8.1T("7Y",o(A){u(1e.4l!=H){u(1e.4l>0){A.r+=(C-A.r)*1e.4l}R{A.r-=A.r*Q.2H(1e.4l)}}u(1e.4g!=H){u(1e.4g>0){A.g+=(C-A.g)*1e.4g}R{A.g-=A.g*Q.2H(1e.4g)}}u(1e.4f!=H){u(1e.4f>0){A.b+=(C-A.b)*1e.4f}R{A.b-=A.b*Q.2H(1e.4f)}}9 A})});U.15("4e",o(){I 1z,2o,2i,2e,2c,18,i,1j,E,1g,F,1P;2o=Z[0],2i=2<=Z.N?3s.17(Z,1):[];u(1k 2o==="3c"){2o=2o.aS("")}u(2o[0]==="v"){2o=[\'r\',\'g\',\'b\']}u(2i.N<3||2i.N>4){20"4I aT aU Z 2z 4e 3Q";}1j=2i[0];2e=2i[1];2c=2i.N===4?2i[2]:2i[1];18=2i[2i.N-1];1z=23.1z(1j,2e,2c,18,0,C);u(1j[0]>0){T(i=E=0,F=1j[0];0<=F?E<F:E>F;i=0<=F?++E:--E){1z[i]=1j[1]}}u(18[0]<C){T(i=1g=1P=18[0];1P<=C?1g<=C:1g>=C;i=1P<=C?++1g:--1g){1z[i]=18[1]}}9 8.1T("4e",o(A){I 1o,2u;T(i=1o=0,2u=2o.N;0<=2u?1o<2u:1o>2u;i=0<=2u?++1o:--1o){A[2o[i]]=1z[A[2o[i]]]}9 A})});U.15("aV",o(J){I 2e,2c,p;p=Q.2H(J)/1l;2e=[0,C*p];2c=[C-(C*p),C];u(J<0){2e=2e.7I();2c=2c.7I()}9 8.4e(\'2R\',[0,0],2e,2c,[C,C])});B.1M.15("57",o(K,P,x,y){I D,1L;u(x==H){x=0}u(y==H){y=0}u(1k 1Y!=="2S"&&1Y!==H){D=1u 2Y(K,P)}R{D=1C.2m(\'D\');1a.3N(8.D,D);D.K=K;D.P=P}1L=D.2l(\'2d\');1L.46(8.D,x,y,K,P,0,0,K,P);8.3M={x:x,y:y};8.6p=2h;9 8.4h(D)});B.1M.15("4c",o(1J){I D,1L;u(1J==H){1J=H}u(1J===H||((1J.K==H)&&(1J.P==H))){1n.7K("4I 74 b0 1G 7q T 4c");9}u(1J.K==H){1J.K=8.D.K*1J.P/8.D.P}R u(1J.P==H){1J.P=8.D.P*1J.K/8.D.K}u(1k 1Y!=="2S"&&1Y!==H){D=1u 2Y(1J.K,1J.P)}R{D=1C.2m(\'D\');1a.3N(8.D,D);D.K=1J.K;D.P=1J.P}1L=D.2l(\'2d\');1L.46(8.D,0,0,8.D.K,8.D.P,0,0,1J.K,1J.P);8.4D=2h;9 8.4h(D)});B.U.15("57",o(){9 8.5i("57",4M.G.3v.17(Z,0))});B.U.15("4c",o(){9 8.5i("4c",4M.G.3v.17(Z,0))})}).17(8);',62,683,"||||||||this|return|||||||||||||||function||||||if||||||rgba|Caman|255|canvas|_i|_ref|prototype|null|var|adjust|width|pixelData|rgbaParent|length|rgbaLayer|height|Math|else|image|for|Filter|max|args|_results|name|arguments||_len||type|pixel|register||call|end|context|Util|img|src|result|options|_this|_j|Renderer|loc|start|typeof|100|Pixel|Log|_k|Convert|layer|currentJob|128|case|new|val|Blender|min|data|bezier|key|pow|document|push|obj|debug|dimensions|imageData|false|newDims|callback|ctx|Plugin|bnum|id|_ref1|divisor|Event|IO|process|builder|NodeJS|Store|parentData|exports|Layer|throw|target|bias|Calculate|Type|levels|055||kernel|Module|caman|hex|ctrl2||ctrl1|clampRGB|newLoc|true|cps|initObj|execute|getContext|createElement|fn|chans|processNext|rand|plugin|ratio|apply|_ref2|devicePixelRatio|ele|object|value|to|opacity|get|Blocks|search|avg|renderer|window|abs|Analyze|floor|curveY|hsv|lang|break|from|trigger|in|rgb|undefined|layerData|getImageData|originalPixelData|proxyUrl|events|Canvas|func|imageWidth|modPixelData|imageHeight|CamanParser|Image|_error|x1|y1|cb|leftCoord|finishInit|getAttribute|string|toString|add|1379310345|blockFinished|switch|file|Requires|CamanJS|builderIndex|items|color|parent|originalWidth|child|level|__slice|fs|chan|slice|numPixels|allowRevert|prop|adjustSize|getFloat|__hasProp|imageLoaded|parseInt|continue|y0|y2|x0|x2|amt|event|res|cropCoordinates|copyAttributes|opts|attr|filter|pixelStack|__indexOf|scaledCanvas|Cy|unparsedInstructions|currentLayer|toLowerCase|Cx|blockN|preScaledWidth|originalHeight|preScaledHeight|renderQueue|imgs|copy|drawImage|nodeFileReady|Fiber|dataArray|highBound|langToExt|resize|moduleKeywords|curves|blue|green|replaceCanvas|oldCanvas|hiDPIRatio|putImageData|red|updateContext|coord|pixels|startX|startY|processFn|hiDPIReplacement|INST_REGEX|imageUrl|initType|complete|setTimeout|lowBound|disabled|Bx|By|Root|resized|rightCoord|initializedPixelData|source|substr|Invalid|hueToRGB|remoteProxy|blocksDone|Array|sel|root|includeAlpha|vert|horiz|dest|Logger|isURLRemote|matches|fillColor|overwrite|require|1284185493|readyState|round|Revert|included|listener||_ref3|crop|Single|Ax|Ay|processKernel|endX|needsHiDPISwap|curveX|layerStack|waitForImageLoaded|Kernel|processPlugin|x3|imageAdjustments|y3|hexToRGB|pop|newLayer|bind|replaceChild|getAttrId|finished|LayerDequeue|LayerFinished|crossOrigin|04045|parentNode|lastBlockN|blockPixelLength|eachBlock|finishedFn|job|err|DOMUpdated|__bind|endY|plugins|inst|instFunc|pixelAtLocation|0031308|4166666667|whiteX|whiteY|whiteZ|008856451679|3333333333|787037037|uniqid|2068965517|setContext|xyz|match|version|coordinatesToLocation|console|_fn|_type|LoadOverlay|try|catch|except|blenders|nodeName|info|ctor|blendingMode|stats|backingStoreRatio|toBase64|naturalWidth|canvasQueue|executeLayer|pushContext|popContext|scaled|applyCurrentLayer|applyToParent|newCanvas|gamma|cropped|Height|Width|has|loaded|assignId|sepia|1000|invert|onload|initCanvas|parser|yield|totalBlocks|isImageLoaded|parse|blockNum|Block|colorize|autoload|renderKernel|render|rgbToHSV|proxyParam|hsvToRGB|locationToCoordinates|anonymous|rgbToXYZ|initImage|ready|DEBUG|renderBlock|dataStr|initNode|me|URL|executeFilter|executePlugin|loadOverlay|shift|clip|or|RegExp|hue|hiDPIDisabled|noise|nowLoc|contrast|toImage|getPixelRelative|isRemote|greyscale|__extends|xyzToLab|date|node|swapped|setInitObject|047|108|883|renderStart|hiDPIAdjustments|given|release|116|500|200|vibrance|sqrt|put|addEventListener|randomRange|initialized|DOM|types|processStart|processComplete|renderFinished|blockStarted|_super|reverse|hidpi|error|saturation|brightness|originalVisiblePixels|filterFunc|domainRegex|log|luminance|corsEnabled|item|use|extended|url|delete|channels|remoteCheck|hasId|setup|setAttribute|remote|mode|normal|proxy|parseArguments|domIsLoaded|reloadCanvasData|Uint8Array|style|hiDPICapable|px|png|browserSave|nodeSave|4124|py|pl|javascript|js|proxies|caman_proxy|save|python|rb|ruby|useProxy|replace|octet|stream|location|href|encodeURIComponent|images|loading|statSync|isFile|Creating|output|writeFile|toBuffer|Finished|writing|toDataURL|Cannot|configured|nodeValue|layerID|createImageData|setBlendingMode|without|copyParent|load|Attempting|overlayImage|domain|credentials|attributes|https|http|warn|listen||void|fibers||labToRGB|rgbToLab|locationXY|extend|labToXYZ|0570|2040|0557|0415|querySelector|putPixelRelative|8758|getPixel|putPixel|toKey|toHex|9689|4986|5372|os|cpus|2406|xyzToRGB|9505|1192|set|0193|0722|7152|default|2126|1805|defineProperty|3576|Object|perl|aliasProperty|run|2013|camanProxyUrl|Executing|hslToRGB|Version|Start|End|Released|instanceof|startPixel|endPixel|rgbToHSL|aliasFunction|charAt|isNaN|analyze|delegate|includes|Rendering|blocksFinished|extends|114|flush|587|multiply|screen|overlay|299|difference|addition|exclusion|softLight|lighten|darken|__super__|toFixed|random|01|readystatechange|constructor|distance|Could|not|find|Function|initialization|DOMContentLoaded|querySelectorAll|hasOwnProperty|Initializing|readFile|607|769|189|349|314|168|272|534|869|calculateLevels|Remote|detected|using|naturalHeight|reset|revert|backingStorePixelRatio|oBackingStorePixelRatio|msBackingStorePixelRatio|indexOf|mozBackingStorePixelRatio|split|number|of|exposure|webkitBackingStorePixelRatio|scale|HiDPI|resetOriginalPixelData|missing".split("|"),0,{})),function(){var a={};!function(){function b(a,c,d){var e=function(){};e.prototype=a.prototype;var f=new e,g=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;d=d||{};for(var h in d){var i=d[h],j=f[h];f[h]="function"==typeof j&&"function"==typeof i&&g.test(i)?function(a,b){return function(){var c=this.parent;this.parent=b;var d=a.apply(this,arguments);return this.parent=c,d}}(i,j):i}f.typename=c;var k=function(){f.init&&f.init.apply(this,arguments)};return k.prototype=f,k.prototype.constructor=k,k.extend=function(a,c){return"object"==typeof a&&(c=a,a="anonymous"),b(k,a,c)},k}a.object=b(Object,"Object",{})}(),function(){var b=Array.prototype,c=Object.prototype,d={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},e=/[&"'<>]/g,f=function(a){return d[a]},g=a.lib={};g.withPrettyErrors=function(a,b,c){try{return c()}catch(d){if(d.Update||(d=new g.TemplateError(d)),d.Update(a),!b){var e=d;d=new Error(e.message),d.name=e.name}throw d}},g.TemplateError=function(a,b,c){var d=this;return a instanceof Error?(d=a,a=a.name+": "+a.message):Error.captureStackTrace&&Error.captureStackTrace(d),d.name="Template render error",d.message=a,d.lineno=b,d.colno=c,d.firstUpdate=!0,d.Update=function(a){var b="("+(a||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?b+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(b+=" [Line "+this.lineno+"]")),b+="\n ",this.firstUpdate&&(b+=" "),this.message=b+(this.message||""),this.firstUpdate=!1,this},d},g.TemplateError.prototype=Error.prototype,g.escape=function(a){return a.replace(e,f)},g.isFunction=function(a){return"[object Function]"==c.toString.call(a)},g.isArray=Array.isArray||function(a){return"[object Array]"==c.toString.call(a)},g.isString=function(a){return"[object String]"==c.toString.call(a)},g.isObject=function(a){return"[object Object]"==c.toString.call(a)},g.groupBy=function(a,b){for(var c={},d=g.isFunction(b)?b:function(a){return a[b]},e=0;e<a.length;e++){var f=a[e],h=d(f,e);(c[h]||(c[h]=[])).push(f)}return c},g.toArray=function(a){return Array.prototype.slice.call(a)},g.without=function(a){var b=[];if(!a)return b;for(var c=-1,d=a.length,e=g.toArray(arguments).slice(1);++c<d;)-1===g.indexOf(e,a[c])&&b.push(a[c]);return b},g.extend=function(a,b){for(var c in b)a[c]=b[c];return a},g.repeat=function(a,b){for(var c="",d=0;b>d;d++)c+=a;return c},g.each=function(a,c,d){if(null!=a)if(b.each&&a.each==b.each)a.forEach(c,d);else if(a.length===+a.length)for(var e=0,f=a.length;f>e;e++)c.call(d,a[e],e,a)},g.map=function(a,c){var d=[];if(null==a)return d;if(b.map&&a.map===b.map)return a.map(c);for(var e=0;e<a.length;e++)d[d.length]=c(a[e],e);return a.length===+a.length&&(d.length=a.length),d},g.asyncIter=function(a,b,c){function d(){e++,e<a.length?b(a[e],e,d,c):c()}var e=-1;d()},g.asyncFor=function(a,b,c){function d(){h++;var g=e[h];f>h?b(g,a[g],h,f,d):c()}var e=g.keys(a),f=e.length,h=-1;d()},g.indexOf=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){var d=this.length>>>0;for(c=+c||0,Math.abs(c)===1/0&&(c=0),0>c&&(c+=d,0>c&&(c=0));d>c;c++)if(a[c]===b)return c;return-1},Array.prototype.map||(Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}),g.keys=function(a){if(Object.prototype.keys)return a.keys();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}}(),function(){function b(a,b,c){return function(){var f,g=e(arguments),h=d(arguments);if(g>a.length){f=Array.prototype.slice.call(arguments,0,a.length);for(var i=Array.prototype.slice.call(arguments,f.length,g),j=0;j<i.length;j++)j<b.length&&(h[b[j]]=i[j]);f.push(h)}else if(g<a.length){f=Array.prototype.slice.call(arguments,0,g);for(var j=g;j<a.length;j++){
var k=a[j];f.push(h[k]),delete h[k]}f.push(h)}else f=arguments;return c.apply(this,f)}}function c(a){return a.__keywords=!0,a}function d(a){var b=a.length;if(b){var c=a[b-1];if(c&&c.hasOwnProperty("__keywords"))return c}return{}}function e(a){var b=a.length;if(0===b)return 0;var c=a[b-1];return c&&c.hasOwnProperty("__keywords")?b-1:b}function f(a){return"string"!=typeof a?a:void(this.val=a)}function g(a,b){return a instanceof f?new f(b):b.toString()}function h(a){var b=typeof a;return"string"===b?new f(a):"function"!==b?a:function(){var b=a.apply(this,arguments);return"string"==typeof b?new f(b):b}}function i(a,b){return a=void 0!==a&&null!==a?a:"",b&&"string"==typeof a&&(a=p.escape(a)),a}function j(a,b){return a=a||{},"function"==typeof a[b]?function(){return a[b].apply(a,arguments)}:a[b]}function k(a,b,c){if(!a)throw new Error("Unable to call `"+b+"`, which is undefined or falsey");if("function"!=typeof a)throw new Error("Unable to call `"+b+"`, which is not a function");return a.apply(this,c)}function l(a,b,c){var d=b.lookup(c);return void 0!==d&&null!==d?d:a.lookup(c)}function m(a,b,c){return a.lineno?a:new p.TemplateError(a,b,c)}function n(a,b,c,d){if(p.isArray(a)){var e=a.length;p.asyncIter(a,function(a,d,f){switch(b){case 1:c(a,d,e,f);break;case 2:c(a[0],a[1],d,e,f);break;case 3:c(a[0],a[1],a[2],d,e,f);break;default:a.push(d,f),c.apply(this,a)}},d)}else p.asyncFor(a,function(a,b,d,e,f){c(a,b,d,e,f)},d)}function o(a,b,c,d){function e(a,b){h++,g[a]=b,h==f&&d(null,g.join(""))}var f,g,h=0;if(p.isArray(a))if(f=a.length,g=new Array(f),0==f)d(null,"");else for(var i=0;i<a.length;i++){var j=a[i];switch(b){case 1:c(j,i,f,e);break;case 2:c(j[0],j[1],i,f,e);break;case 3:c(j[0],j[1],j[2],i,f,e);break;default:j.push(i,e),c.apply(this,j)}}else{var k=p.keys(a);if(f=k.length,g=new Array(f),0==f)d(null,"");else for(var i=0;i<k.length;i++){var l=k[i];c(l,a[l],i,f,e)}}}var p=a.lib,q=a.object,r=q.extend({init:function(a){this.variables={},this.parent=a},set:function(a,b,c){var d=a.split("."),e=this.variables,f=this;if(c){if(f=this.resolve(d[0]))return void f.set(a,b);f=this}for(var g=0;g<d.length-1;g++){var h=d[g];e[h]||(e[h]={}),e=e[h]}e[d[d.length-1]]=b},get:function(a){var b=this.variables[a];return void 0!==b&&null!==b?b:null},lookup:function(a){var b=this.parent,c=this.variables[a];return void 0!==c&&null!==c?c:b&&b.lookup(a)},resolve:function(a){var b=this.parent,c=this.variables[a];return null!=c?this:b&&b.resolve(a)},push:function(){return new r(this)},pop:function(){return this.parent}});f.prototype=Object.create(String.prototype),f.prototype.valueOf=function(){return this.val},f.prototype.toString=function(){return this.val},a.runtime={Frame:r,makeMacro:b,makeKeywordArgs:c,numArgs:e,suppressValue:i,memberLookup:j,contextOrFrameLookup:l,callWrap:k,handleError:m,isArray:p.isArray,keys:p.keys,SafeString:f,copySafeness:g,markSafe:h,asyncEach:n,asyncAll:o}}(),function(){var b=a.object,c=a.lib,d=b.extend({on:function(a,b){this.listeners=this.listeners||{},this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(b)},emit:function(a){var b=Array.prototype.slice.call(arguments,1);this.listeners&&this.listeners[a]&&c.each(this.listeners[a],function(a){a.apply(null,b)})}});a.loader=d}(),function(){var b=a.loader,c=b.extend({init:function(a,b){this.precompiled=window.nunjucksPrecompiled||{},this.baseURL=a||"",this.neverUpdate=b},getSource:function(a){if(this.precompiled[a])return{src:{type:"code",obj:this.precompiled[a]},path:a};var b=this.fetch(this.baseURL+"/"+a);return b?{src:b,path:a,noCache:!this.neverUpdate}:null},fetch:function(a){var b,c,d=!0;return window.XMLHttpRequest?b=new XMLHttpRequest:window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP")),b.onreadystatechange=function(){4!==b.readyState||0!==b.status&&200!==b.status||!d||(d=!1,c=b.responseText)},a+=(-1===a.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),b.open("GET",a,!1),b.send(),c}});a["web-loaders"]={WebLoader:c}}(),function(){a.loaders="undefined"==typeof window||window!==this?a["node-loaders"]:a["web-loaders"]}(),function(){var b=a.lib,c=a.runtime,d={abs:function(a){return Math.abs(a)},batch:function(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)f%b===0&&e.length&&(d.push(e),e=[]),e.push(a[f]);if(e.length){if(c)for(var f=e.length;b>f;f++)e.push(c);d.push(e)}return d},capitalize:function(a){var b=a.toLowerCase();return c.copySafeness(a,b.charAt(0).toUpperCase()+b.slice(1))},center:function(a,d){if(d=d||80,a.length>=d)return a;var e=d-a.length,f=b.repeat(" ",e/2-e%2),g=b.repeat(" ",e/2);return c.copySafeness(a,f+a+g)},"default":function(a,b){return a?a:b},dictsort:function(a,c,d){if(!b.isObject(a))throw new b.TemplateError("dictsort filter: val must be an object");var e=[];for(var f in a)e.push([f,a[f]]);var g;if(void 0===d||"key"===d)g=0;else{if("value"!==d)throw new b.TemplateError("dictsort filter: You can only sort by either key or value");g=1}return e.sort(function(a,d){var e=a[g],f=d[g];return c||(b.isString(e)&&(e=e.toUpperCase()),b.isString(f)&&(f=f.toUpperCase())),e>f?1:e==f?0:-1}),e},escape:function(a){return"string"==typeof a||a instanceof c.SafeString?b.escape(a):a},safe:function(a){return c.markSafe(a)},first:function(a){return a[0]},groupby:function(a,c){return b.groupBy(a,c)},indent:function(a,d,e){d=d||4;for(var f="",g=a.split("\n"),h=b.repeat(" ",d),i=0;i<g.length;i++)f+=0!=i||e?h+g[i]+"\n":g[i]+"\n";return c.copySafeness(a,f)},join:function(a,c,d){return c=c||"",d&&(a=b.map(a,function(a){return a[d]})),a.join(c)},last:function(a){return a[a.length-1]},length:function(a){return void 0!==a?a.length:0},list:function(a){if(b.isString(a))return a.split("");if(b.isObject(a)){var c=[];if(Object.keys)c=Object.keys(a);else for(var d in a)c.push(d);return b.map(c,function(b){return{key:b,value:a[b]}})}throw new b.TemplateError("list filter: type not iterable")},lower:function(a){return a.toLowerCase()},random:function(a){return a[Math.floor(Math.random()*a.length)]},replace:function(a,b,d,e){if(b instanceof RegExp)return a.replace(b,d);var f=a,g=f,h=1;for(f=f.replace(b,d);g!=f&&!(h>=e);)g=f,f=f.replace(b,d),h++;return c.copySafeness(a,f)},reverse:function(a){var e;return e=b.isString(a)?d.list(a):b.map(a,function(a){return a}),e.reverse(),b.isString(a)?c.copySafeness(a,e.join("")):e},round:function(a,b,c){b=b||0;var d,e=Math.pow(10,b);return d="ceil"==c?Math.ceil:"floor"==c?Math.floor:Math.round,d(a*e)/e},slice:function(a,b,c){for(var d=Math.floor(a.length/b),e=a.length%b,f=0,g=[],h=0;b>h;h++){var i=f+h*d;e>h&&f++;var j=f+(h+1)*d,k=a.slice(i,j);c&&h>=e&&k.push(c),g.push(k)}return g},sort:function(a,c,d,e){return a=b.map(a,function(a){return a}),a.sort(function(a,f){var g,h;return e?(g=a[e],h=f[e]):(g=a,h=f),!d&&b.isString(g)&&b.isString(h)&&(g=g.toLowerCase(),h=h.toLowerCase()),h>g?c?1:-1:g>h?c?-1:1:0}),a},string:function(a){return c.copySafeness(a,a)},title:function(a){for(var b=a.split(" "),e=0;e<b.length;e++)b[e]=d.capitalize(b[e]);return c.copySafeness(a,b.join(" "))},trim:function(a){return c.copySafeness(a,a.replace(/^\s*|\s*$/g,""))},truncate:function(a,b,d,e){var f=a;if(b=b||255,a.length<=b)return a;if(d)a=a.substring(0,b);else{var g=a.lastIndexOf(" ",b);-1===g&&(g=b),a=a.substring(0,g)}return a+=void 0!==e&&null!==e?e:"...",c.copySafeness(f,a)},upper:function(a){return a.toUpperCase()},urlencode:function(a){var c=encodeURIComponent;if(b.isString(a))return c(a);var d;if(b.isArray(a))d=a.map(function(a){return c(a[0])+"="+c(a[1])});else{d=[];for(var e in a)a.hasOwnProperty(e)&&d.push(c(e)+"="+c(a[e]))}return d.join("&")},urlize:function(a,b,c){isNaN(b)&&(b=1/0);var d=c===!0?' rel="nofollow"':"",e=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,f=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,g=/^https?:\/\/.*$/,h=/^www\./,i=/\.(?:org|net|com)(?:\:|\/|$)/,j=a.split(/\s+/).filter(function(a){return a&&a.length}).map(function(a){var c=a.match(e),j=c&&c[1]||a;return g.test(j)?'<a href="'+j+'"'+d+">"+j.substr(0,b)+"</a>":h.test(j)?'<a href="http://'+j+'"'+d+">"+j.substr(0,b)+"</a>":f.test(j)?'<a href="mailto:'+j+'">'+j+"</a>":i.test(j)?'<a href="http://'+j+'"'+d+">"+j.substr(0,b)+"</a>":a});return j.join(" ")},wordcount:function(a){var b=a?a.match(/\w+/g):null;return b?b.length:null},"float":function(a,b){var c=parseFloat(a);return isNaN(c)?b:c},"int":function(a,b){var c=parseInt(a,10);return isNaN(c)?b:c}};d.d=d["default"],d.e=d.escape,a.filters=d}(),function(){function b(a){var b=-1;return{current:null,reset:function(){b=-1,this.current=null},next:function(){return b++,b>=a.length&&(b=0),this.current=a[b],this.current}}}function c(a){a=a||",";var b=!0;return function(){var c=b?"":a;return b=!1,c}}var d={range:function(a,b,c){b?c||(c=1):(b=a,a=0,c=1);for(var d=[],e=a;b>e;e+=c)d.push(e);return d},cycler:function(){return b(Array.prototype.slice.call(arguments))},joiner:function(a){return c(a)}};a.globals=d}(),function(){var b=a.path,c=a.lib,d=a.object,e=(a.lexer,a.compiler),f=a.filters,g=a.loaders,h=a.runtime,i=a.globals,j=h.Frame,k=d.extend({init:function(a,b){b=b||{},this.dev=!!b.dev,this.lexerTags=b.tags,this.autoesc=!!b.autoescape,this.loaders=a?c.isArray(a)?a:[a]:g.FileSystemLoader?[new g.FileSystemLoader("views")]:[new g.WebLoader("/views")],this.initCache(),this.filters={},this.asyncFilters=[],this.extensions={},this.extensionsList=[];for(var d in f)this.addFilter(d,f[d])},initCache:function(){var a={};c.each(this.loaders,function(b){"function"==typeof b.on&&b.on("update",function(b){a[b]=null})}),this.cache=a},addExtension:function(a,b){b._name=a,this.extensions[a]=b,this.extensionsList.push(b)},getExtension:function(a){return this.extensions[a]},addGlobal:function(a,b){i[a]=b},addFilter:function(a,b,c){var d=b;c&&this.asyncFilters.push(a),this.filters[a]=d},getFilter:function(a){if(!this.filters[a])throw new Error("filter not found: "+a);return this.filters[a]},getTemplate:function(a,b,d){if(a&&a.raw&&(a=a.raw),c.isFunction(b)&&(d=b,b=!1),"string"!=typeof a)throw new Error("template names must be a string: "+a);var e=this.cache[a];if(!e){var f;return c.asyncIter(this.loaders,function(b,c,d,e){function f(a){a?e(a):d()}b.async?b.getSource(a,function(a,b){if(a)throw a;f(b)}):f(b.getSource(a))},function(c){if(c){var e=new m(c.src,this,c.path,b);c.noCache||(this.cache[a]=e),d?d(null,e):f=e}else{var g=new Error("template not found: "+a);if(!d)throw g;d(g)}}.bind(this)),f}return b&&e.compile(),d?void d(null,e):e},express:function(a){function c(a,c){if(this.name=a,this.path=a,this.defaultEngine=c.defaultEngine,this.ext=b.extname(a),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}var d=this;c.prototype.render=function(a,b){d.render(this.name,a,b)},a.set("view",c)},render:function(a,b,d){c.isFunction(b)&&(d=b,b=null);var e=null;return this.getTemplate(a,function(a,c){if(a&&d)d(a);else{if(a)throw a;c.render(b,d||function(a,b){if(a)throw a;e=b})}}),e},renderString:function(a,b,c){var d=new m(a,this);return d.render(b,c)}}),l=d.extend({init:function(a,b){this.ctx=a,this.blocks={},this.exported=[];for(var c in b)this.addBlock(c,b[c])},lookup:function(a){return a in i&&!(a in this.ctx)?i[a]:this.ctx[a]},setVariable:function(a,b){this.ctx[a]=b},getVariables:function(){return this.ctx},addBlock:function(a,b){this.blocks[a]=this.blocks[a]||[],this.blocks[a].push(b)},getBlock:function(a){if(!this.blocks[a])throw new Error('unknown block "'+a+'"');return this.blocks[a][0]},getSuper:function(a,b,d,e,f,g){var h=c.indexOf(this.blocks[b]||[],d),i=this.blocks[b][h+1],j=this;if(-1==h||!i)throw new Error('no super block available for "'+b+'"');i(a,j,e,f,g)},addExport:function(a){this.exported.push(a)},getExported:function(){for(var a={},b=0;b<this.exported.length;b++){var c=this.exported[b];a[c]=this.ctx[c]}return a}}),m=d.extend({init:function(a,b,d,e){if(this.env=b||new k,c.isObject(a))switch(a.type){case"code":this.tmplProps=a.obj;break;case"string":this.tmplStr=a.obj}else{if(!c.isString(a))throw new Error("src must be a string or an object describing the source");this.tmplStr=a}this.path=d,e?c.withPrettyErrors(this.path,this.env.dev,this._compile.bind(this)):this.compiled=!1},render:function(a,b,d){return"function"==typeof a?(d=a,a={}):"function"==typeof b&&(d=b,b=null),c.withPrettyErrors(this.path,this.env.dev,function(){try{this.compile()}catch(c){if(d)return d(c);throw c}var e=new l(a||{},this.blocks),f=null;return this.rootRenderFunc(this.env,e,b||new j,h,d||function(a,b){if(a)throw a;f=b}),f}.bind(this))},getExported:function(a,b,c){"function"==typeof a&&(c=a,a={}),"function"==typeof b&&(c=b,b=null);try{this.compile()}catch(d){if(c)return c(d);throw d}var e=new l(a||{},this.blocks);this.rootRenderFunc(this.env,e,b||new j,h,function(){c(null,e.getExported())})},compile:function(){this.compiled||this._compile()},_compile:function(){var a;if(this.tmplProps)a=this.tmplProps;else{var b=e.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.lexerTags),c=new Function(b);a=c()}this.blocks=this._getBlocks(a),this.rootRenderFunc=a.root,this.compiled=!0},_getBlocks:function(a){var b={};for(var c in a)"b_"==c.slice(0,2)&&(b[c.slice(2)]=a[c]);return b}});a.environment={Environment:k,Template:m}}();var b,c=a.lib,d=a.environment,e=a.compiler,f=a.parser,g=a.lexer,h=a.runtime,i=a.loader,j=a.loaders,k=a.precompile;b={},b.Environment=d.Environment,b.Template=d.Template,b.Loader=i,b.FileSystemLoader=j.FileSystemLoader,b.WebLoader=j.WebLoader,b.compiler=e,b.parser=f,b.lexer=g,b.runtime=h;var l;b.configure=function(a,b){b=b||{},c.isObject(a)&&(b=a,a=null);var e="watch"in b?!b.watch:!1,f=j.FileSystemLoader||j.WebLoader;return l=new d.Environment(new f(a,e),b),b&&b.express&&l.express(b.express),l},b.compile=function(a,c,d,e){return l||b.configure(),new b.Template(a,c,d,e)},b.render=function(a,c,d){return l||b.configure(),l.render(a,c,d)},b.renderString=function(a,c,d){return l||b.configure(),l.renderString(a,c,d)},k&&(b.precompile=k.precompile,b.precompileString=k.precompileString),b.require=function(b){return a[b]},"function"==typeof define&&define.amd?define(function(){return b}):(window.nunjucks=b,"undefined"!=typeof module&&(module.exports=b))}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["color.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <input class="m_color-brightness" type="text" placeholder="width" value="100" /> <br />\n\n    <button class="m_color-ok" value="ok">OK!</button>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["crop.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <button id="crop_ok">OK!</button>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["resize.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <input class="m_resize-width" type="text" placeholder="width" value="150" /> <br />\n    <input class="m_resize-height" type="text" placeholder="height"value="100" /> <br /> <br />\n\n    <button class="m_resize-ok" value="ok">OK!</button>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["editor.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="rs-editor-block">\n    <input type="file" id="rsFileInput" style="display: none" multiple />\n    <div id="rsToolbarPlace" class="rs-toolbar"></div>\n    <div class="rs-content">\n        <div id="rsImagePlace" class="rs-image-place"></div>\n        <div id="rsPopover" class="rs-popover hide"></div>\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["grid.image.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="rs-image" data-id="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"id",a.autoesc),a.autoesc),h+='">\n    <div class="rs-image-block">\n        <!--<img src="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"src",a.autoesc),a.autoesc),h+='" />-->\n    </div>\n    <div class="rs-image-data">\n        <div class="rs-image-data__inf">\n            <div class="rs-image-data__label">',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"label",a.autoesc),a.autoesc),h+='</div>\n            <div class="rs-image-data__name">',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"name",a.autoesc),a.autoesc),h+='</div>\n        </div>\n        <div class="rs-image-data__select">\n            <input type="checkbox" class="rs-image-selection-checkbox" />\n        </div>\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["single.image.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="rs-single-image">\n    <div class="rs-canvas-place" id="rsSingleImage">\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["toolbar.button.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div id="t-button__',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"name",a.autoesc),a.autoesc),h+='" class="rs-toolbar-button">\n    ',""!=d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"icon",a.autoesc)?(h+='\n    <i class="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"icon",a.autoesc),a.autoesc),h+='"></i>\n    '):(h+="\n        ",h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"localizedName",a.autoesc),a.autoesc),h+="\n    "),h+="\n</div>",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}();var Core;!function(a){var b=function(){function a(a){this.current=-1,this.image=a,this.actions=[],this.actionsResult=[]}return a.prototype.process=function(a){return this.actions=this.actions.splice(this.current),this.actions.push(a),this.current++,this.actionsResult.push(this.doAction(a.execute,a)),_.last(this.actionsResult)},a.prototype.undo=function(){if(this.current>=0){var a=this.actions[this.current];return this.current--,this.actionsResult.push(this.doAction(a.unExecute,a)),_.last(this.actionsResult)}return Promise.resolve(this.image)},a.prototype.redo=function(){if(this.current<this.actions.length-1){this.current++;var a=this.actions[this.current];return this.actionsResult.push(this.doAction(a.execute,a)),_.last(this.actionsResult)}return Promise.resolve(this.image)},a.prototype.doAction=function(a,b){var c=this;return 0==this.actionsResult.length?a.apply(b):new Promise(function(d){_.last(c.actionsResult).then(function(){a.apply(b).then(function(a){d(a)})})})},a}();a.ActionDispatcher=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(b,c){this.imageName=b,this.imageType=c,this.id="",this.actionDispatcher=null,this.imageBase64="",this.actionDispatcher=new a.ActionDispatcher(this)}return b.prototype.create=function(a){var b=this;return this.imageBase64=a,new Promise(function(a){b.getImage().then(function(c){var d=document.createElement("canvas"),e=d.getContext("2d");d.width=c.width,d.height=c.height,e.drawImage(c,0,0),b.originalImage=e.getImageData(0,0,c.width,c.height),b.init(),a(b)})})},b.prototype.init=function(){this.processedImage=this.originalImage,this.width=this.originalImage.width,this.height=this.originalImage.height,this.brightness=0},b.prototype.save=function(){var b=this,c=document.createElement("canvas"),d=c.getContext("2d");c.width=this.width,c.height=this.height,d.putImageData(this.originalImage,0,0);var e;return e=this.width!=this.originalImage.width||this.height!=this.originalImage.height?new a.ImageResizer(this.originalImage,this.width,this.height).resize():Promise.resolve(d.getImageData(0,0,this.width,this.height)),e.then(function(a){return c.width=a.width,c.height=a.height,d.putImageData(a,0,0),new Promise(function(e){var f=b;Caman(c,function(){var b=this;b.brightness(f.brightness),b.render(function(){e(d.getImageData(0,0,a.width,a.height))})})})}).then(function(a){b.processedImage=a;var c=document.createElement("canvas"),d=c.getContext("2d");return c.width=b.processedImage.width,c.height=b.processedImage.height,d.putImageData(b.processedImage,0,0),b.imageBase64=c.toDataURL(),b})},b.prototype.getImageData=function(){return this.processedImage},b.prototype.getWidth=function(){return this.processedImage.width},b.prototype.getHeight=function(){return this.processedImage.height},b.prototype.getName=function(){return this.imageName},b.prototype.getLabel=function(){return""},b.prototype.getImageBase64=function(){return this.imageBase64},b.prototype.getActionDispatcher=function(){return this.actionDispatcher},b.prototype.setId=function(a){this.id=a},b.prototype.getId=function(){return this.id},b.prototype.getImage=function(){var a=this;return new Promise(function(b){var c=new Image;c.onload=function(){b(c)},c.src=a.imageBase64})},b}();a.RsImage=b}(Core||(Core={}));var Core;!function(a){var b=function(){function a(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d}return a.prototype.devig=function(a){return this.r/=a,this.g/=a,this.b/=a,this.a/=a,this},a}(),c=function(){function a(a,b,c){this.original=a,this.newWidth=b,this.newHeight=c,this.size=this.original.data.length}return a.prototype.resize=function(){var a=this.getWidthGridSize(),b=this.getHeightGridSize();return a>2&&b>2?Promise.resolve(this.downScaleSuperSampling(a,b)):this.upScale()},a.prototype.upScale=function(){var a=this,b=document.createElement("canvas"),c=b.getContext("2d");b.width=this.original.width,b.height=this.original.height,c.putImageData(this.original,0,0);var d=new Image;return new Promise(function(e){d.onload=function(){b.width=a.newWidth,b.height=a.newHeight,c.drawImage(d,0,0,a.newWidth,a.newHeight),e(c.getImageData(0,0,a.newWidth,a.newHeight))},d.src=b.toDataURL()})},a.prototype.downScaleSuperSampling=function(a,b){for(var c=document.createElement("canvas"),d=c.getContext("2d"),e=d.createImageData(this.newWidth,this.newHeight),f=this.cutImageData(a,b),g=0,h=0;h<this.newHeight;h++)for(var i=0;i<this.newWidth;i++){var j=f[h][i];j&&(e.data[g]=j.r,e.data[g+1]=j.g,e.data[g+2]=j.b,e.data[g+3]=j.a,g+=4)}return e},a.prototype.cutImageData=function(a,c){for(var d=0,e=[],f=0;f<this.original.height;f+=c){e[d]=[];for(var g=0;g<this.original.width;g+=a){for(var h=new b(0,0,0,0),i=0,j=f;f+c>j;j++)for(var k=g;g+a>k;k++){var l=4*(j*this.original.width+k);l+3<this.size&&(h.r=h.r+this.original.data[l],h.g=h.g+this.original.data[l+1],h.b=h.b+this.original.data[l+2],h.a=h.a+this.original.data[l+3],i++)}e[d].push(h.devig(i))}d++}return e},a.prototype.getWidthGridSize=function(){return Math.floor(this.original.width/this.newWidth)},a.prototype.getHeightGridSize=function(){return Math.floor(this.original.height/this.newHeight)},a}();a.ImageResizer=c}(Core||(Core={}));var Modules;!function(a){var b=function(){function a(a,b){this.image=a,this.brightness=b}return a.prototype.execute=function(){return this.oldBrightness=this.image.brightness,this.image.brightness=this.brightness,this.image.save()},a.prototype.unExecute=function(){return this.image.brightness=this.oldBrightness,this.image.save()},a}();a.BrightnessAction=b}(Modules||(Modules={}));var Core;!function(a){!function(a){a[a.ACTION=0]="ACTION",a[a.DELEGATE=1]="DELEGATE",a[a.GROUP=2]="GROUP"}(a.ModuleType||(a.ModuleType={}));a.ModuleType}(Core||(Core={}));var Core;!function(a){var b=function(){function b(){this.images={},this.collections=[]}return b.prototype.newCollection=function(b){var c=new a.ImageCollection(this);for(var d in b)c.add(d);return this.collections.push(c),c},b.prototype.tryAdd=function(a){if(""==a.getId()){for(var b=Math.random().toString(36).substring(7);_.has(this.images,b);)b=Math.random().toString(36).substring(7);a.setId(b),this.add(a)}},b.prototype.add=function(a){this.images[a.getId()]=a},b.prototype.has=function(a){return _.has(this.images,a.getId())},b.prototype.remove=function(){},b}();a.ImageManager=b}(Core||(Core={}));var Core;!function(a){var b=function(){function a(a){this.manager=a,this.images=[]}return a.prototype.add=function(a){this.manager.tryAdd(a),this.images.push(a)},a.prototype.has=function(a){return this.images.indexOf(a)>-1},a.prototype.remove=function(a){var b=this.images.indexOf(a);b>-1&&this.images.splice(b,1)},a.prototype.getImages=function(){return this.images},a.prototype.getImage=function(b){var c=new a(this.manager);return this.images.forEach(function(a){a.getId()==b&&c.add(a)}),c},a.prototype.findImage=function(a){var b=[];return this.images.forEach(function(c){_.contains(a,c.getId())&&b.push(c)}),b},a}();a.ImageCollection=b}(Core||(Core={}));var UI;!function(a){var b=function(){function a(a,b){this.page=a,this.image=b,this.canvas=null}return a.prototype.type=function(){return 0},a.prototype.render=function(){this.page.getImagePlace().html(nunjucks.render("single.image.html.njs",{})),this.getCanvas(),this.renderImage()},a.prototype.selected=function(){return[this.image]},a.prototype.getAreaElement=function(){return this.page.getImagePlace().find("#rsSingleImage")},a.prototype.renderImage=function(){this.context.putImageData(this.image.getImageData(),0,0)},a.prototype.getCanvas=function(){var a=this.page.getImagePlace().find("#"+this.image.getId());0==a.length&&this.page.getImagePlace().find("#rsSingleImage").html('<canvas id="'+this.image.getId()+'"></canvas>'),this.canvas=this.page.getImagePlace().find("#"+this.image.getId())[0],this.canvas.width=this.image.getWidth(),this.canvas.height=this.image.getHeight(),this.context=this.canvas.getContext("2d")},a}();a.SingleView=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a,b){this.page=a,this.imageCollection=b}return a.prototype.type=function(){return 1},a.prototype.render=function(){var a=this;this.page.getImagePlace().html("");var b=this.imageCollection.getImages();if(b.length>0)var c=0,d=setInterval(function(){a.renderImage(b[c]),c++,c==b.length&&clearInterval(d)},10)},a.prototype.selected=function(){var a=[];return this.page.getImagePlace().find(".rs-image-selected").each(function(b,c){a.push($(c).data("id"))}),this.imageCollection.findImage(a)},a.prototype.renderImage=function(a){var b=$(nunjucks.render("grid.image.html.njs",{image:{name:a.getName(),id:a.getId(),label:a.getLabel()}}));this.page.getImagePlace().append(b);var c=$('<canvas id="'+a.getId()+'"></canvas>');b.find(".rs-image-block").append(c);var d=c[0],e=d.getContext("2d");d.width=150,d.height=120,new Core.ImageResizer(a.getImageData(),150,120).resize().then(function(a){e.putImageData(a,0,0)})},a}();a.GridView=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a,b){this.page=a,this.editor=b,this.$toolbar=this.editor.UI().getToolbarPlace()}return a.prototype.render=function(){this.$toolbar.html(""),null!==this.page.getParent()&&this.renderBackButton(this.$toolbar),this.renderCommonButton(this.$toolbar)},a.prototype.renderModuleToolbar=function(a,b){var c=this,d=this.editor.getModuleManager().getModules(this.editor.UI().getType(),null);d.forEach(function(a){var d=$(nunjucks.render("toolbar.button.html.njs",{button:{name:a.name(),icon:a.icon(),localizedName:a.name()}}));b.append(d),c.editor.UI().initModule(d,a)})},a.prototype.renderCommonButton=function(a){a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"upload",icon:"fa fa-upload",localizedName:"upload"}}))),a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"undo",icon:"fa fa-undo",localizedName:"undo"}}))),a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"redo",icon:"fa fa-repeat",localizedName:"redo"}})))},a.prototype.renderBackButton=function(a){a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"back",icon:"fa fa-arrow-left",localizedName:"back"}})))},a}();a.Toolbar=b}(UI||(UI={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},UI;!function(a){var b=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.render=function(){a.prototype.render.call(this),this.renderModuleToolbar(1,this.$toolbar),this.editor.UI().initToolbar(this.$toolbar)},b}(a.Toolbar);a.GridToolbar=b}(UI||(UI={}));var UI;!function(a){var b=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.render=function(){a.prototype.render.call(this),this.renderModuleToolbar(0,this.$toolbar),this.editor.UI().initToolbar(this.$toolbar)},b}(a.Toolbar);a.SingleToolbar=b}(UI||(UI={}));var UI;!function(a){var b=function(){function b(a,b,c){void 0===c&&(c=null),this.editor=a,this.imageCollection=b,this.parent=c}return b.prototype.hasParent=function(){return null!=this.parent},b.prototype.getParent=function(){return this.parent},b.prototype.appendImage=function(a){this.imageCollection.add(a)},b.prototype.getView=function(){return 1==this.imageCollection.getImages().length?new a.SingleView(this,this.imageCollection.getImages()[0]):new a.GridView(this,this.imageCollection)},b.prototype.getToolbar=function(){return 1==this.imageCollection.getImages().length?new a.SingleToolbar(this,this.editor.getEditor()):new a.GridToolbar(this,this.editor.getEditor())},b.prototype.render=function(){this.getToolbar().render(),this.getImagePlace().html(""),this.getView().render()},b.prototype.getImagePlace=function(){return this.editor.getImagePlace()},b}();a.Page=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(){}return a.init=function(a,b,c){return 0==b.type()?this.initAction(a,b,c):1==b.type()?this.initDelegate(a,b,c):alert("GROUP!!!"),b},a.initAction=function(){},a.initDelegate=function(a,b,c){a.click(function(){return null!=c.UI().getActiveModule()&&c.UI().getActiveModule().deinit(),b.init(c.UI().showPopover(b.html())),c.UI().setActiveModule(b),!1})},a}();a.ModuleInitialization=b}(UI||(UI={}));var UI;!function(a){var b=function(){function b(a,b,c){var d=this;this.$el=a,this.editor=b,this.images=c,this.page=null,this.activeModule=null,this.$el.html(nunjucks.render("editor.html.njs",{}));var e=this.$el.find("#rsFileInput");e.on("change",function(){b.getLoader().load(this.files)}),this.$el.on("click","#t-button__upload",function(){return e.trigger("click"),!1}),this.$el.on("click",".rs-image-block, .rs-image-data__inf",function(a){d.editImage($(a.target).closest(".rs-image").data("id"))}),this.$el.on("click","#t-button__back",function(){return d.back(),!1}),this.$el.on("click",".rs-image-selection-checkbox",function(a){d.selectImage($(a.target).closest(".rs-image"))}),this.$toolbarPlace=this.$el.find("#rsToolbarPlace"),this.$popOver=this.$el.find("#rsPopover"),this.$imagePlace=this.$el.find("#rsImagePlace")}return b.prototype.initModule=function(b,c){a.ModuleInitialization.init(b,c,this.editor)},b.prototype.getActiveModule=function(){return this.activeModule},b.prototype.setActiveModule=function(a){this.activeModule=a},b.prototype.initToolbar=function(a){var b=this;a.find("#t-button__redo").click(function(){return b.redo(),!1}),a.find("#t-button__undo").click(function(){return b.undo(),!1})},b.prototype.getView=function(){return this.getPage().getView()},b.prototype.redo=function(){var a=this,b=[];this.selected().forEach(function(a){b.push(a.getActionDispatcher().redo())}),Promise.all(b).then(function(){a.getPage().getView().render()})},b.prototype.undo=function(){var a=this,b=[];this.selected().forEach(function(a){b.push(a.getActionDispatcher().undo())}),Promise.all(b).then(function(){a.getPage().getView().render();

})},b.prototype.showPopover=function(a){return this.$popOver.html(a),this.$popOver.show(),this.$popOver},b.prototype.back=function(){this.page.hasParent()&&(this.page=this.page.getParent(),this.render())},b.prototype.getImagePlace=function(){return this.$imagePlace},b.prototype.getToolbarPlace=function(){return this.$toolbarPlace},b.prototype.selected=function(){return this.getPage().getView().selected()},b.prototype.getEditor=function(){return this.editor},b.prototype.getPage=function(){return null==this.page&&(this.page=new a.Page(this,this.images)),this.page},b.prototype.getType=function(){return this.getPage().getView().type()},b.prototype.render=function(){this.getPage().render()},b.prototype.editImage=function(b){var c=this.images.getImage(b);this.page=new a.Page(this,c,this.page),this.render()},b.prototype.selectImage=function(a){a.hasClass("rs-image-selected")?a.removeClass("rs-image-selected"):a.addClass("rs-image-selected")},b}();a.Editor=b}(UI||(UI={}));var Core;!function(a){!function(a){a[a.SINGLE=0]="SINGLE",a[a.GRID=1]="GRID",a[a.ANY=2]="ANY"}(a.ModuleViewType||(a.ModuleViewType={}));var b=(a.ModuleViewType,function(){function a(a){this.editor=a,this.modules={},this.registerModule("resize",new Modules.ResizeModule(this.editor),2),this.registerModule("color",new Modules.ColorModule(this.editor),2),this.registerModule("crop",new Modules.CropModule(this.editor),2)}return a.prototype.registerModule=function(a,b,c){a in this.modules||(this.modules[a]={module:b,type:c})},a.prototype.getModule=function(a){if(a in this.modules)return this.modules[a].module;throw new Error("Invalid module name")},a.prototype.getModules=function(a,b){return void 0===a&&(a=2),void 0===b&&(b=null),_.map(this.modules,function(c){return c.type!=a&&2!=a&&2!=c.type||c.module.parent()!=b?void 0:c.module})},a}());a.ModuleManager=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(a){this.editor=a}return b.prototype.load=function(a){var b=this,c=0,d=new Promise(function(d){var e=setInterval(function(){if(c<a.length){var f=!1;c==a.length-1&&(f=!0),b.loadFile(a[c],d,f),c++}else clearInterval(e)},100)});d.then(function(){b.editor.UI().render()})},b.prototype.loadFile=function(b,c,d){var e=this;if(!b.type.match(/image.*/))return!1;var f=new FileReader;f.onload=function(f){var g=new a.RsImage(b.name,b.type);g.create(f.target.result).then(function(a){e.editor.appendImage(a),d&&c(1)})},f.readAsDataURL(b)},b}();a.ImageLoader=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(b){this.imageManager=new a.ImageManager,this.ui=new UI.Editor(b,this,this.imageManager.newCollection([])),this.moduleManager=new a.ModuleManager(this),this.loader=new a.ImageLoader(this),this.ui.render()}return b.prototype.UI=function(){return this.ui},b.prototype.getModuleManager=function(){return this.moduleManager},b.prototype.appendImage=function(a){this.ui.getPage().appendImage(a)},b.prototype.getLoader=function(){return this.loader},b.prototype.getImageManager=function(){return this.imageManager},b}();a.RsImageEditor=b}(Core||(Core={}));var UI;!function(a){var b;!function(a){var b=function(){function a(){this.events={}}return a.prototype.on=function(a,b,c){void 0===c&&(c="_"),_.has(this.events,a)||(this.events[a]={}),_.has(this.events[a],c)||(this.events[a][c]=[]),this.events[a][c].push(b)},a.prototype.off=function(a){var b=this;void 0===a&&(a="_"),_.map(this.events,function(c,d){b.events[d]=_.omit(c,a)})},a.prototype.trigger=function(a,b){var c=this;void 0===b&&(b=null),_.has(this.events,a)&&_.map(this.events[a],function(a){a.forEach(function(a){a({data:b,widget:c})})})},a}();a.RsWidget=b}(b=a.Widgets||(a.Widgets={}))}(UI||(UI={}));var UI;!function(a){var b;!function(a){var b=function(a){function b(b,c,d,e,f){var g=this;void 0===e&&(e=1),void 0===f&&(f=0),a.call(this),this.$el=b,this.min=c,this.max=d,this.step=e,this.start=f,this.$slider=$('<div class="rs-slider-handle"></div>'),this.$el.html(""),this.$el.addClass("rs-slider"),this.$el.append(this.$slider),this.$slider.css("left",this.getPixelPos(this.start)+"px");var h=$(document);this.$slider.mousedown(function(a){var b=a.clientX-parseInt(g.$slider.css("left"));h.on("mousemove.RsSlider",function(a){var c=a.clientX-b;0>c&&(c=0);var d=g.$el.width()-g.$slider.width();c>d&&(c=d),g.$slider.css("left",c+"px"),g.trigger("move",g.getVal(c))}),h.on("mouseup.RsSlider",function(){h.off(".RsSlider")})})}return __extends(b,a),b.prototype.getVal=function(a){return Math.round(a*((this.max-this.min)/this.step)/(this.$el.width()-this.$slider.width()))*this.step+this.min},b.prototype.getPixelPos=function(a){return(a-this.min)/this.step*(this.$el.width()-this.$slider.width())/((this.max-this.min)/this.step)},b}(a.RsWidget);a.RsSlider=b}(b=a.Widgets||(a.Widgets={}))}(UI||(UI={}));var Modules;!function(a){var b=function(){function b(a){this.editor=a}return b.prototype.html=function(){return nunjucks.render("color.dialog.html.njs",{})},b.prototype.init=function(a){var b=this;a.find(".m_color-ok").click(function(){return b.doAction(a.find(".m_color-brightness").val()),!1})},b.prototype.deinit=function(){},b.prototype.icon=function(){return"fa fa-image"},b.prototype.type=function(){return 1},b.prototype.parent=function(){return null},b.prototype.name=function(){return"resize"},b.prototype.doAction=function(b){var c=this,d=[];this.editor.UI().selected().forEach(function(c){var e=new a.BrightnessAction(c,b);d.push(c.getActionDispatcher().process(e))}),Promise.all(d).then(function(){c.editor.UI().getPage().getView().render()})},b}();a.ColorModule=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function a(a,b,c,d,e){this.image=a,this.left=b,this.top=c,this.width=d,this.height=e}return a.prototype.execute=function(){return this.image.save()},a.prototype.unExecute=function(){return this.image.save()},a}();a.CropAction=b}(Modules||(Modules={}));var UI;!function(a){var b;!function(a){var b=function(a){function b(b,c,d){a.call(this),this.$el=b,this.$parent=c,this.index=d,this.itemHalfSize=5,this.init()}return __extends(b,a),b.prototype.getElementCorners=function(){var a={x:this.$el.position().left,y:this.$el.position().top},b={x:a.x+this.$el.width(),y:a.y},c={x:a.x+this.$el.width(),y:a.y+this.$el.height()},d={x:a.x,y:a.y+this.$el.height()};return{topLeft:a,topRight:b,bottomRight:c,bottomLeft:d}},b.prototype.getPosition=function(){return this.position},b.prototype.getIndex=function(){return this.index},b.prototype.toPlace=function(){var a,b=this.getElementCorners();0==this.index?a=b.topLeft:1==this.index?a={x:b.topLeft.x+(b.topRight.x-b.topLeft.x)/2,y:b.topRight.y}:2==this.index?a=b.topRight:3==this.index?a={x:b.topRight.x,y:b.topRight.y+(b.bottomRight.y-b.topRight.y)/2}:4==this.index?a=b.bottomRight:5==this.index?a={x:b.topLeft.x+(b.topRight.x-b.topLeft.x)/2,y:b.bottomRight.y}:6==this.index?a=b.bottomLeft:7==this.index&&(a={x:b.topLeft.x,y:b.topRight.y+(b.bottomRight.y-b.topRight.y)/2}),this.position=a,this.$item.css({left:a.x-this.itemHalfSize+"px",top:a.y-this.itemHalfSize+"px"})},b.prototype.init=function(){var a=this;this.$item=$('<div class="rs-resizable-item item_'+this.index+'"></div>'),this.$parent.append(this.$item),this.toPlace();var b=$(document);this.$item.mousedown(function(c){var d=c.clientX-parseInt(a.$item.css("left"))-a.itemHalfSize,e=c.clientY-parseInt(a.$item.css("top"))-a.itemHalfSize;b.on("mousemove.RsResize_"+a.index,function(b){var c={x:b.clientX-d,y:b.clientY-e};a.moveItem(c),a.trigger("move",{index:a.index,newPosition:a.position,oldPosition:{x:d,y:e}})}),b.on("mouseup.RsResize_"+a.index,function(){b.off(".RsResize_"+a.index)})})},b.prototype.moveItem=function(a){var b=this.getElementCorners();(0==this.index||7==this.index||6==this.index)&&a.x>=b.topRight.x-10&&(a.x=b.topRight.x-10),(0==this.index||1==this.index||2==this.index)&&a.y>=b.bottomRight.y-10&&(a.y=b.bottomRight.y-10),this.$item.css(1==this.index||5==this.index?{top:a.y-5+"px"}:7==this.index||3==this.index?{left:a.x-5+"px"}:{left:a.x-5+"px",top:a.y-5+"px"}),this.position={x:parseInt(this.$item.css("left"))+5,y:parseInt(this.$item.css("top"))+5}},b}(a.RsWidget),c=function(a){function c(c,d){var e=this;a.call(this),this.$el=c,this.$parent=d,this.items=[],this.$el.addClass("rs-resizable");for(var f=0;8>f;f++){var g=new b(this.$el,this.$parent,f);this.items.push(g),g.on("move",function(a){e.onItemMove(a.data.index,a.data.newPosition,a.data.oldPosition)})}var h=$(document);this.$el.mousedown(function(a){var b=a.clientX-parseInt(e.$el.css("left")),c=a.clientY-parseInt(e.$el.css("top"));h.on("mousemove.RsResize",function(a){var d={x:a.clientX-b,y:a.clientY-c};e.$el.css({left:d.x,top:d.y}),e.updateItems()}),h.on("mouseup.RsResize",function(){h.off(".RsResize")})})}return __extends(c,a),c.prototype.onItemMove=function(a,b){0==a?(this.$el.css({left:b.x+"px",top:b.y+"px",width:this.items[4].getPosition().x-b.x+"px",height:this.items[4].getPosition().y-b.y+"px"}),this.updateItems([4])):1==a?(this.$el.css({top:b.y+"px",height:this.items[4].getPosition().y-b.y+"px"}),this.updateItems([4])):2==a?(this.$el.css({right:b.x+"px",top:b.y+"px",width:b.x-this.items[6].getPosition().x+"px",height:this.items[6].getPosition().y-b.y+"px"}),this.updateItems([6])):3==a?(this.$el.css({right:b.x+"px",width:b.x-this.items[6].getPosition().x+"px"}),this.updateItems([6])):4==a?(this.$el.css({right:b.x+"px",bottom:b.y+"px",width:b.x-this.items[0].getPosition().x+"px",height:b.y-this.items[0].getPosition().y+"px"}),this.updateItems([0])):5==a?(this.$el.css({bottom:b.y+"px",height:b.y-this.items[0].getPosition().y+"px"}),this.updateItems([0])):6==a?(this.$el.css({left:b.x+"px",bottom:b.y+"px",width:this.items[2].getPosition().x-b.x+"px",height:b.y-this.items[2].getPosition().y+"px"}),this.updateItems([2])):7==a&&(this.$el.css({left:b.x+"px",width:this.items[2].getPosition().x-b.x+"px"}),this.updateItems([2]))},c.prototype.getBounds=function(){return{width:this.$el.width(),height:this.$el.height(),left:this.items[0].getPosition().x,top:this.items[0].getPosition().y}},c.prototype.updateItems=function(a){void 0===a&&(a=[]),this.trigger("resize",{width:this.$el.width(),height:this.$el.height(),left:this.items[0].getPosition().x,top:this.items[0].getPosition().y}),this.items.forEach(function(b){_.contains(a,b.getIndex())||b.toPlace()})},c}(a.RsWidget);a.RsResizable=c}(b=a.Widgets||(a.Widgets={}))}(UI||(UI={}));var Modules;!function(a){var b=function(){function a(a){this.editor=a,this.view=null}return a.prototype.html=function(){return nunjucks.render("crop.dialog.html.njs",{})},a.prototype.deinit=function(){null!=this.view&&(this.$cropRect.remove(),this.view.getAreaElement().find(".rs-resizable-item").remove())},a.prototype.init=function(){var a=this;0==this.editor.UI().getType()&&(this.view=this.editor.UI().getView(),this.$cropRect=$('<div class="crop-rect"></div>'),this.view.getAreaElement().append(this.$cropRect),this.cropResizableWidget=new UI.Widgets.RsResizable(this.$cropRect,this.view.getAreaElement()),$("#crop_ok").click(function(){var b=a.cropResizableWidget.getBounds();a.doAction(b.left,b.top,b.width,b.height)}))},a.prototype.icon=function(){return"fa fa-crop"},a.prototype.type=function(){return 1},a.prototype.parent=function(){return null},a.prototype.name=function(){return"crop"},a.prototype.doAction=function(){},a}();a.CropModule=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function a(a,b,c){this.image=a,this.width=b,this.height=c}return a.prototype.execute=function(){return this.oldWidth=this.image.getWidth(),this.oldHeight=this.image.getHeight(),this.image.width=this.width,this.image.height=this.height,this.image.save()},a.prototype.unExecute=function(){return this.image.width=this.oldWidth,this.image.height=this.oldHeight,this.image.save()},a}();a.ResizeAction=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function b(a){this.editor=a}return b.prototype.html=function(){return nunjucks.render("resize.dialog.html.njs",{})},b.prototype.deinit=function(){},b.prototype.init=function(a){var b=this;a.find(".m_resize-ok").click(function(){return b.doAction(a.find(".m_resize-width").val(),a.find(".m_resize-height").val()),!1})},b.prototype.icon=function(){return"fa fa-expand"},b.prototype.type=function(){return 1},b.prototype.parent=function(){return null},b.prototype.name=function(){return"resize"},b.prototype.doAction=function(b,c){var d=this,e=[];this.editor.UI().selected().forEach(function(d){var f=new a.ResizeAction(d,b,c);e.push(d.getActionDispatcher().process(f))}),Promise.all(e).then(function(){d.editor.UI().getPage().getView().render()})},b}();a.ResizeModule=b}(Modules||(Modules={}));