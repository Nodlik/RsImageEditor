eval(function(a,b,c,d,e,f){if(e=function(a){return(b>a?"":e(parseInt(a/b)))+((a%=b)>35?String.fromCharCode(a+29):a.toString(36))},!"".replace(/^/,String)){for(;c--;)f[e(c)]=d[c]||e(c);d=[function(a){return f[a]}],e=function(){return"\\w+"},c=1}for(;c--;)d[c]&&(a=a.replace(new RegExp("\\b"+e(c)+"\\b","g"),d[c]));return a}('(A(){M $,4K,2h,2L,D,4R,41,1W,2P,6y,Q,2I,5w,34,1Y,3K,1X,2s,1N,7K,2X,1w,fs,7J,4V,8L,6h=[].ew||A(a1){X(M i=0,l=o.T;i<l;i++){B(i 4Q o&&o[i]===a1)u i}u-1},5P=[].4V,6t={}.en,9K=A(fn,aY){u A(){u fn.4l(aY,1o)}},bd=A(66,5i){X(M 2o 4Q 5i){B(6t.1z(5i,2o))66[2o]=5i[2o]}A 94(){o.dV=66}94.N=5i.N;66.N=1G 94();66.dS=5i.N;u 66};7J=[\'bQ\',\'9H\'];3K=(A(){A 3K(){}3K["dN"]=A(2A){M 2o,4g,K;X(2o 4Q 2A){4g=2A[2o];B(6h.1z(7J,2o)<0){o[2o]=4g}}B((K=2A.bQ)!=L){K.4l(o)}u o};3K.dL=A(2A){M 2o,4g,K;X(2o 4Q 2A){4g=2A[2o];B(6h.1z(7J,2o)<0){o.N[2o]=4g}}B((K=2A.9H)!=L){K.4l(o)}u o};3K.dK=A(){M 1k,78,39,I,1m,1l;1k=1<=1o.T?5P.1z(1o,0):[];39=1k.9C();1l=[];X(I=0,1m=1k.T;I<1m;I++){78=1k[I];1l.2q(o.N[78]=39.N[78])}u 1l};3K.cQ=A(4m,59){M 1M=o;u o.N[4m]=A(){M 1k;1k=1<=1o.T?5P.1z(1o,0):[];u 1M.N[59].4l(1M,1k)}};3K.ev=A(4m,59){u cR.cS(o.N,4m,{4D:A(){u o[59]},cT:A(28){u o[59]=28}})};3K.9H=A(52){u 52.1z(o,o.N)};u 3K})();4V=6k.N.4V;$=A(82,83){B(83==L){83=1Z}B(1x 82==="3W"||(1x 2e!=="42"&&2e!==L)){u 82}u 83.d5(82)};1w=(A(){A 1w(){}1w.8p=(A(){M 2H;2H=0;u{4D:A(){u 2H++}}})();1w.8c=A(){M 6g,84,2A,6n,1I,I,1m;2A=1o[0],1I=2<=1o.T?5P.1z(1o,1):[];84=2A;X(I=0,1m=1I.T;I<1m;I++){6g=1I[I];X(6n 4Q 6g){B(!6t.1z(6g,6n))5T;84[6n]=6g[6n]}}u 84};1w.3A=A(28){B(28<0){u 0}B(28>E){u E}u 28};1w.5m=A(59,4m,G){M 6G,I,1m,K,2R,1l;B(G==L){G={}}K=59.dq;1l=[];X(I=0,1m=K.T;I<1m;I++){6G=K[I];B((G.8W!=L)&&(2R=6G.91,6h.1z(G.8W,2R)>=0)){5T}1l.2q(4m.cd(6G.91,6G.dG))}u 1l};1w.6j=A(T){B(T==L){T=0}B(D.2J||(4x.cl!=L)){u 1G cl(T)}u 1G 6k(T)};u 1w})();B(1x 2e!=="42"&&2e!==L){7K=2e;41=7L(\'H\');5w=41.5w;6y=7L(\'eO\');fs=7L(\'fs\')}S{7K=4x}D=(A(bF){bd(D,bF);D.8D={bp:"4.1.2",bn:"7/27/eQ"};D.ba=2r;D.6a=2Y;D.8B="aB";D.8a="";D.cH="eT";D.2J=1x 2e!=="42"&&2e!==L;D.ct=!D.2J;D.5o=A(){u"eY "+D.8D.bp+", f0 "+D.8D.bn};D.8n=A(H){B(D.2J){u 2Y}B(1x H==="3F"){H=$(H)}B(!((H!=L)&&(H.61!=L))){u L}u H.61(\'2b-3E-2H\')};A D(){o.6r=9K(o.6r,o);M 1k,2z,2H,1M=o;B(1o.T===0){38"7V 1o";}B(o f5 D){o.5z=o.5z.8C(o);o.6C=o.6C.8C(o);1k=1o[0];B(!D.2J){2H=3R(D.8n(1k[0]),10);2z=1x 1k[1]==="A"?1k[1]:1x 1k[2]==="A"?1k[2]:A(){};B(!cA(2H)&&2X.cm(2H)){u 2X.3P(2H,2z)}}o.2H=1w.8p.4D();o.7P=o.58=L;o.6u={x:0,y:0};o.c4=2r;o.7H=2r;o.6f=[];o.8P=[];o.8S=[];o.6b=L;o.c3=2r;o.fB=1G 4K(o);o.4t=1G 1N(o);o.bq(A(){1M.b4(1k);u 1M.aV()});u o}S{u 1G D(1o)}}D.N.bq=A(cb){M 9h,1M=o;B(D.2J){u 7u(A(){u cb.1z(1M)},0)}S{B(1Z.9j==="7t"){1Y.2v("ar bD");u 7u(A(){u cb.1z(1M)},0)}S{9h=A(){B(1Z.9j==="7t"){1Y.2v("ar bD");u cb.1z(1M)}};u 1Z.c0("gb",9h,2r)}}};D.N.b4=A(1k){M 2o,28,K,1l;B(1k.T===0){38"7V 1o cI";}o.3B=L;o.6S=L;o.73=L;o.2z=A(){};o.be(1k[0]);B(1k.T===1){u}65(1x 1k[1]){2f"3F":o.73=1k[1];4Y;2f"A":o.2z=1k[1]}B(1k.T===2){u}o.2z=1k[2];B(1k.T===4){K=1k[4];1l=[];X(2o 4Q K){B(!6t.1z(K,2o))5T;28=K[2o];1l.2q(o.1K[2o]=28)}u 1l}};D.N.be=A(2A){B(D.2J){o.3B=2A;o.6S=\'bM\';u}B(1x 2A==="3W"){o.3B=2A}S{o.3B=$(2A)}B(o.3B==L){38"g8 g7 g2 1e b7 H X g0.";}u o.6S=o.3B.91.6m()};D.N.aV=A(){65(o.6S){2f"bM":u o.bI();2f"1F":u o.bO();2f"H":u o.bU()}};D.N.bI=A(){1Y.2v("fY X 2J");B(1x o.3B==="3F"){u fs.fW(o.3B,o.6r)}S{u o.6r(L,o.3B)}};D.N.6r=A(9k,2b){B(9k){38 9k;}o.1e=1G 5w();o.1e.1I=2b;1Y.2v("5w ce. cL = "+(o.5f())+", aN = "+(o.5e()));o.H=1G 41(o.5f(),o.5e());u o.5z()};D.N.bO=A(){o.1e=o.3B;o.H=1Z.3c(\'H\');o.1i=o.H.3b(\'2d\');1w.5m(o.1e,o.H,{8W:[\'1I\']});o.1e.9g.9f(o.H,o.1e);o.9e();u o.9d()};D.N.bU=A(){o.H=o.3B;o.1i=o.H.3b(\'2d\');B(o.73!=L){o.1e=1Z.3c(\'1F\');o.1e.1I=o.73;o.9e();u o.9d()}S{u o.5z()}};D.N.9e=A(){B(o.9c()){1Y.2v(o.1e.1I,"->",o.7v());o.ci=2Y;o.1e.1I=o.7v()}B(2I.cB(o.1e)){o.1e.1I=2I.5c(o.1e.1I);u 1Y.2v("fL 1e fK, fI as = "+o.1e.1I)}};D.N.9d=A(){B(o.at()){u o.6C()}S{u o.1e.ax=o.6C}};D.N.at=A(){B(!o.1e.7t){u 2r}B((o.1e.99!=L)&&o.1e.99===0){u 2r}u 2Y};D.N.5f=A(){u o.1e.F||o.1e.99};D.N.5e=A(){u o.1e.J||o.1e.fH};D.N.6C=A(){1Y.2v("5w ce. cL = "+(o.5f())+", aN = "+(o.5e()));B(o.ci){o.H.F=o.5f()/o.7x();o.H.J=o.5e()/o.7x()}S{o.H.F=o.5f();o.H.J=o.5e()}u o.5z()};D.N.5z=A(){M i,1t,I,1m,K;B(o.1i==L){o.1i=o.H.3b(\'2d\')}o.5b=o.6M=o.F=o.H.F;o.5D=o.6l=o.J=o.H.J;o.bP();B(!o.bS()){o.bT()}B(o.1e!=L){o.1i.5H(o.1e,0,0,o.5f(),o.5e(),0,0,o.6M,o.6l)}o.2x=o.1i.44(0,0,o.H.F,o.H.J);o.R=o.2x.2b;B(D.6a){o.7P=1w.6j(o.R.T);o.58=1w.6j(o.R.T);K=o.R;X(i=I=0,1m=K.T;I<1m;i=++I){1t=K[i];o.7P[i]=1t;o.58[i]=1t}}o.1c={F:o.H.F,J:o.H.J};B(!D.2J){2X.c5(o.2H,o)}o.2z.1z(o,o);u o.2z=A(){}};D.N.c6=A(){o.2x=o.1i.44(0,0,o.H.F,o.H.J);u o.R=o.2x.2b};D.N.fy=A(){M i,1t,I,1m,K,1l;B(!D.6a){38"97 7y";}o.58=1w.6j(o.R.T);K=o.R;1l=[];X(i=I=0,1m=K.T;I<1m;i=++I){1t=K[i];1l.2q(o.58[i]=1t)}u 1l};D.N.bS=A(){u D.8n(o.H)!=L};D.N.bT=A(){B(D.2J||o.H.61(\'2b-3E-2H\')){u}u o.H.cd(\'2b-3E-2H\',o.2H)};D.N.cf=A(){u o.H.61(\'2b-3E-cg-7y\')!==L};D.N.bP=A(){M 4f;B(D.2J||!o.9c()){u}4f=o.7x();B(4f!==1){1Y.2v("fx 4f = "+4f);o.c3=2Y;o.6M=o.H.F;o.6l=o.H.J;o.H.F=o.6M*4f;o.H.J=o.6l*4f;o.H.cx.F=""+o.6M+"cz";o.H.cx.J=""+o.6l+"cz";o.1i.fr(4f,4f);o.F=o.5b=o.H.F;u o.J=o.5D=o.H.J}};D.N.7x=A(){M 93,4h;4h=4x.4h||1;93=o.1i.fq||o.1i.fo||o.1i.fj||o.1i.fh||o.1i.fg||1;u 4h/93};D.N.aw=A(){u(4x.4h!=L)&&4x.4h!==1};D.N.9c=A(){B(o.cf()||!o.aw()){u 2r}u o.7v()!==L};D.N.7v=A(){B(o.1e==L){u L}u o.1e.61(\'2b-3E-cg\')};D.N.6i=A(az){M 7A;7A=o.H;o.H=az;o.1i=o.H.3b(\'2d\');B(!D.2J){7A.9g.9f(o.H,7A)}o.F=o.H.F;o.J=o.H.J;o.c6();u o.1c={F:o.H.F,J:o.H.J}};D.N.aQ=A(2z){M 1M=o;B(2z==L){2z=A(){}}2P.5a(o,"aX");u o.4t.3P(A(){1M.1i.7B(1M.2x,0,0);u 2z.1z(1M)})};D.N.ff=A(7C){M i,1t,I,1m,K;B(7C==L){7C=2Y}B(!D.6a){38"97 7y";}K=o.bg();X(i=I=0,1m=K.T;I<1m;i=++I){1t=K[i];o.R[i]=1t}B(7C){u o.1i.7B(o.2x,0,0)}};D.N.f9=A(){M H,1R,i,2x,1t,R,I,1m,K;H=1Z.3c(\'H\');1w.5m(o.H,H);H.F=o.5b;H.J=o.5D;1R=H.3b(\'2d\');2x=1R.44(0,0,H.F,H.J);R=2x.2b;K=o.7P;X(i=I=0,1m=K.T;I<1m;i=++I){1t=K[i];R[i]=1t}1R.7B(2x,0,0);o.6u={x:0,y:0};o.7H=2r;u o.6i(H)};D.N.bg=A(){M H,7D,1R,8U,8T,i,2x,1t,R,Y,6E,7E,7G,F,I,1n,1m,K,2R,46,8M;B(!D.6a){38"97 7y";}Y=[];7E=o.6u.x;8U=7E+o.F;7G=o.6u.y;8T=7G+o.J;B(o.7H){H=1Z.3c(\'H\');H.F=o.5b;H.J=o.5D;1R=H.3b(\'2d\');2x=1R.44(0,0,H.F,H.J);R=2x.2b;K=o.58;X(i=I=0,1m=K.T;I<1m;i=++I){1t=K[i];R[i]=1t}1R.7B(2x,0,0);6E=1Z.3c(\'H\');6E.F=o.F;6E.J=o.J;1R=6E.3b(\'2d\');1R.5H(H,0,0,o.5b,o.5D,0,0,o.F,o.J);R=1R.44(0,0,o.F,o.J).2b;F=o.F}S{R=o.58;F=o.5b}X(i=1n=0,2R=R.T;1n<2R;i=1n+=4){7D=1X.c1(i,F);B(((7E<=(46=7D.x)&&46<8U))&&((7G<=(8M=7D.y)&&8M<8T))){Y.2q(R[i],R[i+1],R[i+2],R[i+3])}}u Y};D.N.2j=A(1q,7I){o.4t.5Y({1r:Q.3h.8J,1q:1q,7I:7I});u o};D.N.3G=A(1q,P,2Q,3e){M i,I,K;B(2Q==L){2Q=L}B(3e==L){3e=0}B(2Q==L){2Q=0;X(i=I=0,K=P.T;0<=K?I<K:I>K;i=0<=K?++I:--I){2Q+=P[i]}}o.4t.5Y({1r:Q.3h.8H,1q:1q,P:P,2Q:2Q,3e:3e});u o};D.N.56=A(4i,1k){o.4t.5Y({1r:Q.3h.2s,4i:4i,1k:1k});u o};D.N.2Z=A(2z){M 2c;2c=1G 34(o);o.8S.2q(2c);o.4t.5Y({1r:Q.3h.8G});2z.1z(2c);o.4t.5Y({1r:Q.3h.8E});u o};D.N.cN=A(2c){u o.9S(2c)};D.N.9S=A(2c){o.8P.2q(o.6b);o.6f.2q(o.R);o.6b=2c;u o.R=2c.R};D.N.a3=A(){o.R=o.6f.9C();u o.6b=o.8P.9C()};D.N.a4=A(){u o.6b.a5()};u D})(3K);7K.D=D;D.4K=(A(){A 4K(c){o.c=c}4K.N.f6=A(){M i,3x,6H,I,1n,1u,K;3x={r:{},g:{},b:{}};X(i=I=0;I<=E;i=++I){3x.r[i]=0;3x.g[i]=0;3x.b[i]=0}X(i=1n=0,K=o.c.R.T;1n<K;i=1n+=4){3x.r[o.c.R[i]]++;3x.g[o.c.R[i+1]]++;3x.b[o.c.R[i+2]]++}6H=o.c.R.T/4;X(i=1u=0;1u<=E;i=++1u){3x.r[i]/=6H;3x.g[i]/=6H;3x.b[i]/=6H}u 3x};u 4K})();4K=D.4K;D.8y=A(){M 1F,6d,aO,I,1m,1l;6d=1Z.f4("1F[2b-3E]");B(!(6d.T>0)){u}1l=[];X(I=0,1m=6d.T;I<1m;I++){1F=6d[I];1l.2q(aO=1G 4R(1F,A(){o.aR();u o.3P()}))}u 1l};B(D.ct){(A(){B(1Z.9j==="7t"){u D.8y()}S{u 1Z.c0("f3",D.8y,2r)}})()}4R=(A(){M 7Z;7Z="(\\\\w+)\\\\((.*?)\\\\)";A 4R(4p,b5){o.b6=4p.61(\'2b-3E\');o.3E=D(4p,b5.8C(o))}4R.N.aR=A(){M 1k,e,1D,52,8t,8r,m,r,6w,I,1m,K,1l;o.4p=o.3E.H;r=1G bB(7Z,\'g\');6w=o.b6.8q(r);B(!(6w.T>0)){u}r=1G bB(7Z);1l=[];X(I=0,1m=6w.T;I<1m;I++){8t=6w[I];K=8t.8q(r),m=K[0],1D=K[1],1k=K[2];8r=1G f2("u A() {        o."+1D+"("+1k+");      };");8o{52=8r();1l.2q(52.1z(o.3E))}8k(5W){e=5W;1l.2q(1Y.2v(e))}}u 1l};4R.N.3P=A(){M 4p;4p=o.4p;u o.3E.aQ(A(){u 4p.9g.9f(o.bR(),4p)})};u 4R})();D.2h=(A(){A 2h(){}2h.8m={};2h.V=A(1q,52){u o.8m[1q]=52};2h.3P=A(1q,Z,W){u o.8m[1q](Z,W)};u 2h})();2h=D.2h;D.2L=(A(){A 2L(){}2L.4Z=A(4k,4j,4E,4B){u O.8e(O.1E(4E-4k,2)+O.1E(4B-4j,2))};2L.ca=A(2m,1f,6z){M 4n;B(6z==L){6z=2r}4n=2m+(O.eX()*(1f-2m));B(6z){u 4n.eW(6z)}S{u O.8d(4n)}};2L.6I=A(C){u(0.8s*C.r)+(0.eV*C.g)+(0.eU*C.b)};2L.1T=A(1L,3H,3I,1v,86,85){M 8u,8v,81,7Y,6p,6q,1T,8x,4U,i,j,5Q,7W,t,6x,4k,4E,8z,6A,4j,4B,8A,I,1n,1u,K,2R;6x=1L[0];6A=1L[1];4k=3H[0];4j=3H[1];4E=3I[0];4B=3I[1];8z=1v[0];8A=1v[1];1T={};6p=3R(3*(4k-6x),10);81=3*(4E-4k)-6p;8u=8z-6x-6p-81;6q=3*(4j-6A);7Y=3*(4B-4j)-6q;8v=8A-6A-6q-7Y;X(i=I=0;I<aS;i=++I){t=i/aS;8x=O.8d((8u*O.1E(t,3))+(81*O.1E(t,2))+(6p*t)+6x);4U=O.8d((8v*O.1E(t,3))+(7Y*O.1E(t,2))+(6q*t)+6A);B(86&&4U<86){4U=86}S B(85&&4U>85){4U=85}1T[8x]=4U}B(1T.T<1v[0]+1){X(i=1n=0,K=1v[0];0<=K?1n<=K:1n>=K;i=0<=K?++1n:--1n){B(1T[i]==L){5Q=[i-1,1T[i-1]];X(j=1u=i,2R=1v[0];i<=2R?1u<=2R:1u>=2R;j=i<=2R?++1u:--1u){B(1T[j]!=L){7W=[j,1T[j]];4Y}}1T[i]=5Q[1]+((7W[1]-5Q[1])/(7W[0]-5Q[0]))*(i-5Q[0])}}}B(1T[1v[0]]==L){1T[1v[0]]=1T[1v[0]-1]}u 1T};u 2L})();2L=D.2L;D.1W=(A(){A 1W(){}1W.7T=A(3J){M b,g,r;B(3J.eS(0)==="#"){3J=3J.4T(1)}r=3R(3J.4T(0,2),16);g=3R(3J.4T(2,2),16);b=3R(3J.4T(4,2),16);u{r:r,g:g,b:b}};1W.eR=A(r,g,b){M d,h,l,1f,2m,s;B(1x r==="3W"){g=r.g;b=r.b;r=r.r}r/=E;g/=E;b/=E;1f=O.1f(r,g,b);2m=O.2m(r,g,b);l=(1f+2m)/2;B(1f===2m){h=s=0}S{d=1f-2m;s=l>0.5?d/(2-1f-2m):d/(1f+2m);h=(A(){65(1f){2f r:u(g-b)/d+(g<b?6:0);2f g:u(b-r)/d+2;2f b:u(r-g)/d+4}})();h/=6}u{h:h,s:s,l:l}};1W.eP=A(h,s,l){M b,g,p,q,r;B(1x h==="3W"){s=h.s;l=h.l;h=h.h}B(s===0){r=g=b=l}S{q=l<0.5?l*(1+s):l+s-l*s;p=2*l-q;r=o.7R(p,q,h+1/3);g=o.7R(p,q,h);b=o.7R(p,q,h-1/3)}u{r:r*E,g:g*E,b:b*E}};1W.7R=A(p,q,t){B(t<0){t+=1}B(t>1){t-=1}B(t<1/6){u p+(q-p)*6*t}B(t<1/2){u q}B(t<2/3){u p+(q-p)*(2/3-t)*6}u p};1W.bw=A(r,g,b){M d,h,1f,2m,s,v;r/=E;g/=E;b/=E;1f=O.1f(r,g,b);2m=O.2m(r,g,b);v=1f;d=1f-2m;s=1f===0?0:d/1f;B(1f===2m){h=0}S{h=(A(){65(1f){2f r:u(g-b)/d+(g<b?6:0);2f g:u(b-r)/d+2;2f b:u(r-g)/d+4}})();h/=6}u{h:h,s:s,v:v}};1W.bC=A(h,s,v){M b,f,g,i,p,q,r,t;i=O.2O(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);65(i%6){2f 0:r=v;g=t;b=p;4Y;2f 1:r=q;g=v;b=p;4Y;2f 2:r=p;g=v;b=t;4Y;2f 3:r=p;g=q;b=v;4Y;2f 4:r=t;g=p;b=v;4Y;2f 5:r=v;g=p;b=q}u{r:O.2O(r*E),g:O.2O(g*E),b:O.2O(b*E)}};1W.bH=A(r,g,b){M x,y,z;r/=E;g/=E;b/=E;B(r>0.8I){r=O.1E((r+0.3j)/1.3j,2.4)}S{r/=12.92}B(g>0.8I){g=O.1E((g+0.3j)/1.3j,2.4)}S{g/=12.92}B(b>0.8I){b=O.1E((b+0.3j)/1.3j,2.4)}S{b/=12.92}x=r*0.eN+g*0.eM+b*0.eL;y=r*0.bV+g*0.bW+b*0.bX;z=r*0.eK+g*0.eJ+b*0.eI;u{x:x*1h,y:y*1h,z:z*1h}};1W.eH=A(x,y,z){M b,g,r;x/=1h;y/=1h;z/=1h;r=(3.eG*x)+(-1.eF*y)+(-0.eE*z);g=(-0.eD*x)+(1.eC*y)+(0.eB*z);b=(0.eA*x)+(-0.ez*y)+(1.ey*z);B(r>0.8R){r=(1.3j*O.1E(r,0.9a))-0.3j}S{r*=12.92}B(g>0.8R){g=(1.3j*O.1E(g,0.9a))-0.3j}S{g*=12.92}B(b>0.8R){b=(1.3j*O.1E(b,0.9a))-0.3j}S{b*=12.92}u{r:r*E,g:g*E,b:b*E}};1W.ck=A(x,y,z){M a,b,l,9b,9i,9n;B(1x x==="3W"){y=x.y;z=x.z;x=x.x}9b=95.cu;9i=1h.0;9n=9p.cy;x/=9b;y/=9i;z/=9n;B(x>0.9q){x=O.1E(x,0.9v)}S{x=(7.9w*x)+0.5I}B(y>0.9q){y=O.1E(y,0.9v)}S{y=(7.9w*y)+0.5I}B(z>0.9q){z=O.1E(z,0.9v)}S{z=(7.9w*z)+0.5I}l=cJ*y-16;a=cK*(x-y);b=5J*(y-z);u{l:l,a:a,b:b}};1W.ex=A(l,a,b){M x,y,z;B(1x l==="3W"){a=l.a;b=l.b;l=l.l}y=(l+16)/cJ;x=y+(a/cK);z=y-(b/5J);B(x>0.9y){x=x*x*x}S{x=0.9z*(x-0.5I)}B(y>0.9y){y=y*y*y}S{y=0.9z*(y-0.5I)}B(z>0.9y){z=z*z*z}S{z=0.9z*(z-0.5I)}u{x:x*95.cu,y:y*1h.0,z:z*9p.cy}};1W.cP=A(r,g,b){M 9A;B(1x r==="3W"){g=r.g;b=r.b;r=r.r}9A=o.bH(r,g,b);u o.ck(9A)};1W.eu=A(l,a,b){};u 1W})();1W=D.1W;D.2P=(A(){A 2P(){}2P.53={};2P.a6=["a9","aa","aX","ad","af","5O"];2P.5a=A(39,1r,2b){M 6o,I,1m,K,1l;B(2b==L){2b=L}B(o.53[1r]&&o.53[1r].T){K=o.53[1r];1l=[];X(I=0,1m=K.T;I<1m;I++){6o=K[I];B(6o.39===L||39.2H===6o.39.2H){1l.2q(6o.fn.1z(39,2b))}S{1l.2q(ao 0)}}u 1l}};2P.et=A(39,1r,fn){M 9B,9D;B(1x 39==="3F"){9D=39;9B=1r;39=L;1r=9D;fn=9B}B(6h.1z(o.a6,1r)<0){u 2r}B(!o.53[1r]){o.53[1r]=[]}o.53[1r].2q({39:39,fn:fn});u 2Y};u 2P})();2P=D.2P;D.Q=(A(){A Q(){}Q.3h={8J:1,8H:2,8G:3,8E:4,9G:5,2s:6};Q.V=A(1q,au){u D.N[1q]=au};u Q})();Q=D.Q;D.2I=(A(){A 2I(){}2I.av=/(?:(?:es|er):\\/\\/)((?:\\w+)\\.(?:(?:\\w|\\.)+))/;2I.cB=A(1F){B(1F==L){u 2r}B(o.ay(1F)){u 2r}u o.71(1F.1I)};2I.ay=A(1F){M K;u(1F.8B!=L)&&((K=1F.8B.6m())===\'aB\'||K===\'aA-eq\')};2I.71=A(aD){M 6Z;6Z=aD.8q(o.av);B(6Z){u 6Z[1]!==1Z.ep}S{u 2r}};2I.aP=A(1I){B(o.71(1I)){B(!D.8a.T){1Y.9J("eo 4m em a aT 1e el a ek aW. as: "+1I)}S{B(D.71(D.8a)){1Y.9J("ej aA a aT aW X ei eh.");u}u o.5c(1I)}}};2I.5c=A(1I){u""+D.8a+"?"+D.cH+"="+(eg(1I))};2I.ef=A(5g){M 6Q;6Q={ee:\'ed\',ec:\'eb\',ea:\'e9\',e8:\'e7\'};5g=5g.6m();B(6Q[5g]!=L){5g=6Q[5g]}u"e5/e4."+5g};u 2I})();D.N.br=A(){B(1x 2e!=="42"&&2e!==L){u o.bs.4l(o,1o)}S{u o.bt.4l(o,1o)}};D.N.bt=A(1r){M 1e;B(1r==L){1r="bu"}1r=1r.6m();1e=o.9M(1r).e3("1e/"+1r,"1e/e2-e1");u 1Z.e0.dZ=1e};D.N.bs=A(5X,6W){M e,9I;B(6W==L){6W=2Y}8o{9I=fs.dX(5X);B(9I.dW()&&!6W){u 2r}}8k(5W){e=5W;1Y.2v("dU dT 5X "+5X)}u fs.dR(5X,o.H.dQ(),A(){u 1Y.2v("dP dO 4m "+5X)})};D.N.bR=A(1r){M 1F;1F=1Z.3c(\'1F\');1F.1I=o.9M(1r);1F.F=o.1c.F;1F.J=o.1c.J;B(4x.4h){1F.F/=4x.4h;1F.J/=4x.4h}u 1F};D.N.9M=A(1r){B(1r==L){1r="bu"}1r=1r.6m();u o.H.dM("1e/"+1r)};2I=D.2I;D.34=(A(){A 34(c){o.c=c;o.1D=o.c;o.1K={9F:\'9E\',2g:1.0};o.dJ=1w.8p.4D();o.H=1x 2e!=="42"&&2e!==L?1G 41():1Z.3c(\'H\');o.H.F=o.c.1c.F;o.H.J=o.c.1c.J;o.1i=o.H.3b(\'2d\');o.1i.dI(o.H.F,o.H.J);o.2x=o.1i.44(0,0,o.H.F,o.H.J);o.R=o.2x.2b}34.N.2Z=A(cb){u o.c.2Z.1z(o.c,cb)};34.N.3y=A(bZ){o.1K.9F=bZ;u o};34.N.2g=A(2g){o.1K.2g=2g/1h;u o};34.N.43=A(){M i,2W,I,K;2W=o.c.R;X(i=I=0,K=o.c.R.T;I<K;i=I+=4){o.R[i]=2W[i];o.R[i+1]=2W[i+1];o.R[i+2]=2W[i+2];o.R[i+3]=2W[i+3]}u o};34.N.4r=A(){u o.c.4r.4l(o.c,1o)};34.N.dH=A(1e){B(1x 1e==="3W"){1e=1e.1I}S B(1x 1e==="3F"&&1e[0]==="#"){1e=$(1e).1I}B(!1e){u o}o.c.4t.6e.2q({1r:Q.3h.9G,1I:1e,2c:o});u o};34.N.a5=A(){M i,51,2W,1H,Z,W,I,K,1l;2W=o.c.6f[o.c.6f.T-1];51=o.c.R;1l=[];X(i=I=0,K=51.T;I<K;i=I+=4){W={r:2W[i],g:2W[i+1],b:2W[i+2],a:2W[i+3]};Z={r:51[i],g:51[i+1],b:51[i+2],a:51[i+3]};1H=2h.3P(o.1K.9F,Z,W);1H.r=1w.3A(1H.r);1H.g=1w.3A(1H.g);1H.b=1w.3A(1H.b);B(1H.a==L){1H.a=Z.a}2W[i]=W.r-((W.r-1H.r)*(o.1K.2g*(1H.a/E)));2W[i+1]=W.g-((W.g-1H.g)*(o.1K.2g*(1H.a/E)));1l.2q(2W[i+2]=W.b-((W.b-1H.b)*(o.1K.2g*(1H.a/E))))}u 1l};u 34})();34=D.34;D.7g=(A(){A 7g(){M 1q,I,1m,K;K=[\'c8\',\'9J\',\'dF\',\'c9\'];X(I=0,1m=K.T;I<1m;I++){1q=K[I];o[1q]=(A(1q){u A(){M 1k,e;1k=1<=1o.T?5P.1z(1o,0):[];B(!D.ba){u}8o{u 9u[1q].4l(9u,1k)}8k(5W){e=5W;u 9u[1q](1k)}}})(1q)}o.2v=o.c8}u 7g})();1Y=1G D.7g();D.1X=(A(){1X.9t=A(x,y,F){u(y*F+x)*4};1X.c1=A(U,F){M x,y;y=O.2O(U/(F*4));x=(U%(F*4))/4;u{x:x,y:y}};A 1X(r,g,b,a,c){o.r=r!=L?r:0;o.g=g!=L?g:0;o.b=b!=L?b:0;o.a=a!=L?a:E;o.c=c!=L?c:L;o.U=0}1X.N.9s=A(c){u o.c=c};1X.N.9r=A(){M x,y;B(o.c==L){38"5G a 5F 1i";}y=o.c.1c.J-O.2O(o.U/(o.c.1c.F*4));x=(o.U%(o.c.1c.F*4))/4;u{x:x,y:y}};1X.N.9o=A(U){B(o.c==L){38"5G a 5F 1i";}u 1G 1X(o.c.R[U],o.c.R[U+1],o.c.R[U+2],o.c.R[U+3],o.c)};1X.N.cj=A(7o,7p){M 3z;B(o.c==L){38"5G a 5F 1i";}3z=o.U+(o.c.1c.F*4*(7p*-1))+(4*7o);B(3z>o.c.R.T||3z<0){u 1G 1X(0,0,0,E,o.c)}u o.9o(3z)};1X.N.dE=A(7o,7p,C){M co;B(o.c==L){38"5G a 5F 1i";}co=o.U+(o.c.1c.F*4*(7p*-1))+(4*7o);B(3z>o.c.R.T||3z<0){u}o.c.R[3z]=C.r;o.c.R[3z+1]=C.g;o.c.R[3z+2]=C.b;o.c.R[3z+3]=C.a;u 2Y};1X.N.dD=A(x,y){M U;B(o.c==L){38"5G a 5F 1i";}U=o.9t(x,y,o.F);u o.9o(U)};1X.N.dC=A(x,y,C){M U;B(o.c==L){38"5G a 5F 1i";}U=o.9t(x,y,o.F);o.c.R[U]=C.r;o.c.R[U+1]=C.g;o.c.R[U+2]=C.b;u o.c.R[U+3]=C.a};1X.N.5o=A(){u o.dB()};1X.N.dA=A(7s){M 3J;B(7s==L){7s=2r}3J=\'#\'+o.r.5o(16)+o.g.5o(16)+o.b.5o(16);B(7s){u 3J+o.a.5o(16)}S{u 3J}};u 1X})();1X=D.1X;D.2s=(A(){A 2s(){}2s.9m={};2s.V=A(1q,4i){u o.9m[1q]=4i};2s.3P=A(1i,1q,1k){u o.9m[1q].4l(1i,1k)};u 2s})();2s=D.2s;D.1N=(A(){1N.4F=D.2J?7L(\'dz\').dy().T:4;A 1N(c){o.c=c;o.4b=9K(o.4b,o);o.6e=[];o.4W=L}1N.N.5Y=A(98){B(98==L){u}u o.6e.2q(98)};1N.N.4b=A(){M 2c;B(o.6e.T===0){2P.5a(o,"ad");B(o.96!=L){o.96.1z(o.c)}u o}o.29=o.6e.cC();65(o.29.1r){2f Q.3h.8G:2c=o.c.8S.cC();o.c.cN(2c);u o.4b();2f Q.3h.8E:o.c.a4();o.c.a3();u o.4b();2f Q.3h.9G:u o.cD(o.29.2c,o.29.1I);2f Q.3h.2s:u o.cE();dx:u o.cG()}};1N.N.3P=A(2z){o.96=2z;o.4W=1w.6j(o.c.R.T);u o.4b()};1N.N.8Z=A(fn){M 68,8Y,2U,1v,f,i,8V,n,1L,I,K,1l,1M=o;o.7F=0;n=o.c.R.T;8Y=O.2O((n/4)/1N.4F);68=8Y*4;8V=68+((n/4)%1N.4F)*4;1l=[];X(i=I=0,K=1N.4F;0<=K?I<K:I>K;i=0<=K?++I:--I){1L=i*68;1v=1L+(i===1N.4F-1?8V:68);B(D.2J){f=6y(A(){u fn.1z(1M,i,1L,1v)});2U=f.dw();1l.2q(o.5O(2U))}S{1l.2q(7u((A(i,1L,1v){u A(){u fn.1z(1M,i,1L,1v)}})(i,1L,1v),0))}}u 1l};1N.N.cG=A(){2P.5a(o.c,"a9",o.29);B(o.29.1r===Q.3h.8J){u o.8Z(o.9P)}S{u o.8Z(o.9Q)}};1N.N.cE=A(){1Y.2v("dv 4i "+o.29.4i);2s.3P(o.c,o.29.4i,o.29.1k);1Y.2v("2s "+o.29.4i+" 8Q!");u o.4b()};1N.N.9P=A(2U,1L,1v){M i,1t,I;1Y.2v("9T #"+2U+" - Q: "+o.29.1q+", du: "+1L+", dt: "+1v);2P.5a(o.c,"af",{9W:2U,9X:1N.4F,ds:1L,dr:1v});1t=1G 1X();1t.9s(o.c);X(i=I=1L;I<1v;i=I+=4){1t.U=i;1t.r=o.c.R[i];1t.g=o.c.R[i+1];1t.b=o.c.R[i+2];1t.a=o.c.R[i+3];o.29.7I(1t);o.c.R[i]=1w.3A(1t.r);o.c.R[i+1]=1w.3A(1t.g);o.c.R[i+2]=1w.3A(1t.b);o.c.R[i+3]=1w.3A(1t.a)}B(D.2J){u 6y["a0"](2U)}S{u o.5O(2U)}};1N.N.9Q=A(2U,1L,1v){M P,6K,3e,2S,5A,2Q,i,j,k,2D,n,1q,p,1t,6D,I,1n,1u;1q=o.29.1q;3e=o.29.3e;2Q=o.29.2Q;n=o.c.R.T;P=o.29.P;6K=O.8e(P.T);2D=[];1Y.2v("dp 2D - Q: "+o.29.1q);1L=O.1f(1L,o.c.1c.F*4*((6K-1)/2));1v=O.2m(1v,n-(o.c.1c.F*4*((6K-1)/2)));2S=(6K-1)/2;1t=1G 1X();1t.9s(o.c);X(i=I=1L;I<1v;i=I+=4){1t.U=i;5A=0;X(j=1n=-2S;-2S<=2S?1n<=2S:1n>=2S;j=-2S<=2S?++1n:--1n){X(k=1u=2S;2S<=-2S?1u<=-2S:1u>=-2S;k=2S<=-2S?++1u:--1u){p=1t.cj(j,k);2D[5A*3]=p.r;2D[5A*3+1]=p.g;2D[5A*3+2]=p.b;5A++}}6D=o.3G(P,2D,2Q,3e);o.4W[i]=1w.3A(6D.r);o.4W[i+1]=1w.3A(6D.g);o.4W[i+2]=1w.3A(6D.b);o.4W[i+3]=o.c.R[i+3]}B(D.2J){u 6y["a0"](2U)}S{u o.5O(2U)}};1N.N.5O=A(2U){M i,I,K;B(2U>=0){1Y.2v("9T #"+2U+" 8Q! Q: "+o.29.1q)}o.7F++;2P.5a(o.c,"5O",{9W:2U,do:o.7F,9X:1N.4F});B(o.7F===1N.4F){B(o.29.1r===Q.3h.8H){X(i=I=0,K=o.c.R.T;0<=K?I<K:I>K;i=0<=K?++I:--I){o.c.R[i]=o.4W[i]}}B(2U>=0){1Y.2v("Q "+o.29.1q+" 8Q!")}2P.5a(o.c,"aa",o.29);u o.4b()}};1N.N.3G=A(P,2D,2Q,3e){M i,28,I,K;28={r:0,g:0,b:0};X(i=I=0,K=P.T;0<=K?I<K:I>K;i=0<=K?++I:--I){28.r+=P[i]*2D[i*3];28.g+=P[i]*2D[i*3+1];28.b+=P[i]*2D[i*3+2]}28.r=(28.r/2Q)+3e;28.g=(28.g/2Q)+3e;28.b=(28.b/2Q)+3e;u 28};1N.N.cD=A(2c,1I){M 1F,5c,1M=o;1F=1Z.3c(\'1F\');1F.ax=A(){2c.1i.5H(1F,0,0,1M.c.1c.F,1M.c.1c.J);2c.2x=2c.1i.44(0,0,1M.c.1c.F,1M.c.1c.J);2c.R=2c.2x.2b;1M.c.R=2c.R;u 1M.4b()};5c=2I.aP(1I);u 1F.1I=5c!=L?5c:1I};u 1N})();1N=D.1N;D.2X=(A(){A 2X(){}2X.5v={};2X.cm=A(4N){u o.5v[4N]!=L};2X.4D=A(4N){u o.5v[4N]};2X.c5=A(1q,2A){u o.5v[1q]=2A};2X.3P=A(4N,2z){M 1M=o;7u(A(){u 2z.1z(1M.4D(4N),1M.4D(4N))},0);u o.4D(4N)};2X.dn=A(1q){B(1q==L){1q=2r}B(1q){u ac o.5v[1q]}S{u o.5v={}}};u 2X})();2X=D.2X;2h.V("9E",A(Z,W){u{r:Z.r,g:Z.g,b:Z.b}});2h.V("5r",A(Z,W){u{r:(Z.r*W.r)/E,g:(Z.g*W.g)/E,b:(Z.b*W.b)/E}});2h.V("dm",A(Z,W){u{r:E-(((E-Z.r)*(E-W.r))/E),g:E-(((E-Z.g)*(E-W.g))/E),b:E-(((E-Z.b)*(E-W.b))/E)}});2h.V("7O",A(Z,W){M 1H;1H={};1H.r=W.r>1d?E-2*(E-Z.r)*(E-W.r)/E:(W.r*Z.r*2)/E;1H.g=W.g>1d?E-2*(E-Z.g)*(E-W.g)/E:(W.g*Z.g*2)/E;1H.b=W.b>1d?E-2*(E-Z.b)*(E-W.b)/E:(W.b*Z.b*2)/E;u 1H});2h.V("dl",A(Z,W){u{r:Z.r-W.r,g:Z.g-W.g,b:Z.b-W.b}});2h.V("ai",A(Z,W){u{r:W.r+Z.r,g:W.g+Z.g,b:W.b+Z.b}});2h.V("dk",A(Z,W){u{r:1d-2*(W.r-1d)*(Z.r-1d)/E,g:1d-2*(W.g-1d)*(Z.g-1d)/E,b:1d-2*(W.b-1d)*(Z.b-1d)/E}});2h.V("ak",A(Z,W){M 1H;1H={};1H.r=W.r>1d?E-((E-W.r)*(E-(Z.r-1d)))/E:(W.r*(Z.r+1d))/E;1H.g=W.g>1d?E-((E-W.g)*(E-(Z.g-1d)))/E:(W.g*(Z.g+1d))/E;1H.b=W.b>1d?E-((E-W.b)*(E-(Z.b-1d)))/E:(W.b*(Z.b+1d))/E;u 1H});2h.V("dj",A(Z,W){u{r:W.r>Z.r?W.r:Z.r,g:W.g>Z.g?W.g:Z.g,b:W.b>Z.b?W.b:Z.b}});2h.V("di",A(Z,W){u{r:W.r>Z.r?Z.r:W.r,g:W.g>Z.g?Z.g:W.g,b:W.b>Z.b?Z.b:W.b}});Q.V("4r",A(){M 3f;B(1o.T===1){3f=1W.7T(1o[0])}S{3f={r:1o[0],g:1o[1],b:1o[2]}}u o.2j("4r",A(C){C.r=3f.r;C.g=3f.g;C.b=3f.b;C.a=E;u C})});Q.V("3k",A(P){P=O.2O(E*(P/1h));u o.2j("3k",A(C){C.r+=P;C.g+=P;C.b+=P;u C})});Q.V("3L",A(P){P*=-0.dh;u o.2j("3L",A(C){M 1f;1f=O.1f(C.r,C.g,C.b);B(C.r!==1f){C.r+=(1f-C.r)*P}B(C.g!==1f){C.g+=(1f-C.g)*P}B(C.b!==1f){C.b+=(1f-C.b)*P}u C})});Q.V("3T",A(P){P*=-1;u o.2j("3T",A(C){M 1p,4A,1f;1f=O.1f(C.r,C.g,C.b);4A=(C.r+C.g+C.b)/3;1p=((O.4z(1f-4A)*2/E)*P)/1h;B(C.r!==1f){C.r+=(1f-C.r)*1p}B(C.g!==1f){C.g+=(1f-C.g)*1p}B(C.b!==1f){C.b+=(1f-C.b)*1p}u C})});Q.V("4w",A(P){u o.2j("4w",A(C){M 4A;4A=2L.6I(C);C.r=4A;C.g=4A;C.b=4A;u C})});Q.V("2n",A(P){P=O.1E((P+1h)/1h,2);u o.2j("2n",A(C){C.r/=E;C.r-=0.5;C.r*=P;C.r+=0.5;C.r*=E;C.g/=E;C.g-=0.5;C.g*=P;C.g+=0.5;C.g*=E;C.b/=E;C.b-=0.5;C.b*=P;C.b+=0.5;C.b*=E;u C})});Q.V("8w",A(P){u o.2j("8w",A(C){M b,g,h,4X,r,K;4X=1W.bw(C.r,C.g,C.b);h=4X.h*1h;h+=O.4z(P);h=h%1h;h/=1h;4X.h=h;K=1W.bC(4X.h,4X.s,4X.v),r=K.r,g=K.g,b=K.b;C.r=r;C.g=g;C.b=b;u C})});Q.V("4a",A(){M 5E,3g;B(1o.T===2){3g=1W.7T(1o[0]);5E=1o[1]}S B(1o.T===4){3g={r:1o[0],g:1o[1],b:1o[2]};5E=1o[3]}u o.2j("4a",A(C){C.r-=(C.r-3g.r)*(5E/1h);C.g-=(C.g-3g.g)*(5E/1h);C.b-=(C.b-3g.b)*(5E/1h);u C})});Q.V("aC",A(){u o.2j("aC",A(C){C.r=E-C.r;C.g=E-C.g;C.b=E-C.b;u C})});Q.V("49",A(P){B(P==L){P=1h}P/=1h;u o.2j("49",A(C){C.r=O.2m(E,(C.r*(1-(0.dg*P)))+(C.g*(0.df*P))+(C.b*(0.de*P)));C.g=O.2m(E,(C.r*(0.dd*P))+(C.g*(1-(0.dc*P)))+(C.b*(0.db*P)));C.b=O.2m(E,(C.r*(0.da*P))+(C.g*(0.d9*P))+(C.b*(1-(0.d8*P))));u C})});Q.V("2t",A(P){u o.2j("2t",A(C){C.r=O.1E(C.r/E,P)*E;C.g=O.1E(C.g/E,P)*E;C.b=O.1E(C.b/E,P)*E;u C})});Q.V("88",A(P){P=O.4z(P)*2.55;u o.2j("88",A(C){M 4n;4n=2L.ca(P*-1,P);C.r+=4n;C.g+=4n;C.b+=4n;u C})});Q.V("89",A(P){P=O.4z(P)*2.55;u o.2j("89",A(C){B(C.r>E-P){C.r=E}S B(C.r<P){C.r=0}B(C.g>E-P){C.g=E}S B(C.g<P){C.g=0}B(C.b>E-P){C.b=E}S B(C.b<P){C.b=0}u C})});Q.V("3p",A(1K){M 5u,4g;B(1x 1K!=="3W"){u o}X(5u 4Q 1K){B(!6t.1z(1K,5u))5T;4g=1K[5u];B(4g===0){ac 1K[5u];5T}1K[5u]/=1h}B(1K.T===0){u o}u o.2j("3p",A(C){B(1K.3d!=L){B(1K.3d>0){C.r+=(E-C.r)*1K.3d}S{C.r-=C.r*O.4z(1K.3d)}}B(1K.4M!=L){B(1K.4M>0){C.g+=(E-C.g)*1K.4M}S{C.g-=C.g*O.4z(1K.4M)}}B(1K.3N!=L){B(1K.3N>0){C.b+=(E-C.b)*1K.3N}S{C.b-=C.b*O.4z(1K.3N)}}u C})});Q.V("2a",A(){M 1T,3Z,3D,3H,3I,1v,i,1L,I,1n,K,2R;3Z=1o[0],3D=2<=1o.T?5P.1z(1o,1):[];B(1x 3Z==="3F"){3Z=3Z.d7("")}B(3Z[0]==="v"){3Z=[\'r\',\'g\',\'b\']}B(3D.T<3||3D.T>4){38"7V b0 d6 1o 4m 2a 1D";}1L=3D[0];3H=3D[1];3I=3D.T===4?3D[2]:3D[1];1v=3D[3D.T-1];1T=2L.1T(1L,3H,3I,1v,0,E);B(1L[0]>0){X(i=I=0,K=1L[0];0<=K?I<K:I>K;i=0<=K?++I:--I){1T[i]=1L[1]}}B(1v[0]<E){X(i=1n=2R=1v[0];2R<=E?1n<=E:1n>=E;i=2R<=E?++1n:--1n){1T[i]=1v[1]}}u o.2j("2a",A(C){M 1u,46;X(i=1u=0,46=3Z.T;0<=46?1u<46:1u>46;i=0<=46?++1u:--1u){C[3Z[i]]=1T[C[3Z[i]]]}u C})});Q.V("33",A(P){M 3H,3I,p;p=O.4z(P)/1h;3H=[0,E*p];3I=[E-(E*p),E];B(P<0){3H=3H.b3();3I=3I.b3()}u o.2a(\'3g\',[0,0],3H,3I,[E,E])});D.2s.V("8l",A(F,J,x,y){M H,1R;B(x==L){x=0}B(y==L){y=0}B(1x 2e!=="42"&&2e!==L){H=1G 41(F,J)}S{H=1Z.3c(\'H\');1w.5m(o.H,H);H.F=F;H.J=J}1R=H.3b(\'2d\');1R.5H(o.H,x,y,F,J,0,0,F,J);o.6u={x:x,y:y};o.c4=2Y;u o.6i(H)});D.2s.V("6N",A(2y){M H,1R;B(2y==L){2y=L}B(2y===L||((2y.F==L)&&(2y.J==L))){1Y.c9("7V b7 d4 1c cI X 6N");u}B(2y.F==L){2y.F=o.H.F*2y.J/o.H.J}S B(2y.J==L){2y.J=o.H.J*2y.F/o.H.F}B(1x 2e!=="42"&&2e!==L){H=1G 41(2y.F,2y.J)}S{H=1Z.3c(\'H\');1w.5m(o.H,H);H.F=2y.F;H.J=2y.J}1R=H.3b(\'2d\');1R.5H(o.H,0,0,o.H.F,o.H.J,0,0,2y.F,2y.J);o.7H=2Y;u o.6i(H)});D.Q.V("8l",A(){u o.56("8l",6k.N.4V.1z(1o,0))});D.Q.V("6N",A(){u o.56("6N",6k.N.4V.1z(1o,0))});D.Q.V("d3",A(){u o.3G("d2 8h",[1,1,1,1,1,1,1,1,1])});D.Q.V("d1",A(){u o.3G("d0 cZ 8h",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])});D.Q.V("cY",A(){u o.3G("cX 8h",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])});D.Q.V("cW",A(3C){M 2D;B(3C===0||3C===48){2D=[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]}S B((3C>0&&3C<90)||(3C>48&&3C<8b)){2D=[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]}S B(3C===90||3C===8b){2D=[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]}S{2D=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}u o.3G("cV 8h",2D)});D.Q.V("6s",A(1p){B(1p==L){1p=1h}1p/=1h;u o.3G("cU",[0,-1p,0,-1p,4*1p+1,-1p,0,-1p,0])});8L={3k:A(C,1p,G){C.r=C.r-(C.r*1p*G.3a);C.g=C.g-(C.g*1p*G.3a);C.b=C.b-(C.b*1p*G.3a);u C},2t:A(C,1p,G){C.r=O.1E(C.r/E,O.1f(10*1p*G.3a,1))*E;C.g=O.1E(C.g/E,O.1f(10*1p*G.3a,1))*E;C.b=O.1E(C.b/E,O.1f(10*1p*G.3a,1))*E;u C},4a:A(C,1p,G){C.r-=(C.r-G.3f.r)*1p;C.g-=(C.g-G.3f.g)*1p;C.b-=(C.b-G.3f.b)*1p;u C}};Q.V("1U",A(1s,3a){M 1T,3w,1v,1L;B(3a==L){3a=60}B(1x 1s==="3F"&&1s.4T(-1)==="%"){B(o.1c.J>o.1c.F){1s=o.1c.F*(3R(1s.4T(0,1s.T-1),10)/1h)}S{1s=o.1c.J*(3R(1s.4T(0,1s.T-1),10)/1h)}}3a/=1h;3w=[o.1c.F/2,o.1c.J/2];1L=O.8e(O.1E(3w[0],2)+O.1E(3w[1],2));1v=1L-1s;1T=2L.1T([0,1],[30,30],[70,60],[1h,80]);u o.2j("1U",A(C){M 7U,2G,U;U=C.9r();7U=2L.4Z(U.x,U.y,3w[0],3w[1]);B(7U>1v){2G=O.1f(1,(1T[O.8d(((7U-1v)/1s)*1h)]/10)*3a);C.r=O.1E(C.r/E,2G)*E;C.g=O.1E(C.g/E,2G)*E;C.b=O.1E(C.b/E,2G)*E}u C})});Q.V("bz",A(G){M 4o,5y,7Q,1s,I,1m,K;4o={3a:50,2F:0,8F:\'3k\',3f:{r:0,g:0,b:0}};G=1w.8c(4o,G);B(!G.1s){u o}S B(1x G.1s==="3F"){7Q=3R(G.1s,10)/1h;G.1s={F:o.1c.F*7Q,J:o.1c.J*7Q}}S B(1x G.1s==="3W"){K=["F","J"];X(I=0,1m=K.T;I<1m;I++){5y=K[I];B(1x G.1s[5y]==="3F"){G.1s[5y]=o.1c[5y]*(3R(G.1s[5y],10)/1h)}}}S B(G.1s==="b0"){1s=G.1s;G.1s={F:1s,J:1s}}B(1x G.2F==="3F"){G.2F=(G.1s.F/2)*(3R(G.2F,10)/1h)}G.3a/=1h;G.1s.F=O.2O(G.1s.F);G.1s.J=O.2O(G.1s.J);G.1e={F:o.1c.F,J:o.1c.J};B(G.8F==="4a"&&1x G.3f==="3F"){G.3f=1W.7T(G.3f)}G.1V={54:(o.1c.F-G.1s.F)/2,5j:o.1c.F-G.1V.54,57:(o.1c.J-G.1s.J)/2,62:o.1c.J-G.1V.57};G.1y=[{x:G.1V.54+G.2F,y:G.1V.62-G.2F},{x:G.1V.5j-G.2F,y:G.1V.62-G.2F},{x:G.1V.5j-G.2F,y:G.1V.57+G.2F},{x:G.1V.54+G.2F,y:G.1V.57+G.2F}];G.4d=2L.4Z(0,0,G.1y[3].x,G.1y[3].y)-G.2F;u o.2j("bz",A(C){M 1p,U,47;U=C.9r();B((U.x>G.1y[0].x&&U.x<G.1y[1].x)&&(U.y>G.1V.57&&U.y<G.1V.62)){u C}B((U.x>G.1V.54&&U.x<G.1V.5j)&&(U.y>G.1y[3].y&&U.y<G.1y[2].y)){u C}B(U.x>G.1y[0].x&&U.x<G.1y[1].x&&U.y>G.1V.62){1p=(U.y-G.1V.62)/G.4d}S B(U.y>G.1y[2].y&&U.y<G.1y[1].y&&U.x>G.1V.5j){1p=(U.x-G.1V.5j)/G.4d}S B(U.x>G.1y[0].x&&U.x<G.1y[1].x&&U.y<G.1V.57){1p=(G.1V.57-U.y)/G.4d}S B(U.y>G.1y[2].y&&U.y<G.1y[1].y&&U.x<G.1V.54){1p=(G.1V.54-U.x)/G.4d}S B(U.x<=G.1y[0].x&&U.y>=G.1y[0].y){47=D.4Z(U.x,U.y,G.1y[0].x,G.1y[0].y);1p=(47-G.2F)/G.4d}S B(U.x>=G.1y[1].x&&U.y>=G.1y[1].y){47=D.4Z(U.x,U.y,G.1y[1].x,G.1y[1].y);1p=(47-G.2F)/G.4d}S B(U.x>=G.1y[2].x&&U.y<=G.1y[2].y){47=D.4Z(U.x,U.y,G.1y[2].x,G.1y[2].y);1p=(47-G.2F)/G.4d}S B(U.x<=G.1y[3].x&&U.y<=G.1y[3].y){47=D.4Z(U.x,U.y,G.1y[3].x,G.1y[3].y);1p=(47-G.2F)/G.4d}B(1p<0){u C}u 8L[G.8F](C,1p,G)})});(A(){M 4O,8N,8O,5M,5L;5M=[2N,2N,32,2N,3u,32,3t,2N,3M,3u,3r,32,3Q,3t,3S,2N,4q,3M,4L,3u,4G,3r,4C,32,4y,3Q,4e,3t,31,3S,4P,2N,5x,4q,3X,3M,5p,4L,5l,3u,31,4G,5k,3r,4v,4C,4u,32,64,4y,5Z,3Q,5S,4e,5R,3t,5N,31,5B,3S,5n,4P,3U,2N,7r,5x,7q,4q,7n,3X,7m,3M,7l,5p,7k,4L,4s,5l,7i,3u,5K,31,7f,4G,7e,5k,4H,3r,3U,4v,7d,4C,7c,4u,7b,32,7a,64,3X,4y,79,5Z,77,3Q,76,5S,74,4e,4s,5R,5C,3t,72,5N,6X,31,6V,5B,6U,3S,5h,5n,4H,4P,6R,3U,6O,2N,cO,7r,c7,5x,4u,7q,bL,4q,bG,7n,bE,3X,by,7m,bv,3M,bo,7l,bm,5p,bi,7k,bh,4L,bf,4s,8f,5l,5C,7i,8g,3u,bc,5K,bb,31,b9,7f,b8,4G,8i,7e,5h,5k,b2,4H,b1,3r,aZ,3U,aM,4v,aL,7d,aK,4C,aJ,7c,aI,4u,aH,7b,aG,32,aF,7a,aE,64,aq,3X,am,4y,al,79,aj,5Z,ah,77,ae,3Q,ab,76,a8,5S,a7,74,a2,4e,9Z,4s,8f,5R,9Y,5C,9V,3t,8g,72,9U,5N,5K,6X,9R,31,9O,6V,cF,5B,8s,6U,8i,3S,cw,5h,cv,5n,cs,4H,cr,4P,3r,6R,cq,3U,cp,6O,4v];5L=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];8N=A(F,J,5U,5V,2E,T,bN){M 3V,1i,2p,4k,4E,4j,4B;3V=1x 2e!=="42"&&2e!==L?1G 41():1Z.3c(\'H\');3V.F=F;3V.J=J;4k=5U+O.bK(2E)*T*0.5;4j=5V+O.bJ(2E)*T*0.5;4E=5U-O.bK(2E)*T*0.5;4B=5V-O.bJ(2E)*T*0.5;1i=3V.3b("2d");2p=1i.dY(4k,4j,4E,4B);B(!bN){2p.5d(0,"6T");2p.5d(1,"9L")}S{2p.5d(0,"6T");2p.5d(0.5,"9L");2p.5d(1,"6T")}1i.bA=2p;1i.bx(0,0,F,J);u 1i.44(0,0,F,J)};8O=A(F,J,5U,5V,6J,6L){M 3V,1i,2p;3V=1x 2e!=="42"&&2e!==L?1G 41():1Z.3c(\'H\');3V.F=F;3V.J=J;1i=3V.3b("2d");2p=1i.e6(5U,5V,6J,5U,5V,6L);2p.5d(1,"6T");2p.5d(0,"9L");1i.bA=2p;1i.bx(0,0,F,J);u 1i.44(0,0,F,J)};4O=A(){o.r=0;o.g=0;o.b=0;o.a=0;u o.26=L};D.2s.V("9N",A(bl,1S,bj,6P){M 2l,2C,1Q,63,6F,2G,2k,2u,1O,J,3Y,i,6B,2B,3m,6Y,3O,67,2M,p,1B,1C,Y,1A,2i,2w,1P,8K,1a,37,2T,1b,4c,1j,1J,2K,4S,2V,7M,7N,5q,F,3i,x,y,1g,4J,4I,I,1n,1u,3l,3n,3o,3q,3s,3v,5s;F=o.1c.F;J=o.1c.J;3m=o.R;8K=bl.2b;7N=F*J;5q=7N<<2;Y=[];X(i=I=0;0<=5q?I<5q:I>5q;i=0<=5q?++I:--I){Y[i]=3m[i]}6F=0;4S=6P;6P-=1;ch(4S-->=0){3O=(1S+0.5)|0;B(3O===0){5T}B(3O>6v){3O=6v}2G=3O+3O+1;7M=F<<2;3i=F-1;3Y=J-1;1a=3O+1;2V=1a*(1a+1)/2;2K=1G 4O();4c=ao 0;1b=2K;X(i=1n=1;1<=2G?1n<2G:1n>2G;i=1<=2G?++1n:--1n){1b=1b.26=1G 4O();B(i===1a){4c=1b}}1b.26=2K;1j=L;1J=L;4I=1g=0;2M=5M[3O];2T=5L[3O];X(y=1u=0;0<=J?1u<J:1u>J;y=0<=J?++1u:--1u){2i=2k=2l=1P=1O=1Q=0;2w=1a*(1A=Y[1g]);2u=1a*(1C=Y[1g+1]);2C=1a*(1B=Y[1g+2]);1P+=2V*1A;1O+=2V*1C;1Q+=2V*1B;1b=2K;X(i=3l=0;0<=1a?3l<1a:3l>1a;i=0<=1a?++3l:--3l){1b.r=1A;1b.g=1C;1b.b=1B;1b=1b.26}X(i=3n=1;1<=1a?3n<1a:3n>1a;i=1<=1a?++3n:--3n){p=1g+((3i<i?3i:i)<<2);1P+=(1b.r=(1A=Y[p]))*(37=1a-i);1O+=(1b.g=(1C=Y[p+1]))*37;1Q+=(1b.b=(1B=Y[p+2]))*37;2i+=1A;2k+=1C;2l+=1B;1b=1b.26}1j=2K;1J=4c;X(x=3o=0;0<=F?3o<F:3o>F;x=0<=F?++3o:--3o){Y[1g]=(1P*2M)>>2T;Y[1g+1]=(1O*2M)>>2T;Y[1g+2]=(1Q*2M)>>2T;1P-=2w;1O-=2u;1Q-=2C;2w-=1j.r;2u-=1j.g;2C-=1j.b;p=(4I+((p=x+1a)<3i?p:3i))<<2;2i+=(1j.r=Y[p]);2k+=(1j.g=Y[p+1]);2l+=(1j.b=Y[p+2]);1P+=2i;1O+=2k;1Q+=2l;1j=1j.26;2w+=(1A=1J.r);2u+=(1C=1J.g);2C+=(1B=1J.b);2i-=1A;2k-=1C;2l-=1B;1J=1J.26;1g+=4}4I+=F}X(x=3q=0;0<=F?3q<F:3q>F;x=0<=F?++3q:--3q){2k=2l=2i=1O=1Q=1P=0;1g=x<<2;2w=1a*(1A=Y[1g]);2u=1a*(1C=Y[1g+1]);2C=1a*(1B=Y[1g+2]);1P+=2V*1A;1O+=2V*1C;1Q+=2V*1B;1b=2K;X(i=3s=0;0<=1a?3s<1a:3s>1a;i=0<=1a?++3s:--3s){1b.r=1A;1b.g=1C;1b.b=1B;1b=1b.26}4J=F;X(i=3v=1;1<=1a?3v<1a:3v>1a;i=1<=1a?++3v:--3v){1g=(4J+x)<<2;1P+=(1b.r=(1A=Y[1g]))*(37=1a-i);1O+=(1b.g=(1C=Y[1g+1]))*37;1Q+=(1b.b=(1B=Y[1g+2]))*37;2i+=1A;2k+=1C;2l+=1B;1b=1b.26;B(i<3Y){4J+=F}}1g=x;1j=2K;1J=4c;X(y=5s=0;0<=J?5s<J:5s>J;y=0<=J?++5s:--5s){p=1g<<2;Y[p]=(1P*2M)>>2T;Y[p+1]=(1O*2M)>>2T;Y[p+2]=(1Q*2M)>>2T;1P-=2w;1O-=2u;1Q-=2C;2w-=1j.r;2u-=1j.g;2C-=1j.b;p=(x+(((p=y+1a)<3Y?p:3Y)*F))<<2;1P+=(2i+=(1j.r=Y[p]));1O+=(2k+=(1j.g=Y[p+1]));1Q+=(2l+=(1j.b=Y[p+2]));1j=1j.26;2w+=(1A=1J.r);2u+=(1C=1J.g);2C+=(1B=1J.b);2i-=1A;2k-=1C;2l-=1B;1J=1J.26;1g+=F}}1S*=bj;i=7N;ch(--i>-1){2B=i<<2;67=(8K[2B+2]&eZ)/E.0*6P;6Y=67|0;B(6Y===6F){63=6v.0*(67-(67|0));6B=6v-63;3m[2B]=(3m[2B]*6B+Y[2B]*63)>>8;3m[2B+1]=(3m[2B+1]*6B+Y[2B+1]*63)>>8;3m[2B+2]=(3m[2B+2]*6B+Y[2B+2]*63)>>8}S B(6Y===6F+1){3m[2B]=Y[2B];3m[2B+1]=Y[2B+1];3m[2B+2]=Y[2B+2]}}6F++}u o});D.Q.V("f1",A(G){M 4o,2p;4o={3w:{x:o.1c.F/2,y:o.1c.J/2},2E:45,aU:5J,7X:3,7S:1.5,4S:3};G=1w.8c(4o,G);G.2E*=O.an/48;2p=8N(o.1c.F,o.1c.J,G.3w.x,G.3w.y,G.2E,G.aU,2Y);u o.56("9N",[2p,G.7X,G.7S,G.4S])});u D.Q.V("f7",A(G){M 4o,2p,6J,6L;4o={1s:50,3w:{x:o.1c.F/2,y:o.1c.J/2},7X:3,7S:1.5,4S:3,1S:L};G=1w.8c(4o,G);B(!G.1S){G.1S=o.1c.F<o.1c.J?o.1c.J:o.1c.F}6J=(G.1S/2)-G.1s;6L=G.1S/2;2p=8O(o.1c.F,o.1c.J,G.3w.x,G.3w.y,6J,6L);u o.56("9N",[2p,G.7X,G.7S,G.4S])})})();D.Q.V("f8",A(){u o.3G("bk fa",[0,0,0,-1,1,0,0,0,0])});D.Q.V("fb",A(){u o.3G("bk fc",[-1,-1,-1,-1,8,-1,-1,-1,-1])});D.Q.V("fd",A(){u o.3G("fe",[-2,-1,0,-1,1,1,0,1,2])});D.Q.V("8X",A(P){M 6c,69;6c=6v/P;69=E/(P-1);u o.2j("8X",A(C){C.r=O.2O(O.2O(C.r/6c)*69);C.g=O.2O(O.2O(C.g/6c)*69);C.b=O.2O(O.2O(C.b/6c)*69);u C})});D.Q.V("fi",A(1U){B(1U==L){1U=2Y}o.4w();o.2n(5);o.88(3);o.49(1h);o.3p({3d:8,3N:2,4M:4});o.2t(0.87);B(1U){u o.1U("40%",30)}});D.Q.V("fk",A(1U){B(1U==L){1U=2Y}o.3k(15);o.33(15);o.2a(\'3g\',[0,0],[5J,0],[fl,E],[E,E]);o.3L(-20);o.2t(1.8);B(1U){o.1U("50%",60)}u o.3k(5)});D.Q.V("fm",A(7z){B(7z==L){7z=2r}o.3T(20);o.2a(\'3g\',[5,0],[fp,ag],[8j,ft],[fu,E]);o.6s(15);o.1U("45%",20);B(7z){o.4w();o.2n(4)}u o});D.Q.V("fv",A(){o.2n(1h);o.3k(15);o.33(10);o.8X(80);o.89(30);u o.4w()});D.Q.V("fw",A(){o.33(3.5);o.3L(-5);o.3T(50);o.49(60);o.4a("#cn",10);o.3p({3d:8,3N:8});o.2n(5);o.2t(1.2);u o.1U("55%",25)});D.Q.V("fz",A(){o.33(5);o.4a("#cn",4);o.49(20);o.3p({3N:8,3d:3});o.2a(\'b\',[0,0],[1h,ag],[48,48],[E,E]);o.2n(15);o.3T(75);u o.2t(1.6)});D.Q.V("fA",A(){o.2a(\'3g\',[0,0],[1h,50],[c2,5J],[E,E]);o.3T(-30);o.3L(-30);o.4a(\'#fC\',30);o.2n(-5);u o.2t(1.4)});D.Q.V("fD",A(){o.3k(5);o.33(8);o.2n(4);o.4a(\'#fE\',30);o.3T(50);u o.2t(1.3)});D.Q.V("fF",A(){o.2t(1.5);o.89(25);o.3L(-60);o.2n(5);o.88(5);u o.1U("50%",30)});D.Q.V("fG",A(){o.3L(-35);o.2a(\'b\',[20,0],[90,7w],[fJ,ap],[E,cM]);o.2a(\'r\',[0,0],[ap,90],[fM,7w],[E,E]);o.2a(\'g\',[10,0],[fN,fO],[fP,1h],[E,fQ]);o.2a(\'3g\',[0,0],[7w,1h],[1d,c2],[E,E]);u o.6s(20)});D.Q.V("fR",A(){o.4w();o.49(10);o.33(10);o.2n(15);u o.1U("60%",35)});D.Q.V("fS",A(){o.3L(-20);o.3T(-50);o.2t(1.1);o.49(30);o.3p({3d:-10,3N:5});o.2a(\'3g\',[0,0],[80,50],[1d,cM],[E,E]);u o.1U("60%",30)});D.Q.V("fT",A(1U){B(1U==L){1U=2Y}o.3k(10);o.2Z(A(){o.3y("5r");o.2g(80);o.43();o.1D.2t(0.8);o.1D.2n(50);u o.1D.33(10)});o.2Z(A(){o.3y("ak");o.2g(80);u o.4r("#fU")});o.33(20);o.2t(0.8);B(1U){u o.1U("45%",20)}});D.Q.V("fV",A(){o.2t(1.2);o.2Z(A(){o.3y("7O");o.2g(60);o.43();o.1D.3p({3d:5});u o.1D.5t(15)});o.2Z(A(){o.3y("ai");o.2g(40);u o.4r("#fX")});o.2Z(A(){o.3y("5r");o.2g(35);o.43();o.1D.3k(40);o.1D.3T(40);o.1D.33(30);o.1D.2n(15);o.1D.2a(\'r\',[0,40],[1d,1d],[1d,1d],[E,9l]);o.1D.2a(\'g\',[0,40],[1d,1d],[1d,1d],[E,9l]);o.1D.2a(\'b\',[0,40],[1d,1d],[1d,1d],[E,9l]);u o.1D.5t(5)});o.2a(\'r\',[20,0],[1d,fZ],[1d,1d],[7j,E]);o.2a(\'g\',[20,0],[1d,1d],[1d,1d],[7j,E]);o.2a(\'b\',[20,0],[1d,9p],[1d,1d],[7j,E]);u o.1U("45%",20)});D.Q.V("g1",A(){o.3k(40);o.4a("#cc",10);o.2a(\'b\',[0,10],[1d,48],[8j,8j],[E,E]);o.2Z(A(){o.3y(\'7O\');o.2g(50);o.43();o.1D.2t(0.7);u o.2Z(A(){o.3y(\'9E\');o.2g(60);u o.4r(\'#cc\')})});o.2Z(A(){o.3y(\'5r\');o.2g(60);o.43();o.1D.3L(50);o.1D.8w(90);u o.1D.2n(10)});o.2t(1.4);o.3T(-30);o.2Z(A(){o.2g(10);u o.4r(\'#g3\')});u o});D.Q.V("g4",A(){o.3L(20);o.2t(1.4);o.4w();o.2n(5);o.49(1h);o.3p({3d:8,3N:2,4M:4});o.2t(0.8);o.2n(5);o.33(10);o.2Z(A(){o.3y(\'7O\');o.43();o.2g(55);u o.1D.5t(10)});u o.1U("50%",30)});D.Q.V("g5",A(){o.4w();o.2n(10);o.2t(0.9);o.2Z(A(){o.3y("5r");o.2g(40);o.43();o.1D.33(15);o.1D.2n(15);u o.1D.3p({4M:10,3d:5})});o.49(30);o.2a(\'3g\',[0,10],[7w,90],[48,5J],[7j,E]);o.3p({3d:5,4M:-2});u o.33(15)});D.Q.V("g6",A(){o.6s(40);o.3L(-50);o.3p({3d:3});o.2Z(A(){o.3y("5r");o.2g(80);o.43();o.1D.6s(5);o.1D.2n(50);o.1D.33(10);u o.1D.3p({3N:5})});u o.3k(10)});D.2s.V("7h",A(3C){M 2E,H,1R,J,9x,F,x,y;2E=3C%4e;B(2E===0){u o.1c={F:o.H.F,J:o.H.J}}9x=O.an/48;B(1x 2e!=="42"&&2e!==L){H=1G 41()}S{H=1Z.3c(\'H\');1w.5m(o.H,H)}B(2E===90||2E===-8b||2E===8b||2E===-90){F=o.H.J;J=o.H.F;x=F/2;y=J/2}S B(2E===48){F=o.H.F;J=o.H.J;x=F/2;y=J/2}S{F=O.8e(O.1E(o.5b,2)+O.1E(o.5D,2));J=F;x=o.H.J/2;y=o.H.F/2}H.F=F;H.J=J;1R=H.3b(\'2d\');1R.br();1R.g9(x,y);1R.7h(2E*9x);1R.5H(o.H,-o.H.F/2,-o.H.J/2,o.H.F,o.H.J);1R.ga();u o.6i(H)});D.Q.V("7h",A(){u o.56("7h",6k.N.4V.1z(1o,0))});(A(){M 4O,5M,5L;5M=[2N,2N,32,2N,3u,32,3t,2N,3M,3u,3r,32,3Q,3t,3S,2N,4q,3M,4L,3u,4G,3r,4C,32,4y,3Q,4e,3t,31,3S,4P,2N,5x,4q,3X,3M,5p,4L,5l,3u,31,4G,5k,3r,4v,4C,4u,32,64,4y,5Z,3Q,5S,4e,5R,3t,5N,31,5B,3S,5n,4P,3U,2N,7r,5x,7q,4q,7n,3X,7m,3M,7l,5p,7k,4L,4s,5l,7i,3u,5K,31,7f,4G,7e,5k,4H,3r,3U,4v,7d,4C,7c,4u,7b,32,7a,64,3X,4y,79,5Z,77,3Q,76,5S,74,4e,4s,5R,5C,3t,72,5N,6X,31,6V,5B,6U,3S,5h,5n,4H,4P,6R,3U,6O,2N,cO,7r,c7,5x,4u,7q,bL,4q,bG,7n,bE,3X,by,7m,bv,3M,bo,7l,bm,5p,bi,7k,bh,4L,bf,4s,8f,5l,5C,7i,8g,3u,bc,5K,bb,31,b9,7f,b8,4G,8i,7e,5h,5k,b2,4H,b1,3r,aZ,3U,aM,4v,aL,7d,aK,4C,aJ,7c,aI,4u,aH,7b,aG,32,aF,7a,aE,64,aq,3X,am,4y,al,79,aj,5Z,ah,77,ae,3Q,ab,76,a8,5S,a7,74,a2,4e,9Z,4s,8f,5R,9Y,5C,9V,3t,8g,72,9U,5N,5K,6X,9R,31,9O,6V,cF,5B,8s,6U,8i,3S,cw,5h,cv,5n,cs,4H,cr,4P,3r,6R,cq,3U,cp,6O,4v];5L=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];4O=A(){o.r=0;o.g=0;o.b=0;o.a=0;u o.26=L};D.2s.V("5t",A(1S){M 2l,2C,1Q,2G,2k,2u,1O,J,3Y,i,2M,p,1B,1C,Y,1A,2i,2w,1P,1a,37,2T,1b,4c,1j,1J,2K,2V,7M,F,3i,x,y,1g,4J,4I,I,1n,1u,3l,3n,3o,3q,3s,3v;B(cA(1S)||1S<1){u}1S|=0;Y=o.R;F=o.1c.F;J=o.1c.J;2G=1S+1S+1;7M=F<<2;3i=F-1;3Y=J-1;1a=1S+1;2V=1a*(1a+1)/2;2K=1G 4O();1b=2K;X(i=I=1;1<=2G?I<2G:I>2G;i=1<=2G?++I:--I){1b=1b.26=1G 4O();B(i===1a){4c=1b}}1b.26=2K;1j=L;1J=L;4I=1g=0;2M=5M[1S];2T=5L[1S];X(y=1n=0;0<=J?1n<J:1n>J;y=0<=J?++1n:--1n){2i=2k=2l=1P=1O=1Q=0;2w=1a*(1A=Y[1g]);2u=1a*(1C=Y[1g+1]);2C=1a*(1B=Y[1g+2]);1P+=2V*1A;1O+=2V*1C;1Q+=2V*1B;1b=2K;X(i=1u=0;0<=1a?1u<1a:1u>1a;i=0<=1a?++1u:--1u){1b.r=1A;1b.g=1C;1b.b=1B;1b=1b.26}X(i=3l=1;1<=1a?3l<1a:3l>1a;i=1<=1a?++3l:--3l){p=1g+((3i<i?3i:i)<<2);1P+=(1b.r=(1A=Y[p]))*(37=1a-i);1O+=(1b.g=(1C=Y[p+1]))*37;1Q+=(1b.b=(1B=Y[p+2]))*37;2i+=1A;2k+=1C;2l+=1B;1b=1b.26}1j=2K;1J=4c;X(x=3n=0;0<=F?3n<F:3n>F;x=0<=F?++3n:--3n){Y[1g]=(1P*2M)>>2T;Y[1g+1]=(1O*2M)>>2T;Y[1g+2]=(1Q*2M)>>2T;1P-=2w;1O-=2u;1Q-=2C;2w-=1j.r;2u-=1j.g;2C-=1j.b;p=(4I+((p=x+1S+1)<3i?p:3i))<<2;2i+=(1j.r=Y[p]);2k+=(1j.g=Y[p+1]);2l+=(1j.b=Y[p+2]);1P+=2i;1O+=2k;1Q+=2l;1j=1j.26;2w+=(1A=1J.r);2u+=(1C=1J.g);2C+=(1B=1J.b);2i-=1A;2k-=1C;2l-=1B;1J=1J.26;1g+=4}4I+=F}X(x=3o=0;0<=F?3o<F:3o>F;x=0<=F?++3o:--3o){2k=2l=2i=1O=1Q=1P=0;1g=x<<2;2w=1a*(1A=Y[1g]);2u=1a*(1C=Y[1g+1]);2C=1a*(1B=Y[1g+2]);1P+=2V*1A;1O+=2V*1C;1Q+=2V*1B;1b=2K;X(i=3q=0;0<=1a?3q<1a:3q>1a;i=0<=1a?++3q:--3q){1b.r=1A;1b.g=1C;1b.b=1B;1b=1b.26}4J=F;X(i=3s=1;1<=1S?3s<=1S:3s>=1S;i=1<=1S?++3s:--3s){1g=(4J+x)<<2;1P+=(1b.r=(1A=Y[1g]))*(37=1a-i);1O+=(1b.g=(1C=Y[1g+1]))*37;1Q+=(1b.b=(1B=Y[1g+2]))*37;2i+=1A;2k+=1C;2l+=1B;1b=1b.26;B(i<3Y){4J+=F}}1g=x;1j=2K;1J=4c;X(y=3v=0;0<=J?3v<J:3v>J;y=0<=J?++3v:--3v){p=1g<<2;Y[p]=(1P*2M)>>2T;Y[p+1]=(1O*2M)>>2T;Y[p+2]=(1Q*2M)>>2T;1P-=2w;1O-=2u;1Q-=2C;2w-=1j.r;2u-=1j.g;2C-=1j.b;p=(x+(((p=y+1a)<3Y?p:3Y)*F))<<2;1P+=(2i+=(1j.r=Y[p]));1O+=(2k+=(1j.g=Y[p+1]));1Q+=(2l+=(1j.b=Y[p+2]));1j=1j.26;2w+=(1A=1J.r);2u+=(1C=1J.g);2C+=(1B=1J.b);2i-=1A;2k-=1C;2l-=1B;1J=1J.26;1g+=F}}u o});u D.Q.V("5t",A(1S){u o.56("5t",[1S])})})();D.Q.V("bY",A(P){u o.2j("bY",A(C){M 6I;6I=(0.bV*C.r)+(0.bW*C.g)+(0.bX*C.b);B(6I<P){C.r=0;C.g=0;C.b=0}S{C.r=E;C.g=E;C.b=E}u C})})}).1z(o);',62,1004,"||||||||||||||||||||||||this||||||return||||||function|if|rgba|Caman|255|width|opts|canvas|_i|height|_ref|null|var|prototype|Math|adjust|Filter|pixelData|else|length|loc|register|rgbaParent|for|pixels|rgbaLayer|||||||||||radiusPlus1|stack|dimensions|128|image|max|yi|100|context|stackIn|args|_results|_len|_j|arguments|amt|name|type|size|pixel|_k|end|Util|typeof|corners|call|pr|pb|pg|filter|pow|img|new|result|src|stackOut|options|start|_this|Renderer|g_sum|r_sum|b_sum|ctx|radius|bezier|vignette|coords|Convert|Pixel|Log|document|||||||next||val|currentJob|curves|data|layer||exports|case|opacity|Blender|r_in_sum|process|g_in_sum|b_in_sum|min|contrast|key|gradient|push|false|Plugin|gamma|g_out_sum|debug|r_out_sum|imageData|newDims|callback|obj|idx|b_out_sum|kernel|angle|cornerRadius|div|id|IO|NodeJS|stackStart|Calculate|mul_sum|512|floor|Event|divisor|_ref1|builder|shg_sum|bnum|sumFactor|parentData|Store|true|newLayer||312|456|exposure|Layer|||rbs|throw|target|strength|getContext|createElement|red|bias|color|rgb|Type|widthMinus1|055|brightness|_l|imagePixels|_m|_n|channels|_o|271|_p|335|328|_q|center|levels|setBlendingMode|newLoc|clampRGB|initObj|degrees|cps|caman|string|processKernel|ctrl1|ctrl2|hex|Module|saturation|405|blue|iradius|execute|388|parseInt|292|vibrance|265|cnv|object|428|heightMinus1|chans||Canvas|undefined|copyParent|getImageData||_ref2|radialDist|180|sepia|colorize|processNext|stackEnd|maxDist|360|ratio|value|devicePixelRatio|plugin|y1|x1|apply|to|rand|defaults|ele|454|fillColor|354|renderer|475|259|greyscale|window|420|abs|avg|y2|496|get|x2|Blocks|298|278|yw|yp|Analyze|364|green|search|BlurStack|273|in|CamanParser|steps|substr|curveY|slice|modPixelData|hsv|break|distance||layerData|func|events|left||processPlugin|bottom|originalPixelData|from|trigger|originalWidth|proxyUrl|addColorStop|imageHeight|imageWidth|lang|287|parent|right|284|345|copyAttributes|282|toString|383|wh4|multiply|_r|stackBlur|chan|items|Image|482|dim|finishInit|builderIndex|302|341|originalHeight|level|CamanJS|Requires|drawImage|1379310345|200|320|shg_table|mul_table|323|blockFinished|__slice|leftCoord|347|374|continue|centerX|centerY|_error|file|add|404||getAttribute|top|blend|437|switch|child|lookupValue|blockN|numOfValues|allowRevert|currentLayer|numOfAreas|imgs|renderQueue|pixelStack|copy|__indexOf|replaceCanvas|dataArray|Array|preScaledHeight|toLowerCase|prop|event|Cx|Cy|nodeFileReady|sharpen|__hasProp|cropCoordinates|256|unparsedInstructions|x0|Fiber|getFloat|y0|iblend|imageLoaded|res|scaledCanvas|currentIndex|attr|numPixels|luminance|radius1|adjustSize|radius2|preScaledWidth|resize|261|blurLevels|langToExt|269|initType|white|297|307|overwrite|318|index|matches||isURLRemote|329|imageUrl|367||381|396|source|412|446|465|485|507|291|305|Logger|rotate|337|235|373|394|417|441|horiz|vert|468|497|includeAlpha|complete|setTimeout|hiDPIReplacement|120|hiDPIRatio|disabled|grey|oldCanvas|putImageData|updateContext|coord|startX|blocksDone|startY|resized|processFn|moduleKeywords|Root|require|w4|wh|overlay|initializedPixelData|percent|hueToRGB|radiusFactor|hexToRGB|dist|Invalid|rightCoord|startRadius|By|INST_REGEX||Bx|sel|root|dest|highBound|lowBound||noise|clip|remoteProxy|270|extend|round|sqrt|350|332|Blur|294|190|catch|crop|blenders|getAttrId|try|uniqid|match|instFunc|299|inst|Ax|Ay|hue|curveX|DOMUpdated|x3|y3|crossOrigin|bind|version|LayerFinished|method|LayerDequeue|Kernel|04045|Single|radiusPixels|vignetteFilters|_ref3|getLinearGradientMap|getRadialGradientMap|layerStack|finished|0031308|canvasQueue|endY|endX|lastBlockN|except|posterize|blockPixelLength|eachBlock||nodeName||backingStoreRatio|ctor||finishedFn|Revert|job|naturalWidth|4166666667|whiteX|needsHiDPISwap|waitForImageLoaded|imageAdjustments|replaceChild|parentNode|listener|whiteY|readyState|err|215|plugins|whiteZ|pixelAtLocation|108|008856451679|locationXY|setContext|coordinatesToLocation|console|3333333333|787037037|to_radians|2068965517|1284185493|xyz|_fn|pop|_type|normal|blendingMode|LoadOverlay|included|stats|info|__bind|black|toBase64|compoundBlur|310|renderBlock|renderKernel|315|pushContext|Block|326|338|blockNum|totalBlocks|344|357|yield|item|363|popContext|applyCurrentLayer|applyToParent|types|370|377|processStart|processComplete|385|delete|renderFinished|392|blockStarted|150|400|addition|408|softLight|416|424|PI|void|144|433|DOM|URL|isImageLoaded|filterFunc|domainRegex|hiDPICapable|onload|corsEnabled|newCanvas|use|anonymous|invert|url|442|451|460|470|480|491|501|257|262|Height|parser|remoteCheck|render|parse|1000|remote|focusWidth|setup|proxy|renderStart|me|268|number|274|281|reverse|parseArguments|ready|dataStr|or|301|309|DEBUG|316|324|__extends|setInitObject|359|originalVisiblePixels|368|378|increaseFactor|Edge|radiusData|389|date|399|release|domIsLoaded|save|nodeSave|browserSave|png|411|rgbToHSV|fillRect|422|rectangularVignette|fillStyle|RegExp|hsvToRGB|initialized|435|_super|447|rgbToXYZ|initNode|sin|cos|461|node|mirrored|initImage|hiDPIAdjustments|extended|toImage|hasId|assignId|initCanvas|2126|7152|0722|threshold|mode|addEventListener|locationToCoordinates|140|scaled|cropped|put|reloadCanvasData|489|log|error|randomRange||ea1c5d|setAttribute|loaded|hiDPIDisabled|hidpi|while|swapped|getPixelRelative|xyzToLab|Uint8Array|has|e87b22|nowLoc|263|267|275|280|autoload|047|285|289|style|883|px|isNaN|isRemote|shift|loadOverlay|executePlugin|304|executeFilter|proxyParam|given|116|500|Width|230|executeLayer|505|rgbToLab|aliasFunction|Object|defineProperty|set|Sharpen|Motion|motionBlur|Gaussian|gaussianBlur|Radial|Heavy|heavyRadialBlur|Box|boxBlur|missing|querySelector|of|split|869|534|272|168|314|349|189|769|607|01|darken|lighten|exclusion|difference|screen|flush|blocksFinished|Rendering|attributes|endPixel|startPixel|End|Start|Executing|run|default|cpus|os|toHex|toKey|putPixel|getPixel|putPixelRelative|warn|nodeValue|overlayImage|createImageData|layerID|delegate|includes|toDataURL|extends|writing|Finished|toBuffer|writeFile|__super__|output|Creating|constructor|isFile|statSync|createLinearGradient|href|location|stream|octet|replace|caman_proxy|proxies|createRadialGradient|js|javascript|pl|perl|py|python|rb|ruby|useProxy|encodeURIComponent|images|loading|Cannot|configured|without|load|hasOwnProperty|Attempting|domain|credentials|https|http|listen|labToRGB|aliasProperty|indexOf|labToXYZ|0570|2040|0557|0415|8758|9689|4986|5372|2406|xyzToRGB|9505|1192|0193|1805|3576|4124|fibers|hslToRGB|2013|rgbToHSL|charAt|camanProxyUrl|114|587|toFixed|random|Version|0xff|Released|tiltShift|Function|DOMContentLoaded|querySelectorAll|instanceof|calculateLevels|radialBlur|edgeEnhance|reset|Enhance|edgeDetect|Detect|emboss|Emboss|revert|backingStorePixelRatio|oBackingStorePixelRatio|vintage|msBackingStorePixelRatio|lomo|155|clarity||mozBackingStorePixelRatio|130|webkitBackingStorePixelRatio|scale||220|250|sinCity|sunrise|HiDPI|resetOriginalPixelData|crossProcess|orangePeel|analyze|ff9000|love|c42007|grungy|jarques|naturalHeight|using|186|detected|Remote|138|115|105|148|248|pinhole|oldBoot|glowingSun|f49600|hazyDays|readFile|6899ba|Initializing|158|initialization|herMajesty|find|e5f0ff|nostalgia|hemingway|concentrate|not|Could|translate|restore|readystatechange".split("|"),0,{})),
function(){var a={};!function(){function b(a,c,d){var e=function(){};e.prototype=a.prototype;var f=new e,g=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;d=d||{};for(var h in d){var i=d[h],j=f[h];f[h]="function"==typeof j&&"function"==typeof i&&g.test(i)?function(a,b){return function(){var c=this.parent;this.parent=b;var d=a.apply(this,arguments);return this.parent=c,d}}(i,j):i}f.typename=c;var k=function(){f.init&&f.init.apply(this,arguments)};return k.prototype=f,k.prototype.constructor=k,k.extend=function(a,c){return"object"==typeof a&&(c=a,a="anonymous"),b(k,a,c)},k}a.object=b(Object,"Object",{})}(),function(){var b=Array.prototype,c=Object.prototype,d={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},e=/[&"'<>]/g,f=function(a){return d[a]},g=a.lib={};g.withPrettyErrors=function(a,b,c){try{return c()}catch(d){if(d.Update||(d=new g.TemplateError(d)),d.Update(a),!b){var e=d;d=new Error(e.message),d.name=e.name}throw d}},g.TemplateError=function(a,b,c){var d=this;return a instanceof Error?(d=a,a=a.name+": "+a.message):Error.captureStackTrace&&Error.captureStackTrace(d),d.name="Template render error",d.message=a,d.lineno=b,d.colno=c,d.firstUpdate=!0,d.Update=function(a){var b="("+(a||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?b+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(b+=" [Line "+this.lineno+"]")),b+="\n ",this.firstUpdate&&(b+=" "),this.message=b+(this.message||""),this.firstUpdate=!1,this},d},g.TemplateError.prototype=Error.prototype,g.escape=function(a){return a.replace(e,f)},g.isFunction=function(a){return"[object Function]"==c.toString.call(a)},g.isArray=Array.isArray||function(a){return"[object Array]"==c.toString.call(a)},g.isString=function(a){return"[object String]"==c.toString.call(a)},g.isObject=function(a){return"[object Object]"==c.toString.call(a)},g.groupBy=function(a,b){for(var c={},d=g.isFunction(b)?b:function(a){return a[b]},e=0;e<a.length;e++){var f=a[e],h=d(f,e);(c[h]||(c[h]=[])).push(f)}return c},g.toArray=function(a){return Array.prototype.slice.call(a)},g.without=function(a){var b=[];if(!a)return b;for(var c=-1,d=a.length,e=g.toArray(arguments).slice(1);++c<d;)-1===g.indexOf(e,a[c])&&b.push(a[c]);return b},g.extend=function(a,b){for(var c in b)a[c]=b[c];return a},g.repeat=function(a,b){for(var c="",d=0;b>d;d++)c+=a;return c},g.each=function(a,c,d){if(null!=a)if(b.each&&a.each==b.each)a.forEach(c,d);else if(a.length===+a.length)for(var e=0,f=a.length;f>e;e++)c.call(d,a[e],e,a)},g.map=function(a,c){var d=[];if(null==a)return d;if(b.map&&a.map===b.map)return a.map(c);for(var e=0;e<a.length;e++)d[d.length]=c(a[e],e);return a.length===+a.length&&(d.length=a.length),d},g.asyncIter=function(a,b,c){function d(){e++,e<a.length?b(a[e],e,d,c):c()}var e=-1;d()},g.asyncFor=function(a,b,c){function d(){h++;var g=e[h];f>h?b(g,a[g],h,f,d):c()}var e=g.keys(a),f=e.length,h=-1;d()},g.indexOf=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){var d=this.length>>>0;for(c=+c||0,Math.abs(c)===1/0&&(c=0),0>c&&(c+=d,0>c&&(c=0));d>c;c++)if(a[c]===b)return c;return-1},Array.prototype.map||(Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}),g.keys=function(a){if(Object.prototype.keys)return a.keys();var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}}(),function(){function b(a,b,c){return function(){var f,g=e(arguments),h=d(arguments);if(g>a.length){f=Array.prototype.slice.call(arguments,0,a.length);for(var i=Array.prototype.slice.call(arguments,f.length,g),j=0;j<i.length;j++)j<b.length&&(h[b[j]]=i[j]);f.push(h)}else if(g<a.length){f=Array.prototype.slice.call(arguments,0,g);for(var j=g;j<a.length;j++){var k=a[j];f.push(h[k]),delete h[k]}f.push(h)}else f=arguments;return c.apply(this,f)}}function c(a){return a.__keywords=!0,a}function d(a){var b=a.length;if(b){var c=a[b-1];if(c&&c.hasOwnProperty("__keywords"))return c}return{}}function e(a){var b=a.length;if(0===b)return 0;var c=a[b-1];return c&&c.hasOwnProperty("__keywords")?b-1:b}function f(a){return"string"!=typeof a?a:void(this.val=a)}function g(a,b){return a instanceof f?new f(b):b.toString()}function h(a){var b=typeof a;return"string"===b?new f(a):"function"!==b?a:function(){var b=a.apply(this,arguments);return"string"==typeof b?new f(b):b}}function i(a,b){return a=void 0!==a&&null!==a?a:"",b&&"string"==typeof a&&(a=p.escape(a)),a}function j(a,b){return a=a||{},"function"==typeof a[b]?function(){return a[b].apply(a,arguments)}:a[b]}function k(a,b,c){if(!a)throw new Error("Unable to call `"+b+"`, which is undefined or falsey");if("function"!=typeof a)throw new Error("Unable to call `"+b+"`, which is not a function");return a.apply(this,c)}function l(a,b,c){var d=b.lookup(c);return void 0!==d&&null!==d?d:a.lookup(c)}function m(a,b,c){return a.lineno?a:new p.TemplateError(a,b,c)}function n(a,b,c,d){if(p.isArray(a)){var e=a.length;p.asyncIter(a,function(a,d,f){switch(b){case 1:c(a,d,e,f);break;case 2:c(a[0],a[1],d,e,f);break;case 3:c(a[0],a[1],a[2],d,e,f);break;default:a.push(d,f),c.apply(this,a)}},d)}else p.asyncFor(a,function(a,b,d,e,f){c(a,b,d,e,f)},d)}function o(a,b,c,d){function e(a,b){h++,g[a]=b,h==f&&d(null,g.join(""))}var f,g,h=0;if(p.isArray(a))if(f=a.length,g=new Array(f),0==f)d(null,"");else for(var i=0;i<a.length;i++){var j=a[i];switch(b){case 1:c(j,i,f,e);break;case 2:c(j[0],j[1],i,f,e);break;case 3:c(j[0],j[1],j[2],i,f,e);break;default:j.push(i,e),c.apply(this,j)}}else{var k=p.keys(a);if(f=k.length,g=new Array(f),0==f)d(null,"");else for(var i=0;i<k.length;i++){var l=k[i];c(l,a[l],i,f,e)}}}var p=a.lib,q=a.object,r=q.extend({init:function(a){this.variables={},this.parent=a},set:function(a,b,c){var d=a.split("."),e=this.variables,f=this;if(c){if(f=this.resolve(d[0]))return void f.set(a,b);f=this}for(var g=0;g<d.length-1;g++){var h=d[g];e[h]||(e[h]={}),e=e[h]}e[d[d.length-1]]=b},get:function(a){var b=this.variables[a];return void 0!==b&&null!==b?b:null},lookup:function(a){var b=this.parent,c=this.variables[a];return void 0!==c&&null!==c?c:b&&b.lookup(a)},resolve:function(a){var b=this.parent,c=this.variables[a];return null!=c?this:b&&b.resolve(a)},push:function(){return new r(this)},pop:function(){return this.parent}});f.prototype=Object.create(String.prototype),f.prototype.valueOf=function(){return this.val},f.prototype.toString=function(){return this.val},a.runtime={Frame:r,makeMacro:b,makeKeywordArgs:c,numArgs:e,suppressValue:i,memberLookup:j,contextOrFrameLookup:l,callWrap:k,handleError:m,isArray:p.isArray,keys:p.keys,SafeString:f,copySafeness:g,markSafe:h,asyncEach:n,asyncAll:o}}(),function(){var b=a.object,c=a.lib,d=b.extend({on:function(a,b){this.listeners=this.listeners||{},this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(b)},emit:function(a){var b=Array.prototype.slice.call(arguments,1);this.listeners&&this.listeners[a]&&c.each(this.listeners[a],function(a){a.apply(null,b)})}});a.loader=d}(),function(){var b=a.loader,c=b.extend({init:function(a,b){this.precompiled=window.nunjucksPrecompiled||{},this.baseURL=a||"",this.neverUpdate=b},getSource:function(a){if(this.precompiled[a])return{src:{type:"code",obj:this.precompiled[a]},path:a};var b=this.fetch(this.baseURL+"/"+a);return b?{src:b,path:a,noCache:!this.neverUpdate}:null},fetch:function(a){var b,c,d=!0;return window.XMLHttpRequest?b=new XMLHttpRequest:window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP")),b.onreadystatechange=function(){4!==b.readyState||0!==b.status&&200!==b.status||!d||(d=!1,c=b.responseText)},a+=(-1===a.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),b.open("GET",a,!1),b.send(),c}});a["web-loaders"]={WebLoader:c}}(),function(){a.loaders="undefined"==typeof window||window!==this?a["node-loaders"]:a["web-loaders"]}(),function(){var b=a.lib,c=a.runtime,d={abs:function(a){return Math.abs(a)},batch:function(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)f%b===0&&e.length&&(d.push(e),e=[]),e.push(a[f]);if(e.length){if(c)for(var f=e.length;b>f;f++)e.push(c);d.push(e)}return d},capitalize:function(a){var b=a.toLowerCase();return c.copySafeness(a,b.charAt(0).toUpperCase()+b.slice(1))},center:function(a,d){if(d=d||80,a.length>=d)return a;var e=d-a.length,f=b.repeat(" ",e/2-e%2),g=b.repeat(" ",e/2);return c.copySafeness(a,f+a+g)},"default":function(a,b){return a?a:b},dictsort:function(a,c,d){if(!b.isObject(a))throw new b.TemplateError("dictsort filter: val must be an object");var e=[];for(var f in a)e.push([f,a[f]]);var g;if(void 0===d||"key"===d)g=0;else{if("value"!==d)throw new b.TemplateError("dictsort filter: You can only sort by either key or value");g=1}return e.sort(function(a,d){var e=a[g],f=d[g];return c||(b.isString(e)&&(e=e.toUpperCase()),b.isString(f)&&(f=f.toUpperCase())),e>f?1:e==f?0:-1}),e},escape:function(a){return"string"==typeof a||a instanceof c.SafeString?b.escape(a):a},safe:function(a){return c.markSafe(a)},first:function(a){return a[0]},groupby:function(a,c){return b.groupBy(a,c)},indent:function(a,d,e){d=d||4;for(var f="",g=a.split("\n"),h=b.repeat(" ",d),i=0;i<g.length;i++)f+=0!=i||e?h+g[i]+"\n":g[i]+"\n";return c.copySafeness(a,f)},join:function(a,c,d){return c=c||"",d&&(a=b.map(a,function(a){return a[d]})),a.join(c)},last:function(a){return a[a.length-1]},length:function(a){return void 0!==a?a.length:0},list:function(a){if(b.isString(a))return a.split("");if(b.isObject(a)){var c=[];if(Object.keys)c=Object.keys(a);else for(var d in a)c.push(d);return b.map(c,function(b){return{key:b,value:a[b]}})}throw new b.TemplateError("list filter: type not iterable")},lower:function(a){return a.toLowerCase()},random:function(a){return a[Math.floor(Math.random()*a.length)]},replace:function(a,b,d,e){if(b instanceof RegExp)return a.replace(b,d);var f=a,g=f,h=1;for(f=f.replace(b,d);g!=f&&!(h>=e);)g=f,f=f.replace(b,d),h++;return c.copySafeness(a,f)},reverse:function(a){var e;return e=b.isString(a)?d.list(a):b.map(a,function(a){return a}),e.reverse(),b.isString(a)?c.copySafeness(a,e.join("")):e},round:function(a,b,c){b=b||0;var d,e=Math.pow(10,b);return d="ceil"==c?Math.ceil:"floor"==c?Math.floor:Math.round,d(a*e)/e},slice:function(a,b,c){for(var d=Math.floor(a.length/b),e=a.length%b,f=0,g=[],h=0;b>h;h++){var i=f+h*d;e>h&&f++;var j=f+(h+1)*d,k=a.slice(i,j);c&&h>=e&&k.push(c),g.push(k)}return g},sort:function(a,c,d,e){return a=b.map(a,function(a){return a}),a.sort(function(a,f){var g,h;return e?(g=a[e],h=f[e]):(g=a,h=f),!d&&b.isString(g)&&b.isString(h)&&(g=g.toLowerCase(),h=h.toLowerCase()),h>g?c?1:-1:g>h?c?-1:1:0}),a},string:function(a){return c.copySafeness(a,a)},title:function(a){for(var b=a.split(" "),e=0;e<b.length;e++)b[e]=d.capitalize(b[e]);return c.copySafeness(a,b.join(" "))},trim:function(a){return c.copySafeness(a,a.replace(/^\s*|\s*$/g,""))},truncate:function(a,b,d,e){var f=a;if(b=b||255,a.length<=b)return a;if(d)a=a.substring(0,b);else{var g=a.lastIndexOf(" ",b);-1===g&&(g=b),a=a.substring(0,g)}return a+=void 0!==e&&null!==e?e:"...",c.copySafeness(f,a)},upper:function(a){return a.toUpperCase()},urlencode:function(a){var c=encodeURIComponent;if(b.isString(a))return c(a);var d;if(b.isArray(a))d=a.map(function(a){return c(a[0])+"="+c(a[1])});else{d=[];for(var e in a)a.hasOwnProperty(e)&&d.push(c(e)+"="+c(a[e]))}return d.join("&")},urlize:function(a,b,c){isNaN(b)&&(b=1/0);var d=c===!0?' rel="nofollow"':"",e=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,f=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,g=/^https?:\/\/.*$/,h=/^www\./,i=/\.(?:org|net|com)(?:\:|\/|$)/,j=a.split(/\s+/).filter(function(a){return a&&a.length}).map(function(a){var c=a.match(e),j=c&&c[1]||a;return g.test(j)?'<a href="'+j+'"'+d+">"+j.substr(0,b)+"</a>":h.test(j)?'<a href="http://'+j+'"'+d+">"+j.substr(0,b)+"</a>":f.test(j)?'<a href="mailto:'+j+'">'+j+"</a>":i.test(j)?'<a href="http://'+j+'"'+d+">"+j.substr(0,b)+"</a>":a});return j.join(" ")},wordcount:function(a){var b=a?a.match(/\w+/g):null;return b?b.length:null},"float":function(a,b){var c=parseFloat(a);return isNaN(c)?b:c},"int":function(a,b){var c=parseInt(a,10);return isNaN(c)?b:c}};d.d=d["default"],d.e=d.escape,a.filters=d}(),function(){function b(a){var b=-1;return{current:null,reset:function(){b=-1,this.current=null},next:function(){return b++,b>=a.length&&(b=0),this.current=a[b],this.current}}}function c(a){a=a||",";var b=!0;return function(){var c=b?"":a;return b=!1,c}}var d={range:function(a,b,c){b?c||(c=1):(b=a,a=0,c=1);for(var d=[],e=a;b>e;e+=c)d.push(e);return d},cycler:function(){return b(Array.prototype.slice.call(arguments))},joiner:function(a){return c(a)}};a.globals=d}(),function(){var b=a.path,c=a.lib,d=a.object,e=(a.lexer,a.compiler),f=a.filters,g=a.loaders,h=a.runtime,i=a.globals,j=h.Frame,k=d.extend({init:function(a,b){b=b||{},this.dev=!!b.dev,this.lexerTags=b.tags,this.autoesc=!!b.autoescape,this.loaders=a?c.isArray(a)?a:[a]:g.FileSystemLoader?[new g.FileSystemLoader("views")]:[new g.WebLoader("/views")],this.initCache(),this.filters={},this.asyncFilters=[],this.extensions={},this.extensionsList=[];for(var d in f)this.addFilter(d,f[d])},initCache:function(){var a={};c.each(this.loaders,function(b){"function"==typeof b.on&&b.on("update",function(b){a[b]=null})}),this.cache=a},addExtension:function(a,b){b._name=a,this.extensions[a]=b,this.extensionsList.push(b)},getExtension:function(a){return this.extensions[a]},addGlobal:function(a,b){i[a]=b},addFilter:function(a,b,c){var d=b;c&&this.asyncFilters.push(a),this.filters[a]=d},getFilter:function(a){if(!this.filters[a])throw new Error("filter not found: "+a);return this.filters[a]},getTemplate:function(a,b,d){if(a&&a.raw&&(a=a.raw),c.isFunction(b)&&(d=b,b=!1),"string"!=typeof a)throw new Error("template names must be a string: "+a);var e=this.cache[a];if(!e){var f;return c.asyncIter(this.loaders,function(b,c,d,e){function f(a){a?e(a):d()}b.async?b.getSource(a,function(a,b){if(a)throw a;f(b)}):f(b.getSource(a))},function(c){if(c){var e=new m(c.src,this,c.path,b);c.noCache||(this.cache[a]=e),d?d(null,e):f=e}else{var g=new Error("template not found: "+a);if(!d)throw g;d(g)}}.bind(this)),f}return b&&e.compile(),d?void d(null,e):e},express:function(a){function c(a,c){if(this.name=a,this.path=a,this.defaultEngine=c.defaultEngine,this.ext=b.extname(a),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}var d=this;c.prototype.render=function(a,b){d.render(this.name,a,b)},a.set("view",c)},render:function(a,b,d){c.isFunction(b)&&(d=b,b=null);var e=null;return this.getTemplate(a,function(a,c){if(a&&d)d(a);else{if(a)throw a;c.render(b,d||function(a,b){if(a)throw a;e=b})}}),e},renderString:function(a,b,c){var d=new m(a,this);return d.render(b,c)}}),l=d.extend({init:function(a,b){this.ctx=a,this.blocks={},this.exported=[];for(var c in b)this.addBlock(c,b[c])},lookup:function(a){return a in i&&!(a in this.ctx)?i[a]:this.ctx[a]},setVariable:function(a,b){this.ctx[a]=b},getVariables:function(){return this.ctx},addBlock:function(a,b){this.blocks[a]=this.blocks[a]||[],this.blocks[a].push(b)},getBlock:function(a){if(!this.blocks[a])throw new Error('unknown block "'+a+'"');return this.blocks[a][0]},getSuper:function(a,b,d,e,f,g){var h=c.indexOf(this.blocks[b]||[],d),i=this.blocks[b][h+1],j=this;if(-1==h||!i)throw new Error('no super block available for "'+b+'"');i(a,j,e,f,g)},addExport:function(a){this.exported.push(a)},getExported:function(){for(var a={},b=0;b<this.exported.length;b++){var c=this.exported[b];a[c]=this.ctx[c]}return a}}),m=d.extend({init:function(a,b,d,e){if(this.env=b||new k,c.isObject(a))switch(a.type){case"code":this.tmplProps=a.obj;break;case"string":this.tmplStr=a.obj}else{if(!c.isString(a))throw new Error("src must be a string or an object describing the source");this.tmplStr=a}this.path=d,e?c.withPrettyErrors(this.path,this.env.dev,this._compile.bind(this)):this.compiled=!1},render:function(a,b,d){return"function"==typeof a?(d=a,a={}):"function"==typeof b&&(d=b,b=null),c.withPrettyErrors(this.path,this.env.dev,function(){try{this.compile()}catch(c){if(d)return d(c);throw c}var e=new l(a||{},this.blocks),f=null;return this.rootRenderFunc(this.env,e,b||new j,h,d||function(a,b){if(a)throw a;f=b}),f}.bind(this))},getExported:function(a,b,c){"function"==typeof a&&(c=a,a={}),"function"==typeof b&&(c=b,b=null);try{this.compile()}catch(d){if(c)return c(d);throw d}var e=new l(a||{},this.blocks);this.rootRenderFunc(this.env,e,b||new j,h,function(){c(null,e.getExported())})},compile:function(){this.compiled||this._compile()},_compile:function(){var a;if(this.tmplProps)a=this.tmplProps;else{var b=e.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.lexerTags),c=new Function(b);a=c()}this.blocks=this._getBlocks(a),this.rootRenderFunc=a.root,this.compiled=!0},_getBlocks:function(a){var b={};for(var c in a)"b_"==c.slice(0,2)&&(b[c.slice(2)]=a[c]);return b}});a.environment={Environment:k,Template:m}}();var b,c=a.lib,d=a.environment,e=a.compiler,f=a.parser,g=a.lexer,h=a.runtime,i=a.loader,j=a.loaders,k=a.precompile;b={},b.Environment=d.Environment,b.Template=d.Template,b.Loader=i,b.FileSystemLoader=j.FileSystemLoader,b.WebLoader=j.WebLoader,b.compiler=e,b.parser=f,b.lexer=g,b.runtime=h;var l;b.configure=function(a,b){b=b||{},c.isObject(a)&&(b=a,a=null);var e="watch"in b?!b.watch:!1,f=j.FileSystemLoader||j.WebLoader;return l=new d.Environment(new f(a,e),b),b&&b.express&&l.express(b.express),l},b.compile=function(a,c,d,e){return l||b.configure(),new b.Template(a,c,d,e)},b.render=function(a,c,d){return l||b.configure(),l.render(a,c,d)},b.renderString=function(a,c,d){return l||b.configure(),l.renderString(a,c,d)},k&&(b.precompile=k.precompile,b.precompileString=k.precompileString),b.require=function(b){return a[b]},"function"==typeof define&&define.amd?define(function(){return b}):(window.nunjucks=b,"undefined"!=typeof module&&(module.exports=b))}(),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.pica=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({"./":[function(a,b,c){"use strict";function d(a){return Object.prototype.toString.call(a)}function e(a){return"[object Function]"===d(a)}function f(b,d){var e,f={src:b.src,dest:null,width:0|b.width,height:0|b.height,toWidth:0|b.toWidth,toHeight:0|b.toHeight,quality:b.quality,alpha:b.alpha,unsharpAmount:b.unsharpAmount,unsharpThreshold:b.unsharpThreshold};return h&&c.WW?(e=a("webworkify")(l),e.onmessage=function(a){var c,f,g=b.dest,h=a.data.output;if(g)if(g.set)g.set(h);else for(c=0,f=h.length;f>c;c++)g[c]=h[c];d(a.data.err,h),e.terminate()},b.transferable?e.postMessage(f,[b.src.buffer]):e.postMessage(f),e):(f.dest=b.dest,void k(f,d))}function g(a,b,c,d){var g=a.width,h=a.height,i=b.width,j=b.height;e(c)&&(d=c,c={}),isNaN(c)||(c={quality:c,alpha:!1});var k=b.getContext("2d"),l=k.getImageData(0,0,i,j),m={src:a.getContext("2d").getImageData(0,0,g,h).data,dest:l.data,width:a.width,height:a.height,toWidth:b.width,toHeight:b.height,quality:c.quality,alpha:c.alpha,unsharpAmount:c.unsharpAmount,unsharpThreshold:c.unsharpThreshold,transferable:!0};return f(m,function(a){return a?void d(a):(k.putImageData(l,0,0),void d())})}var h="undefined"!=typeof window&&"Worker"in window;if(h)try{var i=a("webworkify")(function(){});i.terminate()}catch(j){h=!1}var k=a("./lib/resize"),l=a("./lib/resize_worker");c.resizeBuffer=f,c.resizeCanvas=g,c.WW=h},{"./lib/resize":4,"./lib/resize_worker":5,webworkify:6}],1:[function(a,b){"use strict";function c(a,b,c,d,f){var i,j,k,l,m,n,o,p=0,q=e,r=g;if(n=0,o=0,b>=r&&c>=r&&d>b+r&&f>c+r){for(j=0;3>j;j++)for(i=0;3>i;i++)k=b+i-r,l=c+j-r,o+=a[k+l*d]*q[p++];return(o-o%h)/h}for(j=0;3>j;j++)for(i=0;3>i;i++)k=b+i-r,l=c+j-r,k>=0&&d>k&&l>=0&&f>l&&(m=q[p],n+=m,o+=a[k+l*d]*m),p++;return(o-o%n)/n|0}function d(a,b,d){var e,f,g=new Uint16Array(a.length);for(e=0;b>e;e++)for(f=0;d>f;f++)g[f*b+e]=c(a,e,f,b,d);return g}for(var e=new Uint8Array([1,2,1,2,4,2,1,2,1]),f=Math.floor(Math.sqrt(e.length)),g=Math.floor(f/2),h=0,i=0;i<e.length;i++)h+=e[i];b.exports=d},{}],2:[function(a,b){"use strict";function c(a){return 0>a?0:a>255?255:a}function d(a){return Math.floor(a*l)}function e(a,b,c){var e,f,g,h,i,j,k,l,n,o,p,q,r,s,t,u,v,w=m[a].filter,x=c/b,y=1/x,z=Math.min(1,x),A=m[a].win/z,B=Math.floor(2*(A+1)),C=new Int16Array((B+2)*c),D=0;for(e=0;c>e;e++){for(f=(e+.5)*y,g=Math.max(0,Math.floor(f-A)),h=Math.min(b-1,Math.ceil(f+A)),i=h-g+1,j=new Float32Array(i),k=new Int16Array(i),l=0,o=g,p=0;h>=o;o++,p++)q=w((o+.5-f)*z),l+=q,j[p]=q;for(n=0,p=0;p<j.length;p++)r=d(j[p]/l),n+=r,k[p]=r;for(k[c>>1]+=d(1)-n,s=0;s<k.length&&0===k[s];)s++;if(s<k.length){for(t=k.length-1;t>0&&0===k[t];)t--;u=g+s,v=t-s+1,C[D++]=u,C[D++]=v,C.set(k.subarray(s,t+1),D),D+=v}else C[D++]=0,C[D++]=0}return C}function f(a,b,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=0,t=0;for(p=0;e>p;p++){for(l=0,q=0;f>q;q++){for(m=g[l++],n=g[l++],o=s+4*m|0,h=i=j=k=0;n>0;n--)r=g[l++],k=k+r*a[o+3]|0,j=j+r*a[o+2]|0,i=i+r*a[o+1]|0,h=h+r*a[o]|0,o=o+4|0;b[t+3]=c(k>>14),b[t+2]=c(j>>14),b[t+1]=c(i>>14),b[t]=c(h>>14),t=t+4*e|0}t=4*(p+1)|0,s=(p+1)*d*4|0}}function g(a,b,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=0,t=0;for(p=0;e>p;p++){for(l=0,q=0;f>q;q++){for(m=g[l++],n=g[l++],o=s+4*m|0,h=i=j=k=0;n>0;n--)r=g[l++],k=k+r*a[o+3]|0,j=j+r*a[o+2]|0,i=i+r*a[o+1]|0,h=h+r*a[o]|0,o=o+4|0;b[t+3]=c(k>>14),b[t+2]=c(j>>14),b[t+1]=c(i>>14),b[t]=c(h>>14),t=t+4*e|0}t=4*(p+1)|0,s=(p+1)*d*4|0}}function h(a,b,c){for(var d=3,e=b*c*4|0;e>d;)a[d]=255,d=d+4|0}function i(a){var b=a.src,c=a.width,d=a.height,i=a.toWidth,k=a.toHeight,l=a.dest||new Uint8Array(i*k*4),m=void 0===a.quality?3:a.quality,n=a.alpha||!1,o=void 0===a.unsharpAmount?0:0|a.unsharpAmount,p=void 0===a.unsharpThreshold?0:0|a.unsharpThreshold;if(1>c||1>d||1>i||1>k)return[];var q=e(m,c,i),r=e(m,d,k),s=new Uint8Array(i*d*4);return f(b,s,c,d,i,q),g(s,l,d,i,k,r),n||h(l,i,k),o&&j(l,i,k,o,1,p),l}var j=a("./unsharp"),k=14,l=1<<k,m=[{win:.5,filter:function(a){return a>=-.5&&.5>a?1:0}},{win:1,filter:function(a){if(-1>=a||a>=1)return 0;if(a>-1.1920929e-7&&1.1920929e-7>a)return 1;var b=a*Math.PI;return Math.sin(b)/b*(.54+.46*Math.cos(b/1))}},{win:2,filter:function(a){if(-2>=a||a>=2)return 0;if(a>-1.1920929e-7&&1.1920929e-7>a)return 1;var b=a*Math.PI;return Math.sin(b)/b*Math.sin(b/2)/(b/2)}},{win:3,filter:function(a){if(-3>=a||a>=3)return 0;if(a>-1.1920929e-7&&1.1920929e-7>a)return 1;var b=a*Math.PI;return Math.sin(b)/b*Math.sin(b/3)/(b/3)}}];b.exports=i},{"./unsharp":3}],3:[function(a,b){"use strict";function c(a){return 0>a?0:a>255?255:a}function d(a,b,c){var d,e,f=b*c,g=new Uint16Array(f);for(d=0,e=0;f>d;d++)g[d]=7471*a[e+2]+38470*a[e+1]+19595*a[e]>>>8,e=e+4|0;return g}function e(a,b,e,g,h,i){var j,k,l,m,n,o=0,p=Math.floor(256*g/50),q=d(a,b,e),r=f(q,b,e,1),s=i<<8,t=0;for(k=0;e>k;k++)for(j=0;b>j;j++)o=q[t]-r[t],Math.abs(o)>s&&(m=65536+(o*p>>8),n=4*t,l=a[n],a[n++]=c(l*m>>16),l=a[n],a[n++]=c(l*m>>16),l=a[n],a[n]=c(l*m>>16)),t++}var f=a("./blur");b.exports=e},{"./blur":1}],4:[function(a,b){"use strict";var c=a("./pure/resize");b.exports=function(a,b){var d=c(a);b(null,d)}},{"./pure/resize":2}],5:[function(a,b){"use strict";b.exports=function(b){var c=a("./resize");b.onmessage=function(a){c(a.data,function(a,c){return a?void b.postMessage({err:a}):void b.postMessage({output:c},[c.buffer])})}}},{"./resize":4}],6:[function(a,b){var c=arguments[3],d=arguments[4],e=arguments[5],f=JSON.stringify;b.exports=function(a){for(var b,g=Object.keys(e),h=0,i=g.length;i>h;h++){var j=g[h];if(e[j].exports===a){b=j;break}}if(!b){b=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var k={},h=0,i=g.length;i>h;h++){var j=g[h];k[j]=j}d[b]=[Function(["require","module","exports"],"("+a+")(self)"),k]}var l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[b]=b,d[l]=[Function(["require"],"require("+f(b)+")(self)"),m];var n="("+c+")({"+Object.keys(d).map(function(a){return f(a)+":["+d[a][0]+","+f(d[a][1])+"]"}).join(",")+"},{},["+f(l)+"])";return new Worker(window.URL.createObjectURL(new Blob([n],{type:"text/javascript"})))}},{}]},{},[])("./")}),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["color.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <h2>Color</h2>\n</div>\n<div class="m__color-item">\n    Brightness\n    <div id="brightnessSlider"></div>\n</div>\n<div class="m__color-item">\n    Vibrance\n    <div id="vibranceSlider"></div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["crop.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <button id="crop_ok">OK!</button>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["crop-resize.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="crop-resize">\n    <div class="crop-resize__action fit">\n        <h2>Fit to a rect</h2>\n\n        <div class="fit__sizes sizes">\n            <div class="sizes__width">\n                <label for="fitSizesWidth">Width</label><br />\n                <input type="number" id="fitSizesWidth"  /> px\n            </div>\n            <div class="sizes__height">\n                <label for="fitSizesHeight">Height</label><br />\n                <input type="number" id="fitSizesHeight" /> px\n            </div>\n        </div>\n\n        <div class="fit__methods">\n            <p>Choose Method:</p>\n            <ul class="module-list">\n                <li data-value="resize-all">Resizing on all sides</li>\n                <li data-value="stretch-to-width">Stretch width</li>\n                <li data-value="stretch-to-height">Stretch height</li>\n                <li data-value="stretch-to-rect">Stretch to rect</li>\n            </ul>\n\n            <div class="fit__methods-canvas">\n                <canvas id="fitCanvas"></canvas>\n            </div>\n        </div>\n\n        <div class="fit__method-position methods">\n            <p>Position:</p>\n            <div class="fit-position methods-list" id="fitPosition">\n                <div class="fp fp-left-top selected" style="left: 0; top: 0"></div>\n                <div class="fp fp-top" style="left: 20px; top: 0"></div>\n                <div class="fp fp-right-top" style="right: 0; top: 0"></div>\n                <div class="fp fp-left" style="left: 0; top: 20px"></div>\n                <div class="fp fp-right" style="right: 0; top: 20px"></div>\n                <div class="fp fp-left-bottom" style="left: 0; bottom: 0"></div>\n                <div class="fp fp-bottom" style="left: 20px; bottom: 0"></div>\n                <div class="fp fp-right-bottom" style="right: 0; bottom: 0"></div>\n            </div>\n        </div>\n\n        <div class="fit-crop__button">\n            <input type="checkbox" id="fitCrop" checked /> <label for="fitCrop">Crop image if its size is larger than the size of rectangle</label>\n        </div>\n\n        <div class="fit__button">\n            <button class="fit-button crop-button">Apply</button>\n        </div>\n    </div>\n\n    <div class="crop-resize__action crop" style="margin-top: 20px">\n        <h2>Crop</h2>\n\n        <div class="crop-sizes sizes">\n            <div class="crop__width">\n                <label for="cropSizesWidth">Width</label><br />\n                <input type="number" id="cropSizesWidth"  /> px\n            </div>\n            <div class="crop__height">\n                <label for="cropSizesHeight">Height</label><br />\n                <input type="number" id="cropSizesHeight" /> px\n            </div>\n        </div>\n\n        <div class="crop__method-position methods">\n            <p>Position:</p>\n            <div class="crop-position methods-list" id="cropPosition">\n                <div class="fp fp-left-top selected" style="left: 0; top: 0"></div>\n                <div class="fp fp-top" style="left: 20px; top: 0"></div>\n                <div class="fp fp-right-top" style="right: 0; top: 0"></div>\n                <div class="fp fp-left" style="left: 0; top: 20px"></div>\n                <div class="fp fp-center" style="left: 20px; top: 20px"></div>\n                <div class="fp fp-right" style="right: 0; top: 20px"></div>\n                <div class="fp fp-left-bottom" style="left: 0; bottom: 0"></div>\n                <div class="fp fp-bottom" style="left: 20px; bottom: 0"></div>\n                <div class="fp fp-right-bottom" style="right: 0; bottom: 0"></div>\n            </div>\n        </div>\n\n        <div class="fit__button">\n            <button class="crop-button" id="cropButton">Crop</button>\n        </div>\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["filter.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="m-filter">\n    <div class="m-filter__canvas">\n        <canvas id="mFilter-',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"filter"),"name",a.autoesc),a.autoesc),h+='" width="50" height="30"></canvas>\n    </div>\n\n    <div class="m-filter__name">',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"filter"),"displayName",a.autoesc),a.autoesc),h+='</div>\n\n    <div class="m-filter__vignette">\n        <input type="checkbox" checked id="mFilter-',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"filter"),"name",a.autoesc),a.autoesc),h+='-vignette" /> <br />\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["filters.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <h2>Filters</h2>\n</div>\n\n<div class="m-filters__filters-list">\n\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["resize-grid.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <input class="m_resize-width" type="text" placeholder="width" value="150" /> <br />\n    <input class="m_resize-height" type="text" placeholder="height"value="100" /> <br /> <br />\n\n    <button class="m_resize-ok" value="ok">OK!</button>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["resize-single.dialog.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div>\n    <h2>Size</h2>\n</div>\n\n<div class="m__single-resize">\n    <div class="m__single-resize__val width">\n        Width <br />\n        <input type="number" /> px\n    </div>\n\n    <div class="m__single-resize__lock">\n        <i class="\n        ',h+=d.contextOrFrameLookup(b,c,"isLocked")?"\n        fa fa-lock\n        ":"\n        fa fa-unlock\n        ",h+='"></i>\n    </div>\n\n    <div class="m__single-resize__val height">\n        Height <br />\n        <input type="number" /> px\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["editor.html.njs"]=function(){
function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="rs-editor-block">\n    <input type="file" id="rsFileInput" style="display: none" multiple />\n    <div id="rsToolbarPlace" class="rs-toolbar">\n        <div id="rsToolbarMainAction" class="rs-toolbar-button-block"></div>\n        <div id="rsToolbarEditorAction" class="rs-toolbar-button-block rs-editor-toolbar"></div>\n    </div>\n    <div class="rs-progress-bar" id="rsProgressBar">\n\n    </div>\n    <div class="rs-content">\n        <div id="rsImagePlace" class="rs-image-place"></div>\n        <div class="rs-popover">\n            <div id="rsPopover"></div>\n            <div id="rsInformation" class="rs-information">\n\n            </div>\n        </div>\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["grid.image.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="rs-image" data-id="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"id",a.autoesc),a.autoesc),h+='" id="img__',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"id",a.autoesc),a.autoesc),h+='">\n    <div class="rs-image-block">\n        <!--<img src="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"src",a.autoesc),a.autoesc),h+='" />-->\n        <!--',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"src",a.autoesc),a.autoesc),h+='-->\n    </div>\n    <div class="rs-image-data">\n        <div class="rs-image-data__inf">\n            <div class="rs-image-data__label">',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"label",a.autoesc),a.autoesc),h+='</div>\n            <div class="rs-image-data__name">',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"image"),"name",a.autoesc),a.autoesc),h+='</div>\n        </div>\n        <div class="rs-image-data__select">\n            <input type="checkbox" class="rs-image-selection-checkbox" />\n        </div>\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["grid.information.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<h2 class="rs-information__title">\n    Information\n</h2>\n<div class="rs-information__total">\n    <div>\n        Pictures <br />\n        <b>',h+=d.suppressValue(d.contextOrFrameLookup(b,c,"count"),a.autoesc),h+="</b>\n    </div>\n    <div>\n        Min resolution <br />\n        <b>",h+=d.suppressValue(d.contextOrFrameLookup(b,c,"minResolution"),a.autoesc),h+="</b>\n    </div>\n\n    <div>\n        Max resolution<br />\n        <b>",h+=d.suppressValue(d.contextOrFrameLookup(b,c,"maxResolution"),a.autoesc),h+='</b>\n    </div>\n</div>\n<div class="rs-information__resolution">\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["single.image.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div class="rs-single-image">\n    <div class="rs-canvas-place" id="rsSingleImage">\n    </div>\n</div>',e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["single.information.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<h2 class="rs-information__title">\n    Zoom\n</h2>\n<div class="rs-information__zoom">\n    <a href="#to-width" id="fitToWidth">Fit to width</a>\n    <a href="#source" id="sourceSize">Original size</a>\n\n    <div class="rs-information__zoom-value">\n        Actual zoom: <b id="zoomValue">100%</b>\n    </div>\n</div>\n\n<h2 class="rs-information__title">\n    Information\n</h2>\n<div class="rs-information__total">\n    <div>\n        Resolution <br />\n        <b>',h+=d.suppressValue(d.contextOrFrameLookup(b,c,"resolution"),a.autoesc),h+="</b>\n    </div>\n    <div>\n        Size <br />\n        <b>",h+=d.suppressValue(d.contextOrFrameLookup(b,c,"size"),a.autoesc),h+="</b>\n    </div>\n    <div>\n        Type <br />\n        <b>",h+=d.suppressValue(d.contextOrFrameLookup(b,c,"type"),a.autoesc),h+="</b>\n    </div>\n</div>",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}(),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["toolbar.button.html.njs"]=function(){function a(a,b,c,d,e){var f=null,g=null,h="";try{h+='<div id="t-button__',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"name",a.autoesc),a.autoesc),h+='" class="rs-toolbar-button ',""!=d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"css",a.autoesc)&&(h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"css",a.autoesc),a.autoesc)),h+='">\n    ',""!=d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"icon",a.autoesc)?(h+='\n    <i class="',h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"icon",a.autoesc),a.autoesc),h+='"></i>\n    '):(h+="\n        ",h+=d.suppressValue(d.memberLookup(d.contextOrFrameLookup(b,c,"button"),"localizedName",a.autoesc),a.autoesc),h+="\n    "),h+="\n</div>",e(null,h)}catch(i){e(d.handleError(i,f,g))}}return{root:a}}()}();var Core;!function(a){var b=function(){function a(a){this.current=-1,this.image=a,this.actions=[],this.actionsResult=[]}return a.prototype.process=function(a){return this.actions.splice(this.current+1),this.actions.push(a),this.current++,this.actionsResult.splice(this.current),this.actionsResult.push(this.doAction(a.execute,a)),_.last(this.actionsResult)},a.prototype.getUndoAction=function(){return this.current>=0?this.actions[this.current]:null},a.prototype.getRedoAction=function(){return this.current<this.actions.length-1?this.actions[this.current+1]:null},a.prototype.undo=function(){if(this.current>=0){var a=this.actions[this.current];return this.current--,this.actionsResult.push(this.doAction(a.unExecute,a)),_.last(this.actionsResult)}return Promise.resolve(this.image)},a.prototype.redo=function(){if(this.current<this.actions.length-1){this.current++;var a=this.actions[this.current];return this.actionsResult.push(this.doAction(a.execute,a)),_.last(this.actionsResult)}return Promise.resolve(this.image)},a.prototype.doAction=function(a,b){var c=this;return 0==this.actionsResult.length?a.apply(b):new Promise(function(d){_.last(c.actionsResult).then(function(){a.apply(b).then(function(a){d(a)})})})},a}();a.ActionDispatcher=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(b,c){this.imageName=b,this.imageType=c,this.id="",this.actionDispatcher=null,this.imageBase64="",this.image=null,this.caman=null,this.forceCamanUpdate=!1,this.isDeleted=!1,this.brightness=0,this.vibrance=0,this.hue=0,this.gamma=0,this.clip=0,this.stackBlur=0,this.contrast=0,this.saturation=0,this.exposure=0,this.sepia=0,this.noise=0,this.sharpen=0,this.filter=null,this.actionDispatcher=new a.ActionDispatcher(this)}return b.prototype.create=function(a){var b=this;return this.imageBase64=a,new Promise(function(a){b.createImagePromise(),b.getImage().then(function(c){var d=document.createElement("canvas"),e=d.getContext("2d");d.width=c.width,d.height=c.height,e.drawImage(c,0,0),b.originalImage=e.getImageData(0,0,c.width,c.height),b.imageBase64=d.toDataURL(b.imageType,.8),d.width=1,d.height=1,b.init(),a(b)})})},b.prototype.init=function(){this.processedImage=this.originalImage,this.width=this.originalImage.width,this.height=this.originalImage.height,this.brightness=0},b.prototype.getOriginalCoordinates=function(a,b){return{x:this.originalImage.width*a/this.processedImage.width|0,y:this.originalImage.height*b/this.processedImage.height|0}},b.prototype.getOriginalImage=function(){return this.originalImage},b.prototype.replaceOriginal=function(a){this.originalImage=a},b.prototype.crop=function(a,b,c,d){var e=document.createElement("canvas"),f=e.getContext("2d");e.width=this.originalImage.width,e.height=this.originalImage.height,f.putImageData(this.originalImage,0,0);var g=this.getOriginalCoordinates(a,b),h=this.getOriginalCoordinates(c,d);this.originalImage=null,this.originalImage=f.getImageData(g.x,g.y,h.x,h.y),this.width=c,this.height=d,this.forceCamanUpdate=!0},b.prototype.getCaman=function(a,b){return void 0===b&&(b=!1),b||null==this.caman?new Promise(function(b){var c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width,c.height=a.height,d.putImageData(a,0,0),Caman(c,function(){b(this)})}):Promise.resolve(this.caman)},b.prototype.save=function(){var b=this,c=document.createElement("canvas"),d=c.getContext("2d");c.width=this.originalImage.width,c.height=this.originalImage.height,console.time("save"),d.putImageData(this.originalImage,0,0);var e,f=!1;return this.forceCamanUpdate&&(f=!0,this.forceCamanUpdate=!1),this.width!=this.processedImage.width&&this.height!=this.processedImage.height&&(f=!0),e=this.width!=this.originalImage.width||this.height!=this.originalImage.height?new a.ImageResizer(this.originalImage,this.width,this.height).resize():Promise.resolve(d.getImageData(0,0,this.width,this.height)),c.width=1,c.height=1,c=null,e.then(function(a){return b.getCaman(a,f)}).then(function(a){return b.caman=a,b.caman.revert(),b.caman.brightness(b.brightness),b.caman.vibrance(b.vibrance),null!==b.filter&&b.caman[b.filter.name].apply(b.caman,b.filter.parameters),new Promise(function(a){b.caman.render(function(){a(b.caman.imageData)})})}).then(function(a){var c=document.createElement("canvas"),d=c.getContext("2d");return b.processedImage=null,b.processedImage=a,c.width=b.processedImage.width,c.height=b.processedImage.height,d.putImageData(b.processedImage,0,0),b.imageBase64=c.toDataURL(b.imageType,.8),c.width=1,c.height=1,c=null,b.getImage().then(function(){b.createImagePromise()}),console.timeEnd("save"),b})},b.prototype.getSize=function(){return Math.round(atob(this.getImageBase64().substr(this.getImageBase64().indexOf(";base64")+8)).length/1e3)},b.prototype.getImageData=function(){return this.processedImage},b.prototype.getWidth=function(){return this.processedImage.width},b.prototype.getHeight=function(){return this.processedImage.height},b.prototype.getName=function(){return this.imageName},b.prototype.getLabel=function(){return""},b.prototype.getType=function(){return this.imageType},b.prototype.getImageBase64=function(){return this.imageBase64},b.prototype.getActionDispatcher=function(){return this.actionDispatcher},b.prototype.setId=function(a){this.id=a},b.prototype.getId=function(){return this.id},b.prototype.createImagePromise=function(){var a=this;this.imagePromise=new Promise(function(b){var c=new Image;c.onload=function(){null!=a.image&&(a.image.src="about:blank"),a.image=c,b(a.image)},c.src=a.imageBase64})},b.prototype.getImage=function(){return this.imagePromise},b}();a.RsImage=b}(Core||(Core={}));var Core;!function(a){var b=function(){function a(a,b,c){this.original=a,this.newWidth=b,this.newHeight=c,this.size=this.original.data.length}return a.prototype.resize=function(){return this.picaResize()},a.prototype.picaResize=function(a){var b=this;return void 0===a&&(a=3),new Promise(function(c){pica.resizeBuffer({src:b.original.data,width:b.original.width,height:b.original.height,toWidth:b.newWidth,toHeight:b.newHeight,alpha:!0,quality:a},function(a,d){for(var e=document.createElement("canvas"),f=e.getContext("2d"),g=f.createImageData(b.newWidth,b.newHeight),h=0;h<d.length;h++)g.data[h]=d[h];e.width=1,e.height=1,c(g)})})},a}();a.ImageResizer=b}(Core||(Core={}));var Modules;!function(a){var b=function(){function a(a,b){this.image=a,this.brightness=b,this.needRender=!1}return a.prototype.execute=function(){return this.oldBrightness=this.image.brightness,this.image.brightness=this.brightness,this.image.save()},a.prototype.unExecute=function(){return this.image.brightness=this.oldBrightness,this.image.save()},a}();a.BrightnessAction=b}(Modules||(Modules={}));var Core;!function(a){!function(a){a[a.ACTION=0]="ACTION",a[a.DELEGATE=1]="DELEGATE",a[a.GROUP=2]="GROUP"}(a.ModuleType||(a.ModuleType={}));a.ModuleType}(Core||(Core={}));var Core;!function(a){var b=function(){function b(){this.images={},this.collections=[]}return b.prototype.newCollection=function(b){var c=new a.ImageCollection(this);for(var d in b)c.add(d);return this.collections.push(c),c},b.prototype.tryAdd=function(a){if(""==a.getId()){for(var b=Math.random().toString(36).substring(7);_.has(this.images,b);)b=Math.random().toString(36).substring(7);a.setId(b),this.add(a)}},b.prototype.add=function(a){this.images[a.getId()]=a},b.prototype.has=function(a){return _.has(this.images,a.getId())},b.prototype.remove=function(){},b}();a.ImageManager=b}(Core||(Core={}));var Core;!function(a){var b=function(){function a(a){this.manager=a,this.images=[]}return a.prototype.add=function(a){this.manager.tryAdd(a),this.images.push(a)},a.prototype.has=function(a){return this.images.indexOf(a)>-1},a.prototype.getResolutionStats=function(){var a={width:this.images[0].width,height:this.images[0].height},b={width:0,height:0};return this.images.forEach(function(c){c.isDeleted||(c.width*c.height<a.width*a.height&&(a.width=c.width,a.height=c.height),c.width*c.height>b.width*b.height&&(b.width=c.width,b.height=c.height))}),{min:a,max:b}},a.prototype.count=function(){return this.getImages().length},a.prototype.getAll=function(){return this.images},a.prototype.getImages=function(){var a=[];return this.images.forEach(function(b){b.isDeleted||a.push(b)}),a},a.prototype.getImage=function(b){var c=new a(this.manager);return this.images.forEach(function(a){a.isDeleted||a.getId()==b&&c.add(a)}),c},a.prototype.findImage=function(a){var b=[];return this.images.forEach(function(c){_.contains(a,c.getId())&&(c.isDeleted||b.push(c))}),b},a}();a.ImageCollection=b}(Core||(Core={}));var Core;!function(a){var b=function(){function a(){this.current=-1,this.actions=[]}return a.prototype.process=function(a){return this.actions.splice(this.current+1),this.actions.push(a),this.current++,a.execute()},a.prototype.undo=function(){if(this.current>=0){var a=this.actions[this.current];return this.current--,a.unExecute()}return!0},a.prototype.redo=function(){if(this.current<this.actions.length-1){this.current++;var a=this.actions[this.current];return a.execute()}return!0},a.prototype.canUndo=function(){return this.current>=0},a.prototype.canRedo=function(){return this.current<this.actions.length-1},a}();a.EditorActionDispatcher=b}(Core||(Core={}));var UI;!function(a){var b;!function(a){a[a.WIDTH=0]="WIDTH",a[a.HEIGHT=1]="HEIGHT",a[a.SOURCE=2]="SOURCE"}(b||(b={}));var c=function(){function a(a,b){this.page=a,this.image=b,this.needRefresh=!1,this.canvas=null,this.scale=1,this.scale=1,this.$loading=$('<div class="rs-singleView-loader" style="display: none"><i class="fa fa-cog fa-spin"></i> Rendering... </div>"')}return a.prototype.type=function(){return 0},a.prototype.getActualImage=function(){return[this.image]},a.prototype.update=function(){this.hideLoading(),this.needRefresh?this.render():(this.renderImage(),this.page.renderInformation(),$("#zoomValue").text(Math.floor(100*this.scale)+"%"))},a.prototype.setImages=function(a){if(1!=a.count())throw new Error("Invalid image collection");this.image=a.getImages()[0],this.scale=1},a.prototype.showLoading=function(){this.$loading.show()},a.prototype.hideLoading=function(){this.$loading.hide()},a.prototype.render=function(){var a=this;this.hideLoading(),this.page.getImagePlace().html(nunjucks.render("single.image.html.njs",{})),this.getCanvas(),this.renderImage(),this.setScale(this.scale);var b=$("body");b.off(".view"),b.on("click.view","#fitToWidth",function(){return a.setZoom(0),!1}),b.on("click.view","#sourceSize",function(){return a.setZoom(2),!1}),this.page.getImagePlace().find(".rs-single-image").append(this.$loading),this.needRefresh=!1},a.prototype.setZoom=function(a){var b=this.page.getImagePlace().find(".rs-single-image"),c=b.find("canvas"),d=1;0==a?(d=b.width()/c.width(),b.css("overflow","hidden")):2==a&&b.css("overflow","scroll"),this.setScale(d)},a.prototype.setScale=function(a){var b=this.page.getImagePlace().find(".rs-single-image"),c=b.find("canvas");b.scrollLeft(0),b.scrollTop(0),c.css("transform-origin","0 0"),c.css("transform","scale("+a+")"),this.scale=a,$("#zoomValue").text(Math.floor(100*a)+"%")},a.prototype.getScale=function(){return this.scale},a.prototype.selected=function(){return[this.image]},a.prototype.getAreaElement=function(){return this.page.getImagePlace().find("#rsSingleImage")},a.prototype.getInformation=function(){return nunjucks.render("single.information.html.njs",{resolution:this.image.width+"x"+this.image.height,size:this.image.getSize()+" kb",type:this.image.getType()})},a.prototype.renderImage=function(){this.canvas.width=this.image.getWidth(),this.canvas.height=this.image.getHeight(),this.context.putImageData(this.image.getImageData(),0,0)},a.prototype.getCanvas=function(){var a=this.page.getImagePlace().find("#"+this.image.getId());0==a.length&&this.page.getImagePlace().find("#rsSingleImage").html('<canvas id="'+this.image.getId()+'"></canvas>'),this.canvas=this.page.getImagePlace().find("#"+this.image.getId())[0],this.context=this.canvas.getContext("2d")},a}();a.SingleView=c}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a,b){this.page=a,this.imageCollection=b,this.needRefresh=!1}return a.prototype.type=function(){return 1},a.prototype.getActualImage=function(){return this.selected()},a.prototype.render=function(){var a=this;this.page.getImagePlace().html("");var b=this.imageCollection.getImages();this.needRefresh=!1,b.forEach(function(b){a.renderImage(b)})},a.prototype.setImages=function(a){this.imageCollection=a},a.prototype.getInformation=function(){if(this.imageCollection.count()>0){var a=this.imageCollection.getResolutionStats();return nunjucks.render("grid.information.html.njs",{count:this.imageCollection.count(),minResolution:a.min.width+"x"+a.min.height,maxResolution:a.max.width+"x"+a.max.height})}return""},a.prototype.selected=function(){var a=[];return this.page.getImagePlace().find(".rs-image-selected").each(function(b,c){a.push($(c).data("id"))}),this.imageCollection.findImage(a)},a.prototype.update=function(){var a=this;if(this.needRefresh)this.render();else{var b=this.imageCollection.getImages();b.forEach(function(b){a.updateImage(b)}),this.page.renderInformation()}},a.prototype.showLoading=function(){this.page.getImagePlace().find(".rs-image-selected").find(".rs-image-block").addClass("loading")},a.prototype.hideLoading=function(){this.page.getImagePlace().find(".rs-image-selected").find(".rs-image-block").removeClass("loading")},a.prototype.updateImage=function(a){var b=this.page.getImagePlace().find("#img__"+a.getId());a.getImage().then(function(a){var c=b.find(".rs-image-block");b.find("img").remove(),c[0].appendChild(a),c.removeClass("loading")})},a.prototype.renderImage=function(a){var b=this;a.getImage().then(function(c){if(!a.isDeleted){var d=$(nunjucks.render("grid.image.html.njs",{image:{src:c,name:a.getName(),id:a.getId(),label:a.getLabel()}}));d.find(".rs-image-block")[0].appendChild(c),b.page.getImagePlace().append(d)}})},a}();a.GridView=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(a,b){this.page=a,this.editor=b,this.$toolbar=this.editor.getInterface().getToolbarPlace().find("#rsToolbarMainAction"),this.$editorToolbar=this.editor.getInterface().getToolbarPlace().find("#rsToolbarEditorAction")}return a.prototype.render=function(){this.$toolbar.html(""),this.$editorToolbar.html(""),null!==this.page.getParent()&&this.page.getParent().images().count()>1&&this.renderBackButton(this.$toolbar),this.renderCommonButton(this.$toolbar)},a.prototype.renderDelimiter=function(a){a.append($('<div class="t-delimeter"></div>'))},a.prototype.renderModuleToolbar=function(a,b,c){var d=this;void 0===c&&(c="");var e=this.editor.getEditor().getModuleManager().getModules(this.editor.getType(),null);e.forEach(function(a){var e=$(nunjucks.render("toolbar.button.html.njs",{button:{name:a.name(),icon:a.icon(),localizedName:a.name(),css:c}}));b.append(e),d.editor.initModule(e,a)})},a.prototype.renderRemoveButton=function(a){a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"remove",icon:"fa fa-remove",localizedName:"remove"}})))},a.prototype.renderCommonButton=function(a){a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"upload",icon:"fa fa-upload",localizedName:"upload"}})))},a.prototype.renderUndoRedoButton=function(a){a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"undo",icon:"fa fa-undo",localizedName:"undo"}}))),a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"redo",icon:"fa fa-repeat",localizedName:"redo"}})))},a.prototype.renderBackButton=function(a){a.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"back",icon:"fa fa-arrow-left",localizedName:"back"}})))},a}();a.Toolbar=b}(UI||(UI={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},UI;!function(a){var b=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.render=function(){if(a.prototype.render.call(this),this.renderDelimiter(this.$toolbar),this.editor.selected().length>0){var b=$('<div class="rs-toolbar-group"></div>');this.$toolbar.append(b),this.renderUndoRedoButton(b),this.renderDelimiter(b),this.renderModuleToolbar(1,b,"t-grid-button"),this.renderDelimiter(b),this.renderRemoveButton(b)}this.editor.getActionDispather().canUndo()&&this.$editorToolbar.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"undo-editor",icon:"fa fa-undo",localizedName:"undo-editor"}}))),this.editor.getActionDispather().canRedo()&&this.$editorToolbar.append($(nunjucks.render("toolbar.button.html.njs",{button:{name:"redo-editor",icon:"fa fa-repeat",localizedName:"redo-editor"}}))),this.editor.getInterface().initToolbar(this.$toolbar),this.editor.getInterface().initEditorToolbar(this.$editorToolbar)},b}(a.Toolbar);a.GridToolbar=b}(UI||(UI={}));var UI;!function(a){var b=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.render=function(){a.prototype.render.call(this),this.renderDelimiter(this.$toolbar),this.renderUndoRedoButton(this.$toolbar);var b=$('<div class="rs-toolbar-group"></div>');this.$toolbar.append(b),this.renderModuleToolbar(0,b,"t-grid-button"),this.renderRemoveButton(b),this.editor.getInterface().initToolbar(this.$toolbar),this.editor.getInterface().initEditorToolbar(this.$editorToolbar)},b}(a.Toolbar);a.SingleToolbar=b}(UI||(UI={}));var UI;!function(a){var b=function(){function b(a,b,c){void 0===c&&(c=null),this.editor=a,this.imageCollection=b,this.parent=c,this.view=null}return b.prototype.hasParent=function(){return null!=this.parent},b.prototype.getParent=function(){return this.parent},b.prototype.setImages=function(a){this.imageCollection=a,this.getView().setImages(this.imageCollection)},b.prototype.appendImage=function(a){this.imageCollection.add(a)},b.prototype.images=function(){return this.imageCollection},b.prototype.getView=function(){return null!=this.view?this.view:(this.view=1==this.imageCollection.getImages().length?new a.SingleView(this,this.imageCollection.getImages()[0]):new a.GridView(this,this.imageCollection),this.view)},b.prototype.getToolbar=function(){return 1==this.imageCollection.getImages().length?new a.SingleToolbar(this,this.editor):new a.GridToolbar(this,this.editor)},b.prototype.renderInformation=function(){var a=this.getView().getInformation();""!=a?(this.getInformationPlace().parent().show(),this.getInformationPlace().html(a)):this.getInformationPlace().parent().hide()},b.prototype.renderToolbar=function(){this.getToolbar().render()},b.prototype.render=function(){this.renderToolbar(),this.getImagePlace().html(""),this.renderInformation(),this.getView().render()},b.prototype.getImagePlace=function(){return this.editor.getInterface().getImagePlace()},b.prototype.getInformationPlace=function(){return this.editor.getInterface().getInformationPlace()},b}();a.Page=b}(UI||(UI={}));var UI;!function(a){var b=function(){function a(){}return a.init=function(a,b,c){return 0==b.type()?this.initAction(a,b,c):1==b.type()?this.initDelegate(a,b,c):alert("GROUP!!!"),b},a.initAction=function(a,b){a.click(function(){b.process()})},a.initDelegate=function(a,b,c){var d=this;a.click(function(){$(".rs-toolbar-button").removeClass("active"),a.addClass("active"),d.renderModule(b,c)})},a.renderModule=function(a,b){return null!=b.getActiveModule()&&b.getActiveModule().deinit(),a.init(b.getInterface().showPopover(a.html())),b.setActiveModule(a),!1},a}();a.ModuleInitialization=b}(UI||(UI={}));var UI;!function(a){var b;!function(a){var b=function(){function a(){this.events={}}return a.prototype.on=function(a,b,c){return void 0===c&&(c="_"),_.has(this.events,a)||(this.events[a]={}),_.has(this.events[a],c)||(this.events[a][c]=[]),this.events[a][c].push(b),this},a.prototype.off=function(a){var b=this;void 0===a&&(a="_"),_.map(this.events,function(c,d){b.events[d]=_.omit(c,a)})},a.prototype.trigger=function(a,b){var c=this;void 0===b&&(b=null),_.has(this.events,a)&&_.map(this.events[a],function(a){a.forEach(function(a){a({data:b,widget:c})})})},a}();a.RsWidget=b}(b=a.Widgets||(a.Widgets={}))}(UI||(UI={}));var UI;!function(a){var b;!function(a){var b=function(a){function b(b){a.call(this),this.$el=b,this.$label=$('<div class="rs-progress-label"></div>'),this.$line=$('<div class="rs-progress-line"></div>'),this.$el.html(""),this.$el.append(this.$label),this.$el.append(this.$line)}return __extends(b,a),b.prototype.getOpCount=function(){return this.opCount},b.prototype.start=function(a,b){this.opCount=b,this.setProgress(0,a),this.trigger("start"),this.$el.show()},b.prototype.setProgress=function(a,b){this.$label.text(b),this.$line.css("width",a/this.opCount*100+"%"),a>=this.opCount?this.trigger("stop"):this.trigger("progress",a)},b.prototype.stop=function(a){var b=this;this.$label.text(a),setTimeout(function(){b.$el.hide()},200)},b}(a.RsWidget);a.RsProgressBar=b}(b=a.Widgets||(a.Widgets={}))}(UI||(UI={}));var UI;!function(a){var b=function(){function b(b,c){var d=this;this.$el=b,this.controller=c,this.$el.html(nunjucks.render("editor.html.njs",{}));var e=this.$el.find("#rsFileInput");e.on("change",function(){c.getEditor().getLoader().load(this.files)}),this.$el.on("click","#t-button__upload",function(){return e.trigger("click"),!1}),this.$el.on("click",".rs-image-block, .rs-image-data__inf",function(a){d.editImage($(a.target).closest(".rs-image").data("id"))}),this.$el.on("click","#t-button__back",function(){return d.controller.back(),!1}),this.$el.on("click",".rs-image-selection-checkbox",function(a){d.selectImage($(a.target).closest(".rs-image"))}),this.$popOver=this.$el.find("#rsPopover"),this.$toolbarPlace=this.$el.find("#rsToolbarPlace"),this.$imagePlace=this.$el.find("#rsImagePlace"),this.$informationPlace=this.$el.find("#rsInformation"),this.progressBar=new a.Widgets.RsProgressBar(this.$el.find("#rsProgressBar")),this.progressBar.on("stop",function(){d.progressBar.stop("Loading complete!")})}return b.prototype.showProgressBar=function(a){this.progressBar.start("Loading image...",a)},b.prototype.progress=function(a){this.progressBar.setProgress(a,"Image "+a+" from "+this.progressBar.getOpCount())},b.prototype.showPopover=function(a){return this.$popOver.html(a),this.$popOver.show(),this.$popOver},b.prototype.clearPopover=function(){this.$popOver.html(""),this.$popOver.hide()},b.prototype.getImagePlace=function(){return this.$imagePlace},b.prototype.getToolbarPlace=function(){return this.$toolbarPlace},b.prototype.getInformationPlace=function(){return this.$informationPlace},b.prototype.initToolbar=function(a){var b=this;null!=this.controller.getActiveModule()&&a.find("#t-button__"+this.controller.getActiveModule().name()).addClass("active"),a.find("#t-button__redo").click(function(){return b.controller.getActions().imageRedo(),!1}),a.find("#t-button__undo").click(function(){return b.controller.getActions().imageUndo(),!1}),a.find("#t-button__remove").click(function(){return b.controller.getActions().removeSelected(),!1})},b.prototype.initEditorToolbar=function(a){var b=this;a.find("#t-button__redo-editor").click(function(){return b.controller.getActions().redo(),!1}),a.find("#t-button__undo-editor").click(function(){return b.controller.getActions().undo(),!1})},b.prototype.editImage=function(a){this.controller.openImageEditor(this.controller.getImages().getImage(a))},b.prototype.selectImage=function(a){var b=this.controller.getImages().getImage(a.data("id")).getImages()[0];a.hasClass("rs-image-selected")?(a.removeClass("rs-image-selected"),this.controller.unSelectImage(b)):(a.addClass("rs-image-selected"),this.controller.selectImage(b))},b}();a.EditorView=b}(UI||(UI={}));var EditorAction;!function(a){var b=function(){function a(a,b){this.editor=a,this.images=b}return a.prototype.execute=function(){return this.images.forEach(function(a){a.isDeleted=!0}),!0},a.prototype.unExecute=function(){return this.images.forEach(function(a){a.isDeleted=!1}),!0},a}();a.RemoveAction=b}(EditorAction||(EditorAction={}));var UI;!function(a){var b=function(){function a(a){this.controller=a}return a.prototype.imageUndo=function(){this.imageHistoryAction("Undo")},a.prototype.imageRedo=function(){this.imageHistoryAction("Redo")},a.prototype.redo=function(){this.controller.getActionDispather().redo(),this.controller.render()},a.prototype.undo=function(){this.controller.getActionDispather().undo(),this.controller.render()},a.prototype.removeSelected=function(){var a=new EditorAction.RemoveAction(this.controller,this.getView().selected());this.controller.getActionDispather().process(a),0==this.controller.getType()?this.controller.back():this.controller.render()},a.prototype.doModuleAction=function(a,b){if(void 0===b&&(b=2),null!=this.controller.getActiveModule()){var c=this.controller.getActiveModule();(c.viewType()==b||2==c.viewType())&&a.call(this.controller,c)}},a.prototype.getView=function(){return this.controller.getView()},a.prototype.imageHistoryAction=function(a){var b=this,c=[];this.getView().showLoading(),this.getView().getActualImage().forEach(function(d){var e=d.getActionDispatcher()["get"+a+"Action"]();e&&e.needRender&&(b.getView().needRefresh=!0),c.push(d.getActionDispatcher()[a.toLowerCase()]())}),Promise.all(c).then(function(){b.getView().update(),b.doModuleAction(function(a){a.update()},b.controller.getType())})},a}();a.EditorActions=b}(UI||(UI={}));var UI;!function(a){var b=function(){function b(b,c,d){this.$el=b,this.editor=c,this.images=d,this.page=null,this.gridPage=null,this.singlePage=null,this.activeModule=null,this.editorView=new a.EditorView(b,this),this.editorAction=new a.EditorActions(this),this.gridPage=new a.Page(this,this.images),this.singlePage=new a.Page(this,this.images,this.gridPage),this.actionController=new Core.EditorActionDispatcher}return b.prototype.getActionDispather=function(){return this.actionController},b.prototype.getInterface=function(){return this.editorView},b.prototype.getActions=function(){return this.editorAction},b.prototype.initModule=function(b,c){a.ModuleInitialization.init(b,c,this)},b.prototype.getActiveModule=function(){return this.activeModule},b.prototype.setActiveModule=function(a){this.activeModule=a},b.prototype.getView=function(){return this.getPage().getView()},b.prototype.back=function(){this.page.hasParent()&&(this.page=this.page.getParent(),this.render())},b.prototype.selected=function(){return this.getPage().getView().selected()},b.prototype.getEditor=function(){return this.editor},b.prototype.getPage=function(){return null==this.page&&(this.page=1==this.images.count()?this.singlePage:this.gridPage),this.page},b.prototype.getType=function(){return this.getPage().getView().type();

},b.prototype.render=function(){var b=this;null!=this.activeModule&&this.activeModule.deinit(),this.getPage().render(),this.getActions().doModuleAction(function(){a.ModuleInitialization.renderModule(b.activeModule,b)},this.getType())},b.prototype.appendImage=function(a){this.gridPage.appendImage(a),1==this.images.count()?(this.singlePage.setImages(this.images.getImage(this.images.getImages()[0].getId())),this.page=this.singlePage):this.page=this.gridPage},b.prototype.openImageEditor=function(a){this.singlePage.setImages(a),this.page=this.singlePage,this.render()},b.prototype.getImages=function(){return this.images},b.prototype.unSelectImage=function(a){var b=this;this.page.renderToolbar(),this.getActions().doModuleAction(function(){b.activeModule.unSelectImage(a)},this.getType())},b.prototype.selectImage=function(a){var b=this;this.page.renderToolbar(),this.getActions().doModuleAction(function(){b.activeModule.selectImage(a)},this.getType())},b}();a.Editor=b}(UI||(UI={}));var Core;!function(a){!function(a){a[a.SINGLE=0]="SINGLE",a[a.GRID=1]="GRID",a[a.ANY=2]="ANY"}(a.ModuleViewType||(a.ModuleViewType={}));var b=(a.ModuleViewType,function(){function a(a){this.editor=a,this.modules={},this.registerModule("resize",new Modules.ResizeModule(this.editor.UI()),0),this.registerModule("color",new Modules.ColorModule(this.editor.UI()),2),this.registerModule("filter",new Modules.FilterModule(this.editor.UI()),2),this.registerModule("crop",new Modules.CropModule(this.editor.UI()),0),this.registerModule("crop-resize",new Modules.CropResizeModule(this.editor.UI()),1)}return a.prototype.registerModule=function(a,b,c){a in this.modules||(this.modules[a]={module:b,type:c})},a.prototype.getModule=function(a){if(a in this.modules)return this.modules[a].module;throw new Error("Invalid module name")},a.prototype.getModules=function(a,b){return void 0===a&&(a=2),void 0===b&&(b=null),_.map(_.filter(this.modules,function(c){return c.type!=a&&2!=a&&2!=c.type||c.module.parent()!=b?!1:!0}),function(a){return a.module})},a}());a.ModuleManager=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(a){this.editor=a,this.total=0,this.total=0}return b.prototype.load=function(a){var b=this,c=0;this.total=0,this.editor.UI().getInterface().showProgressBar(a.length);var d=new Promise(function(d){var e=setInterval(function(){if(c<a.length){var f=!1;c==a.length-1&&(f=!0),b.loadFile(a[c],d,f),c++}else clearInterval(e)},100)});d.then(function(){b.editor.UI().render()})},b.prototype.loadFile=function(b,c,d){var e=this;if(!b.type.match(/image.*/))return!1;var f=new FileReader;f.onload=function(f){var g=new a.RsImage(b.name,b.type);g.create(f.target.result).then(function(a){e.editor.appendImage(a),e.total++,e.editor.UI().getInterface().progress(e.total),d&&c(1)})},f.readAsDataURL(b)},b}();a.ImageLoader=b}(Core||(Core={}));var Core;!function(a){var b=function(){function b(b){this.imageManager=new a.ImageManager,this.ui=new UI.Editor(b,this,this.imageManager.newCollection([])),this.moduleManager=new a.ModuleManager(this),this.loader=new a.ImageLoader(this),this.ui.render()}return b.prototype.UI=function(){return this.ui},b.prototype.getModuleManager=function(){return this.moduleManager},b.prototype.appendImage=function(a){this.ui.appendImage(a)},b.prototype.getLoader=function(){return this.loader},b.prototype.getImageManager=function(){return this.imageManager},b}();a.RsImageEditor=b}(Core||(Core={}));var UI;!function(a){var b;!function(a){var b=function(a){function b(b,c,d,e,f){var g=this;void 0===e&&(e=1),void 0===f&&(f=0),a.call(this),this.$el=b,this.min=c,this.max=d,this.step=e,this.start=f,this.$slider=$('<div class="rs-slider-handle"></div>'),this.$el.html(""),this.$el.addClass("rs-slider"),this.$el.append(this.$slider),this.$slider.css("left",this.getPixelPos(this.start)+"px");var h=$(document);this.$slider.mousedown(function(a){var b=a.clientX-parseInt(g.$slider.css("left"));h.off(".RsSlider"),h.on("mousemove.RsSlider",function(a){var c=a.clientX-b;0>c&&(c=0);var d=g.$el.width()-g.$slider.width();c>d&&(c=d),g.$slider.css("left",c+"px"),g.trigger("move",g.getVal(c))}),h.on("mouseup.RsSlider",function(){var a=parseInt(g.$slider.css("left"));g.trigger("stopmove",g.getVal(a)),h.off(".RsSlider")})}),this.on("move",function(a){g.$slider.text(a.data)}),this.trigger("move",this.start)}return __extends(b,a),b.prototype.set=function(a,b){void 0===b&&(b=""),this.$slider.css("left",this.getPixelPos(a)+"px"),this.$slider.text(""==b?a.toString():b)},b.prototype.getVal=function(a){return Math.round(a*((this.max-this.min)/this.step)/(this.$el.width()-this.$slider.width()))*this.step+this.min},b.prototype.getPixelPos=function(a){return(a-this.min)/this.step*(this.$el.width()-this.$slider.width())/((this.max-this.min)/this.step)},b}(a.RsWidget);a.RsSlider=b}(b=a.Widgets||(a.Widgets={}))}(UI||(UI={}));var Modules;!function(a){var b=function(){function b(a){this.editor=a}return b.prototype.html=function(){return nunjucks.render("color.dialog.html.njs",{})},b.prototype.viewType=function(){return 2},b.prototype.unSelectImage=function(){this.updateSelectState()},b.prototype.selectImage=function(){this.updateSelectState()},b.prototype.update=function(){this.updateSelectState()},b.prototype.updateSelectState=function(){var a=this.editor.selected();if(1==a.length){var b=a[0];this.brightnessSlider.set(b.brightness),this.vibranceSlider.set(b.vibrance)}else a.length>0?(this.setSliderValue("brightness",this.brightnessSlider,a),this.setSliderValue("vibrance",this.vibranceSlider,a)):(this.brightnessSlider.set(0,"-"),this.vibranceSlider.set(0,"-"))},b.prototype.setSliderValue=function(a,b,c){for(var d=c[0][a],e=0;e<c.length;e++)if(d!=c[e][a])return void b.set(0,"-");b.set(d)},b.prototype.init=function(b){var c=this,d=0,e=0;if(0==this.editor.getType()){var f=this.editor.selected()[0];d=f.brightness,e=f.vibrance}this.brightnessSlider=new UI.Widgets.RsSlider(b.find("#brightnessSlider"),-100,100,1,d),this.brightnessSlider.on("stopmove",function(b){c.doAction(a.BrightnessAction,b.data)}),this.vibranceSlider=new UI.Widgets.RsSlider(b.find("#vibranceSlider"),-200,200,5,e),this.vibranceSlider.on("stopmove",function(b){c.doAction(a.VibranceAction,b.data)})},b.prototype.deinit=function(){this.editor.getInterface().clearPopover()},b.prototype.icon=function(){return"fa fa-image"},b.prototype.type=function(){return 1},b.prototype.parent=function(){return null},b.prototype.name=function(){return"color"},b.prototype.doAction=function(a,b){var c=this;this.editor.getView().showLoading();var d=[];this.editor.selected().forEach(function(c){var e=new a(c,b);d.push(c.getActionDispatcher().process(e))}),Promise.all(d).then(function(){c.editor.getView().update()})},b}();a.ColorModule=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function a(a,b){this.image=a,this.value=b,this.needRender=!1}return a.prototype.execute=function(){return this.oldValue=this.image.vibrance,this.image.vibrance=this.value,this.image.save()},a.prototype.unExecute=function(){return this.image.vibrance=this.oldValue,this.image.save()},a}();a.VibranceAction=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function a(a,b,c,d,e,f){void 0===f&&(f=null),this.image=a,this.left=b,this.top=c,this.width=d,this.height=e,this.position=f,this.needRender=!1}return a.prototype.execute=function(){this.oldWidth=this.image.getWidth(),this.oldHeight=this.image.getHeight(),this.originalImage=this.image.getOriginalImage();var a=this.left,b=this.top;return null!=this.position&&(1==this.position||7==this.position||4==this.position?a=(this.image.width-this.width)/2:(2==this.position||5==this.position||8==this.position)&&(a=this.image.width-this.width),3==this.position||5==this.position||4==this.position?b=(this.image.height-this.height)/2:(6==this.position||7==this.position||8==this.position)&&(b=this.image.height-this.height)),this.image.crop(a,b,this.width,this.height),this.image.save()},a.prototype.unExecute=function(){return this.image.width=this.oldWidth,this.image.height=this.oldHeight,this.image.replaceOriginal(this.originalImage),this.image.save()},a}();a.CropAction=b}(Modules||(Modules={}));var UI;!function(a){var b;!function(a){var b=function(a){function b(b,c,d){a.call(this),this.$el=b,this.$parent=c,this.index=d,this.itemHalfSize=5,this.init()}return __extends(b,a),b.prototype.getElementCorners=function(){var a={x:this.$el.position().left,y:this.$el.position().top},b={x:a.x+this.$el.width(),y:a.y},c={x:a.x+this.$el.width(),y:a.y+this.$el.height()},d={x:a.x,y:a.y+this.$el.height()};return{topLeft:a,topRight:b,bottomRight:c,bottomLeft:d}},b.prototype.getPosition=function(){return this.position},b.prototype.getIndex=function(){return this.index},b.prototype.toPlace=function(){var a,b=this.getElementCorners();0==this.index?a=b.topLeft:1==this.index?a={x:b.topLeft.x+(b.topRight.x-b.topLeft.x)/2,y:b.topRight.y}:2==this.index?a=b.topRight:3==this.index?a={x:b.topRight.x,y:b.topRight.y+(b.bottomRight.y-b.topRight.y)/2}:4==this.index?a=b.bottomRight:5==this.index?a={x:b.topLeft.x+(b.topRight.x-b.topLeft.x)/2,y:b.bottomRight.y}:6==this.index?a=b.bottomLeft:7==this.index&&(a={x:b.topLeft.x,y:b.topRight.y+(b.bottomRight.y-b.topRight.y)/2}),this.position=a,this.$item.css({left:a.x-this.itemHalfSize+"px",top:a.y-this.itemHalfSize+"px"})},b.prototype.init=function(){var a=this;this.$item=$('<div class="rs-resizable-item item_'+this.index+'"></div>'),this.$parent.append(this.$item),this.toPlace();var b=$(document);this.$item.mousedown(function(c){var d=c.clientX-parseInt(a.$item.css("left"))-a.itemHalfSize,e=c.clientY-parseInt(a.$item.css("top"))-a.itemHalfSize;b.on("mousemove.RsResize_"+a.index,function(b){var c={x:b.clientX-d,y:b.clientY-e};a.moveItem(c),a.trigger("move",{index:a.index,newPosition:a.position,oldPosition:{x:d,y:e}})}),b.on("mouseup.RsResize_"+a.index,function(){b.off(".RsResize_"+a.index)})})},b.prototype.moveItem=function(a){var b=this.getElementCorners();(0==this.index||7==this.index||6==this.index)&&a.x>=b.topRight.x-10&&(a.x=b.topRight.x-10),(0==this.index||1==this.index||2==this.index)&&a.y>=b.bottomRight.y-10&&(a.y=b.bottomRight.y-10),this.$item.css(1==this.index||5==this.index?{top:a.y-5+"px"}:7==this.index||3==this.index?{left:a.x-5+"px"}:{left:a.x-5+"px",top:a.y-5+"px"}),this.position={x:parseInt(this.$item.css("left"))+5,y:parseInt(this.$item.css("top"))+5}},b}(a.RsWidget),c=function(a){function c(c,d){var e=this;a.call(this),this.$el=c,this.$parent=d,this.items=[],this.$el.addClass("rs-resizable");for(var f=0;8>f;f++){var g=new b(this.$el,this.$parent,f);this.items.push(g),g.on("move",function(a){e.onItemMove(a.data.index,a.data.newPosition,a.data.oldPosition)})}var h=$(document);this.$el.mousedown(function(a){var b=a.clientX-parseInt(e.$el.css("left")),c=a.clientY-parseInt(e.$el.css("top"));h.on("mousemove.RsResize",function(a){var d={x:a.clientX-b,y:a.clientY-c};e.$el.css({left:d.x,top:d.y}),e.updateItems()}),h.on("mouseup.RsResize",function(){h.off(".RsResize")})})}return __extends(c,a),c.prototype.onItemMove=function(a,b){0==a?(this.$el.css({left:b.x+"px",top:b.y+"px",width:this.items[4].getPosition().x-b.x+"px",height:this.items[4].getPosition().y-b.y+"px"}),this.updateItems([4])):1==a?(this.$el.css({top:b.y+"px",height:this.items[4].getPosition().y-b.y+"px"}),this.updateItems([4])):2==a?(this.$el.css({right:b.x+"px",top:b.y+"px",width:b.x-this.items[6].getPosition().x+"px",height:this.items[6].getPosition().y-b.y+"px"}),this.updateItems([6])):3==a?(this.$el.css({right:b.x+"px",width:b.x-this.items[6].getPosition().x+"px"}),this.updateItems([6])):4==a?(this.$el.css({right:b.x+"px",bottom:b.y+"px",width:b.x-this.items[0].getPosition().x+"px",height:b.y-this.items[0].getPosition().y+"px"}),this.updateItems([0])):5==a?(this.$el.css({bottom:b.y+"px",height:b.y-this.items[0].getPosition().y+"px"}),this.updateItems([0])):6==a?(this.$el.css({left:b.x+"px",bottom:b.y+"px",width:this.items[2].getPosition().x-b.x+"px",height:b.y-this.items[2].getPosition().y+"px"}),this.updateItems([2])):7==a&&(this.$el.css({left:b.x+"px",width:this.items[2].getPosition().x-b.x+"px"}),this.updateItems([2]))},c.prototype.getBounds=function(){return{width:this.$el.width(),height:this.$el.height(),left:this.items[0].getPosition().x,top:this.items[0].getPosition().y}},c.prototype.updateItems=function(a){void 0===a&&(a=[]),this.trigger("resize",{width:this.$el.width(),height:this.$el.height(),left:this.items[0].getPosition().x,top:this.items[0].getPosition().y}),this.items.forEach(function(b){_.contains(a,b.getIndex())||b.toPlace()})},c}(a.RsWidget);a.RsResizable=c}(b=a.Widgets||(a.Widgets={}))}(UI||(UI={}));var Modules;!function(a){var b=function(){function b(a){this.editor=a,this.view=null}return b.prototype.html=function(){return nunjucks.render("crop.dialog.html.njs",{})},b.prototype.selectImage=function(){},b.prototype.unSelectImage=function(){},b.prototype.update=function(){},b.prototype.deinit=function(){this.editor.getInterface().clearPopover(),null!=this.view&&(this.$cropRect.remove(),this.view.getAreaElement().find(".rs-resizable-item").remove())},b.prototype.viewType=function(){return 0},b.prototype.init=function(){var a=this;this.view=this.editor.getView(),this.$cropRect=$('<div class="crop-rect"></div>'),this.view.getAreaElement().append(this.$cropRect),this.cropResizableWidget=new UI.Widgets.RsResizable(this.$cropRect,this.view.getAreaElement()),$("#crop_ok").click(function(){var b=a.cropResizableWidget.getBounds(),c=Math.round(b.width/a.view.getScale());a.doAction(b.left/a.view.getScale(),b.top/a.view.getScale(),c,b.height/a.view.getScale())})},b.prototype.icon=function(){return"fa fa-crop"},b.prototype.type=function(){return 1},b.prototype.parent=function(){return null},b.prototype.name=function(){return"crop"},b.prototype.doAction=function(b,c,d,e){var f=this,g=[];this.editor.selected().forEach(function(f){var h=new a.CropAction(f,b,c,d,e);g.push(f.getActionDispatcher().process(h))}),Promise.all(g).then(function(){f.editor.render()})},b}();a.CropModule=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function b(a){this.editor=a,this.images=[],this.fit=null,this.crop=null}return b.prototype.init=function(a){this.view=this.editor.getView(),this.$el=a,this.update()},b.prototype.deleteHelpers=function(){null!=this.fit&&(this.fit.destroy(),this.fit=null),null!=this.crop&&(this.crop.destroy(),this.crop=null)},b.prototype.initFit=function(){var b=this;this.fit=new a.Fit(this.$el,this.images,this.editor),this.fit.on("apply",function(a){b.doAction(b.createFitActions(a.data.rect,a.data.method,a.data.fitPosition,a.data.isCanCrop))})},b.prototype.initCrop=function(){var b=this;this.crop=new a.Crop(this.$el,this.images,this.editor),this.crop.on("apply",function(a){b.doAction(b.createCropActions(a.data.size,a.data.fitPosition))})},b.prototype.update=function(){this.deleteHelpers(),this.images=this.editor.selected(),this.images.length>0?(this.$el.show(),this.initFit(),this.initCrop()):this.$el.hide()},b.prototype.createCropActions=function(b,c){this.editor.getView().showLoading();var d=[];return this.editor.selected().forEach(function(e){var f=new a.CropAction(e,0,0,b.width,b.height,c);d.push(e.getActionDispatcher().process(f))}),d},b.prototype.createFitActions=function(b,c,d,e){this.editor.getView().showLoading();var f=[];return this.editor.selected().forEach(function(g){var h=new a.FitAction(g,b,c,d,e);f.push(g.getActionDispatcher().process(h))}),f},b.prototype.doAction=function(a){var b=this;Promise.all(a).then(function(){b.editor.getView().update()})},b.prototype.html=function(){return nunjucks.render("crop-resize.dialog.html.njs",{})},b.prototype.selectImage=function(){this.update()},b.prototype.unSelectImage=function(){this.update()},b.prototype.viewType=function(){return 1},b.prototype.icon=function(){return"fa fa-crop"},b.prototype.type=function(){return 1},b.prototype.parent=function(){return null},b.prototype.name=function(){return"crop-resize"},b.prototype.deinit=function(){this.deleteHelpers(),this.editor.getInterface().clearPopover()},b}();a.CropResizeModule=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function b(b,c,d,e,f){this.image=b,this.rect=c,this.method=d,this.position=e,this.isCanCrop=f,this.needRender=!1,this.isCropped=!1,this.size=0==d?a.SizeCalculation.getFitSize(c.width,c.height,this.image.width,this.image.height):1==d?a.SizeCalculation.getStretchWidthSize(c.width,c.height,this.image.width,this.image.height):2==d?a.SizeCalculation.getStretchHeightSize(c.width,c.height,this.image.width,this.image.height):a.SizeCalculation.getStretchRectSize(c.width,c.height,this.image.width,this.image.height)}return b.prototype.execute=function(){var a=this;return this.oldWidth=this.image.getWidth(),this.oldHeight=this.image.getHeight(),(this.size.width>this.rect.width||this.size.height>this.rect.height)&&(this.originalImage=this.image.getOriginalImage(),this.isCropped=!0),this.image.width=0|this.size.width,this.image.height=0|this.size.height,this.image.save().then(function(b){if(a.isCropped&&a.isCanCrop){var c=0,d=0,e=a.image.width;e>a.rect.width&&(e=a.rect.width,1==a.position||7==a.position?c=(a.image.width-a.rect.width)/2:(2==a.position||5==a.position||8==a.position)&&(c=a.image.width-a.rect.width));var f=a.image.height;return f>a.rect.height&&(f=a.rect.height,3==a.position||5==a.position?d=(a.image.height-a.rect.height)/2:(6==a.position||7==a.position||8==a.position)&&(d=a.image.height-a.rect.height)),a.image.getImage().then(function(){return a.image.crop(c,d,e,f),a.image.save()})}return Promise.resolve(b)})},b.prototype.unExecute=function(){return this.image.width=this.oldWidth,this.image.height=this.oldHeight,this.isCropped&&this.isCanCrop&&this.image.replaceOriginal(this.originalImage),this.image.save()},b}();a.FitAction=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(a){function b(b,c,d){var e=this;a.call(this),this.$el=b,this.images=c,this.ui=d,this.$widthInput=b.find(".crop__width input"),this.$heightInput=b.find(".crop__height input"),this.$widthInput.val(this.images[0].width.toString()),this.$heightInput.val(this.images[0].height.toString()),this.$position=b.find("#cropPosition .fp"),this.$button=b.find("#cropButton"),this.$button.on("click.CropResize",function(){return e.isSizeValid(e.getRectSize())&&e.trigger("apply",{fitPosition:e.getPosition(),size:e.getRectSize()}),!1}),this.$position.on("click.CropResize",function(a){e.$position.removeClass("selected"),e.selectPosition($(a.target))}),this.$widthInput.on("input.CropResize",function(){}),this.$heightInput.on("input.CropResize",function(){})}return __extends(b,a),b.prototype.isSizeValid=function(a){return!(a.width<30&&a.width>9999||a.height<30&&a.height>9999)},b.prototype.selectPosition=function(a){a.addClass("selected")},b.prototype.getPosition=function(){var a=this.$position.filter(".selected");if(a){if(a.hasClass("fp-left-top"))return 0;if(a.hasClass("fp-top"))return 1;if(a.hasClass("fp-right-top"))return 2;if(a.hasClass("fp-left"))return 3;if(a.hasClass("fp-center"))return 4;if(a.hasClass("fp-right"))return 5;if(a.hasClass("fp-left-bottom"))return 6;if(a.hasClass("fp-bottom"))return 7;if(a.hasClass("fp-right-bottom"))return 8}return null},b.prototype.getRectSize=function(){return{width:parseInt(this.$widthInput.val()),height:parseInt(this.$heightInput.val())}},b.prototype.destroy=function(){this.$button.off(".CropResize"),this.$position.off(".CropResize"),this.$widthInput.off(".CropResize"),this.$heightInput.off(".CropResize")},b}(UI.Widgets.RsWidget);a.Crop=b}(Modules||(Modules={}));var Modules;!function(a){!function(a){a[a.RESIZE=0]="RESIZE",a[a.WIDTH=1]="WIDTH",a[a.HEIGHT=2]="HEIGHT",a[a.RECT=3]="RECT"}(a.FitMethod||(a.FitMethod={}));a.FitMethod;!function(a){a[a.LEFT_TOP=0]="LEFT_TOP",a[a.TOP=1]="TOP",a[a.RIGHT_TOP=2]="RIGHT_TOP",a[a.LEFT=3]="LEFT",a[a.CENTER=4]="CENTER",a[a.RIGHT=5]="RIGHT",a[a.LEFT_BOTTOM=6]="LEFT_BOTTOM",a[a.BOTTOM=7]="BOTTOM",a[a.RIGHT_BOTTOM=8]="RIGHT_BOTTOM"}(a.FitPosition||(a.FitPosition={}));var b=(a.FitPosition,function(b){function c(c,d,e){var f=this;b.call(this),this.$el=c,this.images=d,this.ui=e,this.selected=0,this.fitCanvas=new a.FitMethodCanvas(c.find("#fitCanvas")[0]),this.$widthInput=c.find(".sizes__width input"),this.$heightInput=c.find(".sizes__height input"),this.$widthInput.val(this.images[0].width.toString()),this.$heightInput.val(this.images[0].height.toString()),this.$position=c.find("#fitPosition .fp"),this.$button=c.find(".fit-button"),this.$methods=c.find(".module-list li"),this.$methods.on("click.CropResize",function(a){f.$methods.removeClass("selected"),f.selectMethod($(a.target))}),this.$button.on("click.CropResize",function(){return f.isSizeValid(f.getRectSize())&&f.trigger("apply",{method:f.selected,fitPosition:f.getPosition(),rect:f.getRect(),isCanCrop:c.find("#fitCrop").is(":checked")}),!1}),this.$position.on("click.CropResize",function(a){f.$position.removeClass("selected"),f.selectPosition($(a.target))}),this.$widthInput.on("input.CropResize",function(){f.update()}),this.$heightInput.on("input.CropResize",function(){f.update()}),this.$methods.removeClass("selected"),this.selectMethod(this.$methods.eq(0)),this.update()}return __extends(c,b),c.prototype.update=function(){var a=this.getRectSize();this.isSizeValid(a)&&this.updateCanvas()},c.prototype.isSizeValid=function(a){return!(a.width<30&&a.width>9999||a.height<30&&a.height>9999)},c.prototype.selectPosition=function(a){a.addClass("selected"),this.updateCanvas()},c.prototype.getPosition=function(){var a=this.$position.filter(".selected");if(a){if(a.hasClass("fp-left-top"))return 0;if(a.hasClass("fp-top"))return 1;if(a.hasClass("fp-right-top"))return 2;if(a.hasClass("fp-left"))return 3;if(a.hasClass("fp-center"))return 4;if(a.hasClass("fp-right"))return 5;if(a.hasClass("fp-left-bottom"))return 6;if(a.hasClass("fp-bottom"))return 7;if(a.hasClass("fp-right-bottom"))return 8}return null},c.prototype.getSelectedMethod=function(){return this.selected},c.prototype.getRect=function(){return{left:0,top:0,width:parseInt(this.$widthInput.val()),height:parseInt(this.$heightInput.val())}},c.prototype.getRectSize=function(){return{width:parseInt(this.$widthInput.val()),height:parseInt(this.$heightInput.val())}},c.prototype.selectMethod=function(a){this.images=this.ui.selected(),a.addClass("selected"),"resize-all"==a.data("value")?this.selected=0:"stretch-to-width"==a.data("value")?this.selected=1:"stretch-to-height"==a.data("value")?this.selected=2:"stretch-to-rect"==a.data("value")&&(this.selected=3),this.updateCanvas()},c.prototype.updateCanvas=function(){var a=this.getRectSize();0==this.selected?this.fitCanvas.drawResizeAll(a.width,a.height,this.images[0].getWidth(),this.images[0].getHeight(),this.getPosition()):1==this.selected?this.fitCanvas.drawStretchToWidth(a.width,a.height,this.images[0].getWidth(),this.images[0].getHeight(),this.getPosition()):2==this.selected?this.fitCanvas.drawStretchToHeight(a.width,a.height,this.images[0].getWidth(),this.images[0].getHeight(),this.getPosition()):3==this.selected&&this.fitCanvas.drawStretchToRect(a.width,a.height,this.images[0].getWidth(),this.images[0].getHeight(),this.getPosition())},c.prototype.destroy=function(){this.$methods.off(".CropResize"),this.$button.off(".CropResize"),this.$position.off(".CropResize"),this.$widthInput.off(".CropResize"),this.$heightInput.off(".CropResize")},c}(UI.Widgets.RsWidget));a.Fit=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function b(a){this.canvas=a,this.canvasWidth=120,this.canvasHeight=90,this.canvasPadding=5,this.context=this.canvas.getContext("2d")}return b.prototype.initCanvas=function(){this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.context.fillStyle="#FFFFFF",this.context.strokeStyle="#000000",this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight)},b.prototype.getNewSize=function(a,b){var c=Math.min((this.canvasWidth-2*this.canvasPadding)/Math.max(a.width,b.width),(this.canvasHeight-2*this.canvasPadding)/Math.max(a.height,b.height));return{rect:{width:a.width*c,height:a.height*c},image:{width:b.width*c,height:b.height*c}}},b.prototype.getCalculatedPosition=function(a,b,c,d){var e={x:0,y:0},f={x:0,y:0};return b.height>=a.height?(f.y=d,e.y=0):(f.y=0,e.y=-d),b.width>=a.width?(f.x=c,e.x=0):(f.x=0,e.x=-c),{image:f,rect:e}},b.prototype.getStartCord=function(a,b,c){return 0==c?{rect:{x:0,y:0},image:{x:0,y:0}}:1==c?this.getCalculatedPosition(a,b,(b.width-a.width)/2,0):2==c?this.getCalculatedPosition(a,b,b.width-a.width,0):3==c?this.getCalculatedPosition(a,b,0,(b.height-a.height)/2):5==c?this.getCalculatedPosition(a,b,b.width-a.width,(b.height-a.height)/2):6==c?this.getCalculatedPosition(a,b,0,b.height-a.height):7==c?this.getCalculatedPosition(a,b,(b.width-a.width)/2,b.height-a.height):8==c?this.getCalculatedPosition(a,b,b.width-a.width,b.height-a.height):void 0},b.prototype.drawIntersect=function(a,b){this.context.setLineDash([]),this.context.fillStyle="gray",this.context.fillRect(Math.max(a.left,b.left),Math.max(a.top,b.top),Math.min(a.width,b.width),Math.min(a.height,b.height))},b.prototype.draw=function(a,b){this.context.strokeRect(a.left,a.top,a.width,a.height),this.context.strokeStyle="#FF0000",this.context.setLineDash([2]),this.context.strokeRect(b.left,b.top,b.width,b.height),this.drawIntersect(a,b)},b.prototype.render=function(a,b){this.initCanvas();var c=this.getStartCord(a.image,a.rect,b);this.draw({left:this.canvasPadding+c.rect.x,top:this.canvasPadding+c.rect.y,width:a.rect.width,height:a.rect.height},{left:this.canvasPadding+c.image.x,top:this.canvasPadding+c.image.y,width:a.image.width,height:a.image.height})},b.prototype.drawResizeAll=function(b,c,d,e,f){this.render(this.getNewSize({width:b,height:c},a.SizeCalculation.getFitSize(b,c,d,e)),f)},b.prototype.drawStretchToWidth=function(b,c,d,e,f){this.render(this.getNewSize({width:b,height:c},a.SizeCalculation.getStretchWidthSize(b,c,d,e)),f)},b.prototype.drawStretchToHeight=function(b,c,d,e,f){this.render(this.getNewSize({width:b,height:c},a.SizeCalculation.getStretchHeightSize(b,c,d,e)),f)},b.prototype.drawStretchToRect=function(b,c,d,e,f){this.render(this.getNewSize({width:b,height:c},a.SizeCalculation.getStretchRectSize(b,c,d,e)),f)},b}();a.FitMethodCanvas=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function a(){}return a.getFitSize=function(a,b,c,d){if(a>=c&&b>=d)return{width:c,height:d};var e=Math.min(a/c,b/d);return{width:c*e,height:d*e}},a.getStretchWidthSize=function(a,b,c,d){return{width:a,height:a/(c/d)}},a.getStretchHeightSize=function(a,b,c,d){return{width:b*(c/d),height:b}},a.getStretchRectSize=function(a,b,c,d){var e=Math.max(a/c,b/d);return{width:c*e,height:d*e}},a}();a.SizeCalculation=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function a(a,b,c){void 0===c&&(c=!1),this.image=a,this.filterName=b,this.vignette=c,this.needRender=!1,this.oldFilter={name:"",parameters:[]}}return a.prototype.execute=function(){return this.oldFilter=this.image.filter,this.image.filter="reset"==this.filterName?null:{name:this.filterName,parameters:[this.vignette]},this.image.save()},a.prototype.unExecute=function(){return this.image.filter=this.oldFilter,this.image.save()},a}();a.FilterAction=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function b(a){this.editor=a,this.image=null}return b.prototype.html=function(){return nunjucks.render("filters.html.njs",{})},b.prototype.viewType=function(){return 2},b.prototype.unSelectImage=function(){this.updateSelectState()},b.prototype.selectImage=function(){this.updateSelectState()},b.prototype.update=function(){this.updateSelectState(!0)},b.prototype.updateSelectState=function(a){if(void 0===a&&(a=!1),this.editor.selected().length>0){this.$el.show();var b=this.editor.selected()[0];(b!=this.image||a)&&(null!=this.widget&&this.widget.destroy(),this.image=b,this.initWidget()),null==this.widget&&this.initWidget()}else this.$el.hide()},b.prototype.initWidget=function(){var b=this,c="";null!=this.image.filter&&(c=this.image.filter.name),this.widget=new a.FiltersListWidget(this.$el,c),this.widget.draw(this.image),this.widget.on("filter",function(a){b.doAction(a.data.filter,a.data.vignette)}),this.widget.on("reset",function(){b.doAction("reset")})},b.prototype.init=function(a){this.$el=a,this.updateSelectState(!0)},b.prototype.deinit=function(){null!=this.widget&&(this.widget.destroy(),this.widget=null),this.editor.getInterface().clearPopover()},b.prototype.icon=function(){return"fa fa-filter"},b.prototype.type=function(){return 1},b.prototype.parent=function(){return null},b.prototype.name=function(){return"filter"},b.prototype.doAction=function(b,c){var d=this;void 0===c&&(c=!1),this.editor.getView().showLoading();var e=[];this.editor.selected().forEach(function(d){var f=new a.FilterAction(d,b,c);e.push(d.getActionDispatcher().process(f))}),Promise.all(e).then(function(){d.editor.getView().update()})},b}();a.FilterModule=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(a){function b(b,c,d,e){void 0===e&&(e=!1),a.call(this),this.$el=b,this.filterName=c,this.displayFilterName=d,this.isSelected=e,this.canvasWidth=50,this.render()}return __extends(b,a),b.prototype.render=function(){var a=this;this.$block=$(nunjucks.render("filter.html.njs",{filter:{name:this.filterName,displayName:this.displayFilterName}})),this.isSelected&&this.$block.addClass("selected"),this.$block.on("click.FilterWidget",function(b){"checkbox"!=$(b.target).attr("type")?a.trigger("select",{block:a.$block,name:a.filterName,vignette:a.$block.find("#mFilter-"+a.filterName+"-vignette").is(":checked")}):a.trigger("update",{block:a.$block,name:a.filterName,vignette:a.$block.find("#mFilter-"+a.filterName+"-vignette").is(":checked")})}),this.$el.append(this.$block)},b.prototype.draw=function(a,b,c){a.revert(),a[this.filterName]();var d=this.$block.find("canvas")[0];d.width=b,d.height=33;var e=d.getContext("2d");return e.fillRect(0,0,b,c),new Promise(function(b){a.render(function(){return e.putImageData(a.imageData,0,0),b(a)})})},b.prototype.destroy=function(){var a=this.$block.find("canvas")[0];a.width=1,a.height=1,a=null,this.$block.off(".FilterWidget"),this.$block.html("")},b}(UI.Widgets.RsWidget);a.FilterWidget=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(b){function c(a,c){void 0===c&&(c=""),b.call(this),this.$el=a,this.canvasWidth=50,this.filters=[],this.$filtersList=a.find(".m-filters__filters-list"),this.createFilter("lomo","Lomo",c),this.createFilter("vintage","Vintage",c),this.createFilter("clarity","Clarity",c),this.createFilter("sinCity","Sin City",c),this.createFilter("sunrise","Sunrise",c),this.createFilter("crossProcess","Cross Process",c),this.createFilter("orangePeel","Orange Peel",c),this.createFilter("love","Love",c),this.createFilter("grungy","Grungy",c),this.createFilter("jarques","Jarques",c),this.createFilter("pinhole","Pinhole",c),this.createFilter("oldBoot","Old Boot",c),this.createFilter("glowingSun","Glowing Sun",c),this.createFilter("hazyDays","Hazy Days",c),this.createFilter("herMajesty","Her Majesty",c),this.createFilter("nostalgia","Nostalgia",c),this.createFilter("hemingway","Hemingway",c),this.createFilter("concentrate","Concentrate",c)}return __extends(c,b),c.prototype.draw=function(a){var b=this,c=this.canvasWidth,d=a.height*this.canvasWidth/a.width;this.initCaman(a,c,d).then(function(a){var e=null;b.filters.forEach(function(b){e=null!=e?e.then(function(a){return b.draw(a,c,d)}):b.draw(a,c,d)})})},c.prototype.destroy=function(){this.filters.forEach(function(a){a.destroy()}),this.filters=[]},c.prototype.initCaman=function(a,b,c){return new Promise(function(d){new Core.ImageResizer(a.getImageData(),b,c).resize().then(function(a){var c=document.createElement("canvas"),e=c.getContext("2d");c.width=b,c.height=33,e.putImageData(a,0,0),Caman(c,function(){d(this)})})})},c.prototype.createFilter=function(b,c,d){var e=this,f=!1;

d==b&&(f=!0),this.filters.push(new a.FilterWidget(this.$filtersList,b,c,f).on("select",function(a){e.selectFilter(a.data.block,a.data.name,a.data.vignette)}).on("update",function(a){e.setFilter(a.data.block,a.data.name,a.data.vignette)}))},c.prototype.setFilter=function(a,b,c){this.$el.find(".m-filter").removeClass("selected"),a.addClass("selected"),this.trigger("filter",{filter:b,vignette:c})},c.prototype.selectFilter=function(a,b,c){a.hasClass("selected")?(this.trigger("reset"),this.$el.find(".m-filter").removeClass("selected")):(this.$el.find(".m-filter").removeClass("selected"),a.addClass("selected"),this.trigger("filter",{filter:b,vignette:c}))},c}(UI.Widgets.RsWidget);a.FiltersListWidget=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function a(a,b,c){this.image=a,this.width=b,this.height=c,this.needRender=!0}return a.prototype.execute=function(){return this.oldWidth=this.image.getWidth(),this.oldHeight=this.image.getHeight(),this.image.width=this.width,this.image.height=this.height,this.image.save()},a.prototype.unExecute=function(){return this.image.width=this.oldWidth,this.image.height=this.oldHeight,this.image.save()},a}();a.ResizeAction=b}(Modules||(Modules={}));var Modules;!function(a){var b=function(){function b(a){this.editor=a,this.isLocked=!0,this.image=null}return b.prototype.html=function(){return nunjucks.render("resize-single.dialog.html.njs",{isLocked:this.isLocked})},b.prototype.selectImage=function(){},b.prototype.unSelectImage=function(){},b.prototype.update=function(){},b.prototype.deinit=function(){this.editor.getInterface().clearPopover()},b.prototype.viewType=function(){return 0},b.prototype.init=function(a){var b=this;this.image=this.editor.selected()[0],this.$widthInput=a.find(".m__single-resize__val.width input"),this.$heightInput=a.find(".m__single-resize__val.height input"),this.$lock=a.find(".m__single-resize__lock"),this.$widthInput.val(this.image.width.toString()),this.$heightInput.val(this.image.height.toString());var c=_.debounce(function(){b.doAction(b.$widthInput.val(),b.$heightInput.val())},500);this.$lock.click(function(){b.isLocked?(b.isLocked=!1,b.$lock.find("i").attr("class","fa fa-unlock")):(b.isLocked=!0,b.updateSize(b.image),c(),b.$lock.find("i").attr("class","fa fa-lock"))}),this.$widthInput.on("input",function(){var a=parseInt(b.$widthInput.val());if(!isNaN(a)&&a>=50){b.isLocked&&b.$heightInput.val(Math.round(b.image.getOriginalImage().height*a/b.image.getOriginalImage().width)+"");var d=parseInt(b.$heightInput.val());!isNaN(d)&&d>=30&&c()}}),this.$heightInput.on("input",function(){var a=parseInt(b.$heightInput.val());if(!isNaN(a)&&a>=30){b.isLocked&&b.$widthInput.val(Math.round(b.image.getOriginalImage().width*a/b.image.getOriginalImage().height)+"");var d=parseInt(b.$widthInput.val());!isNaN(d)&&d>=50&&c()}})},b.prototype.updateSize=function(a){var b=parseInt(this.$widthInput.val()),c=parseInt(this.$heightInput.val());!isNaN(b)&&!isNaN(c)&&b>=50&&c>=30&&(b>c?this.$heightInput.val(Math.round(a.getOriginalImage().height*b/a.getOriginalImage().width)+""):this.$widthInput.val(Math.round(a.getOriginalImage().width*c/a.getOriginalImage().height)+""))},b.prototype.icon=function(){return"fa fa-expand"},b.prototype.type=function(){return 1},b.prototype.parent=function(){return null},b.prototype.name=function(){return"resize"},b.prototype.doAction=function(b,c){var d=this,e=new a.ResizeAction(this.image,b,c);this.image.getActionDispatcher().process(e).then(function(){d.editor.getView().update()})},b}();a.ResizeModule=b}(Modules||(Modules={}));